var t,e;t=this,e=function(t){"use strict";const e=t=>null==t,s=Object.freeze;t.createYjsPersister=(t,o)=>{const n=o.getMap("tinybase/store");return((t,o,a,r,i)=>{let d,u,c=0,f=!1;const y={load:async(s,o)=>{if(2!=c){c=1;const a=await(async()=>n.get("json"))();e(a)||""==a?t.setContent([s,o]):t.setJson(a),c=0}return y},startAutoLoad:async(s,o)=>(y.stopAutoLoad(),await y.load(s,o),f=!0,u=(t=>{const e=()=>t();return n.observe(e),e})((async s=>{e(s)?await y.load():2!=c&&(c=1,t.setContent(s),c=0)})),y),stopAutoLoad:()=>{return f&&(t=u,n.unobserve(t),u=void 0,f=!1),y;var t},save:async()=>(1!=c&&(c=2,await(async t=>{n.set("json",JSON.stringify(t()))})(t.getContent),c=0),y),startAutoSave:async()=>(await y.stopAutoSave().save(),d=t.addDidFinishTransactionListener(y.save),y),stopAutoSave:()=>{var s,o;return s=d,o=t.delListener,e(s)||o(s),y},getStore:()=>t,destroy:()=>y.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return s(y)})(t)}},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TinyBasePersisterYjs={});
