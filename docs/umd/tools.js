var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,l="",a=t(l),n=t(!0),o=t(0),d="type",s="default",r="Listener",I="get",c="add",$="Ids",i="Table",u=i+"s",p=i+$,b="Row",C=b+$,g="Sorted"+b+$,h="Cell",m=h+$,f="Value",w=f+"s",y=f+$,T=(e,t)=>e.every(t),v=(e,t)=>e.sort(t),V=(e,t)=>e.forEach(t),x=(e,t)=>e.map(t),R=e=>e.length,k=e=>0==R(e),S=(e,t)=>e.filter(t),A=(e,...t)=>e.push(...t),P=e=>e.pop(),E=(e,...t)=>e.unshift(...t),D=e=>e.shift(),O=JSON.parse,N=isFinite,L=(e,t)=>e instanceof t,G=e=>null==e,j=e=>e==a||e==n,M=e=>t(e)==a,J=e=>Array.isArray(e),z=e=>{const l=t(e);return j(l)||l==o&&N(e)?l:void 0},W=Object,B=W.keys,F=W.freeze,U=e=>L(e,W)&&e.constructor==W,_=(e,t)=>x(W.entries(e),(([e,l])=>t(l,e))),Z=e=>U(e)&&k(B(e)),H=(e,t)=>e?.has(t)??!1,Q=e=>[...e?.values()??[]],q=(e,t)=>e?.forEach(t),K=(e,t)=>e?.delete(t),X=e=>new Map(e),Y=(e,t)=>e?.get(t),ee=(e,t)=>q(e,((e,l)=>t(l,e))),te=(e,t)=>x([...e?.entries()??[]],(([e,l])=>t(l,e))),le=(e,t,l)=>G(l)?(K(e,t),e):e?.set(t,l),ae=(e,t,l)=>(H(e,t)||le(e,t,l()),Y(e,t)),ne=e=>e.toUpperCase(),oe=e=>e.toLowerCase(),de="a ",se="A function for",re=", and registers a listener so that any changes to that result will cause a re-render",Ie="Callback",ce="Del",$e="Deps",ie=$e+"?: React.DependencyList",ue="doRollback?: DoRollback",pe="actions: () => Return, "+ue,be="export",Ce="Id",ge="Invalid",he="Json",me=oe(r),fe="?: ",we=" | undefined",ye="NonNullable",Te="Partial",ve="Props",Ve="Provider",xe=`Registers a ${me} that will be called`,Re="Represents",ke="rowId: "+Ce,Se="Schema",Ae="Set",Pe=", descending?: boolean, offset?: number, limit?: number",Ee="[]",De="the Store",Oe="Transaction",Ne=Oe+"Changes",Le=oe(Oe),Ge="Execute a "+Le+" to make multiple mutations",je="Explicitly starts a "+Le,Me="Explicitly finishes a "+Le,Je="the end of the "+Le,ze="void",We=" => "+ze,Be="WhenSet",Fe=" when setting it",Ue=de+"string serialization of",_e=" ",Ze="Gets a callback that can ",He="the ",Qe=" the schema for",qe=(e=0,t=0)=>`the ${pt[e]}content of`+(t?_e+De:l),Ke=(e=0,t,a=0)=>$t[t]+_e+qe(e,1)+(a?" when setting it":l),Xe=(e,t=0)=>Re+` a Row when ${t?"s":"g"}etting ${qe()} the '${e}' `+i,Ye=(e,t,l=0)=>`Gets ${l?"sorted, paginated":"the"} Ids of the ${e}s in `+t,et=(e,t)=>`Calls a function for each ${e} in `+t,tt=e=>"The props passed to a component that renders "+e,lt=e=>"A function that takes "+e,at=(e,t=0)=>se+" listening to changes to "+ut[e]+" in "+ut[t],nt=(e,t,a=0)=>xe+" whenever "+ut[e]+" in "+ut[t]+" change"+(a?l:"s"),ot=e=>`the '${e}' `+i,dt=e=>"the specified Row in "+ot(e),st=(e,t=0)=>$t[t]+` ${qe()} `+ot(e),rt=(e,t=0)=>$t[t]+` ${qe()} `+dt(e),It=(e,t,l=0)=>$t[l]+` the '${t}' Cell for `+dt(e),ct=(e,t=0)=>$t[t]+` the '${e}' Value`,$t=["Gets","Checks existence of","Sets","Deletes","Sets part of",Re,"Gets "+Ue,"Sets "+Ue,xe+" whenever",Ze+"set",Ze+"add",Ze+"set part of",Ze+"delete","Renders","Gets "+Ue+Qe,"Sets"+Qe,"Deletes"+Qe],it=[I,"has","set","del","set","forEach",c,l],ut=[De,u,He+i+_e+$,de+i,He+b+_e+$,de+b,He+h+_e+$,de+h,"invalid Cell changes",w,He+f+_e+$,de+f,"invalid Value changes",He+"sorted "+b+_e+$],pt=[l,"tabular ","keyed value "],bt=e=>new Set(J(e)||G(e)?e:[e]),Ct=(e,t)=>e?.add(t),gt=/[^A-Za-z]+/,ht=/[^A-Za-z0-9]+/,mt=/^( *)\/\*\* *(.*?) *\*\/$/gm,ft=(e,t,l)=>e.substring(t,l),wt=e=>e.includes(","),yt=(e,t,l,a=1)=>{const n=`${t}${1==a?"":a}`;return H(e,n)?yt(e,t,l,a+1):(le(e,n,l),n)},Tt=e=>e.replace(mt,((e,t,l)=>{const a=77-vt(t);return`${t}/**\n${l.replace(RegExp(`([^\\n]{1,${a}})(\\s|$)`,"g"),t+" * $1\n")}${t} */`})),vt=e=>e.length,Vt=(e,t=l)=>e.join(t),xt=e=>e.flat(1e3),Rt=(e,t=0)=>Vt(x(e.split(ht),((e,l)=>(l>0||t?ne:oe)(ft(e,0,1))+ft(e,1)))),kt=e=>ne(Vt((e&&!gt.test(e[0])?e:" "+e).split(ht),"_")),St=e=>`/** ${e}. */`,At=(...e)=>Vt(S(e,(e=>e)),", "),Pt=(...e)=>"{"+Vt(e,"; ")+"}",Et=(...e)=>Pt(...x(e,(e=>"readonly "+e))),Dt=()=>{const e=[X(),X(),X(),X()],t=X(),a=X();return[(...e)=>Vt(xt(e),"\n"),(t,l,...a)=>V(a,(a=>V([0,1],(n=>(t??n)==n?Ct(ae(e[n],l,bt),a):0)))),(e,a,n,o=l,d=1)=>yt(t,e,[a,n,o,d]),(e,t,l)=>yt(a,e,J(l)?[`(${t}) => {`,l,"}"]:[`(${t}) => ${l}`]),(e,t)=>Y(a,e)===t?e:yt(a,e,t),(t=0)=>x([...v(te(e[t],((e,t)=>`import {${Vt(v(Q(e)),", ")}} from '${t}';`)),((e,t)=>wt(e)!=wt(t)?wt(e)?-1:1:e>t?1:-1)),l],(e=>e.replace("{React}","React"))),()=>te(t,(([e,t,a,n],o)=>[St(t),`${n?be+" ":l}type ${o}${a} = ${e};`,l])),()=>te(a,((e,t)=>(e=J(e)?e:[e],A(e,P(e)+";"),[`const ${t} = ${D(e)}`,e,l])))]},Ot=e=>{const t=new WeakMap;return l=>(t.has(l)||t.set(l,e(l)),t.get(l))},Nt=(e,t,l)=>[t=>_(e,((e,a)=>t(a,Rt(a,1),l(kt(a),`'${a}'`)))),(t,a)=>_(e[t],((e,t)=>a(t,e[d],e[s],l(kt(t),`'${t}'`),Rt(t,1)))),e=>_(t,((t,a)=>e(a,t[d],t[s],l(kt(a),`'${a}'`),Rt(a,1))))],Lt=(e,t,a,n)=>[(n,o)=>{const d=n+": "+o,s=e(u,Pt(...t((e=>`'${e}'?: {[rowId: Id]: `+Pt(...a(e,((e,t,a)=>`'${e}'${G(a)?"?":l}: ${t}`)))+"}"))),Ke(1,5)),I=e(u+Be,Pt(...t((e=>`'${e}'?: {[rowId: Id]: `+Pt(...a(e,((e,t)=>`'${e}'?: ${t}`)))+"}"))),Ke(1,5,1)),c=e(i+Ce,"keyof "+s,"A "+i+" Id in "+De),$=`<TId extends ${c}>`,f=e(i,ye+`<${s}[TId]>`,"A "+i+" in "+De,$),w=e(i+Be,ye+`<${I}[TId]>`,"A "+i+" in "+De+Fe,$),y=e(b,f+"<TId>[Id]","A "+b+" in a "+i,$),T=e(b+Be,w+"<TId>[Id]","A "+b+" in a "+i+Fe,$),v=e(h+Ce,`Extract<keyof ${y}<TId>, Id>`,"A "+h+" Id in a "+b,$),V=e(h,ye+`<${s}[TId]>[Id][CId]`,"A "+h+" in a "+b,`<TId extends ${c}, CId extends ${v}<TId>>`),x=e("CellIdCellArray",`CId extends ${v}<TId> ? [cellId: CId, cell: ${V}<TId, CId>] : never`,h+" Ids and types in a "+b,`<TId extends ${c}, CId = ${v}<TId>>`,0),R=e(h+Ie,`(...[cellId, cell]: ${x}<TId>)`+We,lt(de+h+" Id, and "+h),$),k=e(b+Ie,"(rowId: Id, forEachCell: (cellCallback: CellCallback<TId>) "+We+") "+We,lt(de+b+" Id, and a "+h+" iterator"),$),S=e("TableIdForEachRowArray",`TId extends ${c} ? [tableId: TId, forEachRow: (rowCallback: ${k}<TId>)${We}] : never`,i+" Ids and callback types",`<TId = ${c}>`,0),A=e(i+Ie,`(...[tableId, forEachRow]: ${S})`+We,lt(de+i+" Id, and a "+b+" iterator"),l),P=e("TableIdRowIdCellIdArray",`TId extends ${c} ? [tableId: TId, rowId: Id, cellId: ${v}<TId>] : never`,"Ids for GetCellChange",`<TId = ${c}>`,0),E=e("GetCellChange",`(...[tableId, rowId, cellId]: ${P}) => CellChange`,se+" returning information about any Cell's changes during a "+Le),D=e(u+r,`(${d}, getCellChange: ${E}${we})`+We,at(1)),O=e(p+r,`(${d})`+We,at(2)),N=e(i+r,`(${d}, tableId: ${c}, getCellChange: ${E}${we})`+We,at(3)),L=e(C+r,`(${d}, tableId: ${c})`+We,at(4,3)),j=e(g+r,"("+At(d,"tableId: "+c,"cellId: Id"+we,"descending: boolean","offset: number","limit: number"+we,"sortedRowIds: Ids")+")"+We,at(13,3)),M=e(b+r,"("+At(""+d,"tableId: "+c,ke,`getCellChange: ${E}${we}`)+")"+We,at(5,3)),J=e(m+r,"("+At(""+d,"tableId: "+c,ke)+")"+We,at(6,5)),z=e("CellListenerArgsArrayInner",`CId extends ${v}<TId> ? [${d}, tableId: TId, ${ke}, cellId: CId, newCell: ${V}<TId, CId> ${we}, oldCell: ${V}<TId, CId> ${we}, getCellChange: ${E} ${we}] : never`,"Cell args for CellListener",`<TId extends ${c}, CId = ${v}<TId>>`,0),W=e("CellListenerArgsArrayOuter",`TId extends ${c} ? `+z+"<TId> : never","Table args for CellListener",`<TId = ${c}>`,0);return[s,I,c,f,w,y,T,v,V,R,k,A,D,O,N,L,j,M,J,e(h+r,`(...[${n}, tableId, rowId, cellId, newCell, oldCell, getCellChange]: ${W})`+We,at(7,5)),e(ge+h+r,`(${d}, tableId: Id, ${ke}, cellId: Id, invalidCells: any[])`+We,at(8))]},(t,a)=>{const o=t+": "+a,d=e(w,Pt(...n(((e,t,a)=>`'${e}'${G(a)?"?":l}: ${t}`))),Ke(2,5)),s=e(w+Be,Pt(...n(((e,t)=>`'${e}'?: ${t}`))),Ke(2,5,1)),I=e(f+Ce,"keyof "+d,"A "+f+" Id in "+De),c=e(f,ye+`<${d}[VId]>`,"A "+f+" Id in "+De,`<VId extends ${I}>`),$=e("ValueIdValueArray",`VId extends ${I} ? [valueId: VId, value: ${c}<VId>] : never`,f+" Ids and types in "+De,`<VId = ${I}>`,0),i=e(f+Ie,`(...[valueId, value]: ${$})`+We,lt(de+f+" Id, and "+f)),u=e("GetValueChange",`(valueId: ${I}) => ValueChange`,se+" returning information about any Value's changes during a "+Le),p=e(w+r,`(${o}, getValueChange: ${u}${we})`+We,at(9)),b=e(y+r,`(${o})`+We,at(10)),C=e("ValueListenerArgsArray",`VId extends ${I} ? [${o}, valueId: VId, newValue: ${c}<VId> ${we}, oldValue: ${c}<VId> ${we}, getValueChange: ${u} ${we}] : never`,"Value args for ValueListener",`<VId = ${I}>`,0);return[d,s,I,c,i,p,b,e(f+r,`(...[${t}, valueId, newValue, oldValue, getValueChange]: `+C+")"+We,at(11)),e(ge+f+r,`(${o}, valueId: Id, invalidValues: any[])`+We,at(12))]},(t,l)=>e(Oe+r,`(${t}: ${l}, getTransactionChanges: GetTransactionChanges, getTransactionLog: GetTransactionLog)`+We,se+" listening to the completion of a "+Le)],Gt=(e,t=l,a=l)=>`store.${e}(${t})`+(a?" as "+a:l),jt=(e,t=l)=>`fluent(() => ${Gt(e,t)})`,Mt=(e,t=l,a=l)=>`store.${e}(${t?t+", ":l}proxy(listener)${a?", "+a:l})`,Jt=(e,t,a)=>{const[o,I,T,v,x,R,k,S]=Dt(),[P,D,O]=Nt(e,t,x),[N,L,j]=Lt(T,P,D,O),J=X(),z=(e=0)=>te(J,(([t,a,n,o,d],s)=>{const r=e?[s+`: ${d}(${t}): ${a} => ${n},`]:[s+d+`(${t}): ${a};`];return e||E(r,St(o)),A(r,l),r})),W=(e,t,a,n,o,d=l)=>yt(J,e,[t,a,n,o,d]),B=(e,t,a,n,o,d=l,s=l,r=l)=>W(it[e]+t+(4==e?Te:l)+a,d,n,(n==_?jt:Gt)(it[e]+(4==e?Te:l)+a,s,e?void 0:n),o,r),F=(e,t,a,n=l,o=l,d=1,s=l)=>W(c+e+r,(n?n+", ":l)+me+": "+t+(d?", mutator?: boolean":l),Ce,Mt(c+e+r,o,d?"mutator":l),a,s),U=`./${Rt(a)}.d`,_=Rt(a,1),H=Rt(_),q=[],K=X();let ae=[],ne=[];if(I(1,U,_,`create${_} as create${_}Decl`),Z(e))I(null,"tinybase",u);else{I(0,"tinybase","CellChange"),I(null,"tinybase",$);const[e,t,a,o,r,c,f,w,y,v,R,k,S,E,O,L,j,J,z,W,Z]=N(H,_),ee=X();P(((e,t)=>{const l=`<'${e}'>`,a=[T(t+i,o+l,Re+` the '${e}' `+i),T(t+i+Be,r+l,Re+` the '${e}' `+i+Fe),T(t+b,c+l,Xe(e)),T(t+b+Be,f+l,Xe(e,1)),T(t+h+Ce,w+l,`A Cell Id for the '${e}' `+i),T(t+h+Ie,v+l,lt(`a Cell Id and value from a Row in the '${e}' `+i)),T(t+b+Ie,R+l,lt(`a Row Id from the '${e}' Table, and a Cell iterator`))];le(ee,e,a),I(1,U,...a)})),I(1,U,e,t,a,w,k,S,E,O,L,j,J,z,W,Z),ae=[e,t,a,w,S,E,O,L,j,J,z,W,ee],V([[e],[n],[_,"tables: "+t,"tables"],[_]],(([e,t,a],n)=>B(n,l,u,e,Ke(1,n),t,a))),B(0,l,p,a+Ee,Ye(i,De)),B(5,l,i,ze,et(i,De),"tableCallback: "+k,"tableCallback as any"),P(((e,t,a)=>{const[o,d,s,r,I,c,u]=Y(ee,e);V([[o],[n],[_,"table: "+d,", table"],[_]],(([n,o,d=l],s)=>B(s,t,i,n,st(e,s),o,a+d))),B(0,t,C,$,Ye(b,ot(e)),l,a),B(0,t,g,$,Ye(b,ot(e),1),"cellId?: "+I+Pe,a+", cellId, descending, offset, limit"),B(5,t,b,ze,et(b,ot(e)),"rowCallback: "+u,a+", rowCallback as any"),V([[s],[n],[_,", row: "+r,", row"],[_],[_,", partialRow: "+r,", partialRow"]],(([n,o=l,d=l],s)=>B(s,t,b,n,rt(e,s),ke+o,a+", rowId"+d))),B(6,t,b,Ce+we,"Add a new Row to "+ot(e),"row: "+r+", reuseIds?: boolean",a+", row, reuseIds"),B(0,t,m,I+Ee,Ye(h,dt(e)),ke,a+", rowId"),B(5,t,h,ze,et(h,dt(e)),ke+", cellCallback: "+c,a+", rowId, cellCallback as any"),D(e,((o,d,s,r,I)=>{const c="Map"+Rt(d,1);le(K,d,c);const $=d+(G(s)?we:l);V([[$],[n],[_,`, cell: ${d} | `+c,", cell as any"],[_]],(([n,d=l,s=l],c)=>B(c,t+I,h,n,It(e,o,c),ke+d,a+", rowId, "+r+s)))}))})),B(0,l,u+he,he,Ke(1,6)),B(2,l,u+he,_,Ke(1,7),"tablesJson: "+he,"tables"+he),F(u,S,Ke(1,8)+" changes"),F(p,E,nt(2,0,1)),F(i,O,nt(3,0),`tableId: ${a} | null`,"tableId"),F(C,L,nt(4,3,1),`tableId: ${a} | null`,"tableId"),F(g,j,nt(13,3,1),At("tableId: TId",`cellId: ${w}<TId>`+we,"descending: boolean","offset: number","limit: number"+we),At("tableId","cellId","descending","offset","limit"),1,"<TId extends TableId>"),F(b,J,nt(5,3),`tableId: ${a} | null, rowId: IdOrNull`,"tableId, rowId"),F(m,z,nt(6,5,1),`tableId: ${a} | null, rowId: IdOrNull`,"tableId, rowId"),F(h,W,nt(7,5),`tableId: ${a} | null, rowId: IdOrNull, cellId: ${Vt(P((e=>Y(ee,e)?.[4]??l))," | ")} | null`,"tableId, rowId, cellId"),F(ge+h,Z,xe+" whenever an invalid Cell change was attempted","tableId: IdOrNull, rowId: IdOrNull, cellId: IdOrNull","tableId, rowId, cellId"),I(1,U,...Q(K)),A(q,".set"+u+Se+"({",xt(P(((e,t,a)=>[`[${a}]: {`,...D(e,((e,t,a,n)=>`[${n}]: {[${x(kt(d),`'${d}'`)}]: ${x(kt(t),`'${t}'`)}${G(a)?l:`, [${x(kt(s),`'${s}'`)}]: `+(M(a)?x(kt(a),`'${a}'`):a)}},`)),"},"]))),"})")}if(Z(t))I(null,"tinybase",w);else{const[e,t,a,o,r,c,$,i,u]=L(H,_);I(1,U,e,t,a,r,c,$,i,u),ne=[e,t,a,c,$,i],V([[e],[n],[_,"values: "+t,"values"],[_],[_,"partialValues: "+t,"partialValues"]],(([e,t,a],n)=>B(n,l,w,e,Ke(2,n),t,a))),B(0,l,y,a+Ee,Ye(f,De)),B(5,l,f,"void",et(f,De),"valueCallback: "+r,"valueCallback as any"),O(((e,t,a,o,d)=>{const s="Map"+Rt(t,1);le(K,t,s),V([[t],[n],[_,`value: ${t} | `+s,", value as any"],[_]],(([t,a,n=l],s)=>B(s,d,f,t,ct(e,s),a,o+n)))})),B(0,l,w+he,he,Ke(2,6)),B(2,l,w+he,_,Ke(2,7),"valuesJson: "+he,"values"+he),F(w,c,Ke(2,8)+" changes"),F(y,$,nt(10,0,1)),F(f,i,nt(11,0),`valueId: ${a} | null`,"valueId"),F(ge+f,u,xe+" whenever an invalid Value change was attempted","valueId: IdOrNull","valueId"),I(1,U,...Q(K)),I(0,"tinybase","ValueChange"),A(q,".set"+w+Se+"({",O(((e,t,a,n)=>[`[${n}]: {[${x(kt(d),`'${d}'`)}]: ${x(kt(t),`'${t}'`)}${G(a)?l:`, [${x(kt(s),`'${s}'`)}]: `+(M(a)?x(kt(a),`'${a}'`):a)}},`])),"})")}B(0,l,"Content",`[${u}, ${w}]`,Ke(0,0)),B(2,l,"Content",_,Ke(0,2),`[tables, values]: [${u}, ${w}]`,"[tables, values]"),B(2,l,Ne,_,`Applies a set of ${Ne} to the Store`,"transactionChanges: "+Ne,"transactionChanges"),ee(K,((e,t)=>T(t,`(cell: ${e}${we}) => `+e,`Takes a ${e} Cell value and returns another`))),I(null,"tinybase","DoRollback",Ce,"IdOrNull",he,"Store",Ne),I(0,"tinybase","Get"+Ne,"GetTransactionLog"),B(0,l,he,he,Ke(0,6)),B(2,l,he,_,Ke(0,7),"tablesAndValuesJson: "+he,"tablesAndValuesJson"),B(7,l,Le,"Return",Ge,pe,"actions, doRollback","<Return>"),B(7,l,"start"+Oe,_,je),B(7,l,"finish"+Oe,_,Me,ue,"doRollback");const oe=j(H,_);return F("WillFinish"+Oe,oe,xe+" just before "+Je,l,l,0),F("DidFinish"+Oe,oe,xe+" just after "+Je,l,l,0),B(7,l,"call"+r,_,"Manually provoke a listener to be called","listenerId: Id","listenerId"),B(3,l,r,_,"Remove a listener that was previously added to "+De,"listenerId: Id","listenerId"),W("getStore",l,"Store","store",$t[0]+" the underlying Store object"),I(1,"tinybase","createStore"),I(1,U,_,`create${_} as create${_}Decl`,oe),x("store",["createStore()",...q]),v("fluent","actions: () => Store",["actions();",`return ${H};`]),v("proxy","listener: any",`(_: Store, ...params: any[]) => listener(${H}, ...params)`),x(H,["{",...z(1),"}"]),[o(...R(0),...k(),be+" interface "+_+" {",...z(0),"}",l,St(`Creates a ${_} object`),be+" function create"+_+"(): "+_+";"),o(...R(1),be+" const create"+_+": typeof create"+_+"Decl = () => {",...S(),`return Object.freeze(${H});`,"};"),ae,ne]},zt=e=>I+e,Wt=e=>At(zt(e),zt(e)+$e),Bt="debugIds?: boolean",Ft="debugIds={debugIds}",Ut="then"+ie,_t="Parameter",Zt=": (parameter: "+_t+", store: Store) => ",Ht="const contextValue = useContext(Context);",Qt=", based on a parameter",qt=": ",Kt="<"+_t+",>",Xt=_t+"ized"+Ie+"<"+_t+">",Yt="rowId",el="rowId={rowId}",tl=", separator, debugIds",ll="separator?: ReactElement | string",al="then?: (store: Store",nl=At(al+")"+We,Ut),ol="then, then"+$e,dl=Yt+qt+Ce,sl="View",rl=(e,...t)=>At(...t,me+": "+e,me+ie,"mutator?: boolean"),Il=(...e)=>At(...e,me,me+$e,"mutator"),cl=(e,t,a,n,o)=>{const[d,s,I,c,T,v,V,x]=Dt(),[R,k,S]=Nt(e,t,T),P=`./${Rt(a)}.d`,D=`./${Rt(a)}-ui-react.d`,O="tinybase/ui-react",N=Rt(a,1),L=Rt(N),j=N+"Or"+N+Ce,M=L+"Or"+N+Ce,J=L+`={${L}}`,z=X(),W=(e,t,a,n,o,d=l)=>(s(1,D,e+" as "+e+"Decl"),yt(z,e,[t,a,n,o,d])),B=(e,t,a,n,o,d=l)=>W("use"+e,t,a,n,o,d),F=(e,t,a,n,o=l,d=l,r=l,I=l,c=l)=>(s(1,O,`use${t} as use${t}Core`),B(e,At(o,q,I),a,ee+`(${M}, use${t}Core, [`+(d||l)+(c?"], ["+c:l)+"]);",n,r)),U=(e,t,l,a)=>W(e,t,1,l,a),_=(e=0)=>te(z,(([t,a,n,o,d],s)=>{const r=e?[be+` const ${s}: typeof ${s}Decl = ${d}(${t}): ${1==a?"any":a} =>`,n]:[be+` function ${s}${d}(${t}): ${1==a?"ComponentReturnType":a};`];return e||E(r,St(o)),A(r,l),r}));s(null,"tinybase",Ce,"Store",Ie,_t+"ized"+Ie),s(0,O,"ComponentReturnType"),s(null,O,"ExtraProps"),s(0,P,N);const H=I(j,N+" | "+Ce,`Used when you need to refer to a ${N} in a React hook or component`),Q=I(Ve+ve,Et(L+fe+N,L+`ById?: {[${L}Id: Id]: ${N}}`),`Used with the ${Ve} component, so that a `+N+" can be passed into the context of an application");s(0,"react","ReactElement","ComponentType"),s(1,"react","React"),s(1,D,H,Q);const q=M+fe+H;T("{createContext, useContext, useMemo}","React"),T("Context",`createContext<[${N}?, {[${L}Id: Id]: ${N}}?]>([])`),B("Create"+N,`create: () => ${N}, create`+ie,N,"\n// eslint-disable-next-line react-hooks/exhaustive-deps\nuseMemo(create, createDeps)",`Create a ${N} within a React application with convenient memoization`);const K=B(N,"id?: Id",N+we,["{",Ht,"return id == null ? contextValue[0] : contextValue[1]?.[id];","}"],`Get a reference to a ${N} from within a ${Ve} component context`),ee=c("useHook",M+`: ${H} | undefined, hook: (...params: any[]) => any, preParams: any[], postParams: any[] = []`,[`const ${L} = ${K}(${M} as Id);`,`return hook(...preParams, ((${M} == null || typeof ${M} == 'string')`,`? ${L} : ${M})?.getStore(), ...postParams)`]),le=c("getProps","getProps: ((id: any) => ExtraProps) | undefined, id: Id","(getProps == null) ? ({} as ExtraProps) : getProps(id)"),ae=c("wrap",At("children: any","separator?: any","encloseWithId?: boolean","id?: Id"),["const separated = separator==null || !Array.isArray(children)"," ? children"," : children.map((child, c) => (c > 0 ? [separator, child] : child));","return encloseWithId ? [id, ':{', separated, '}'] : separated;"]),ne=T("NullComponent","() => null");if(!Z(e)){const[e,t,a,o,d,f,w,y,T,v,V,x,S]=n;s(null,P,e,t,a,d,f,w,y,T,v,V,x),s(0,P,o),s(1,P,N),s(null,"tinybase",$,"IdOrNull");const A=c("tableView",`{${L}, rowComponent, getRowComponentProps`+tl+"}: any, rowIds: Ids, tableId: Id, defaultRowComponent: React.ComponentType<any>",["const Row = rowComponent ?? defaultRowComponent;",`return ${ae}(rowIds.map((rowId) => (`,"<Row","{..."+le+"(getRowComponentProps, rowId)}","key={rowId}","tableId={tableId}",el,J,Ft,"/>","))",tl,", tableId,",");"]),E=c("getDefaultTableComponent","tableId: Id",Vt(R(((e,t,l)=>`tableId == ${l} ? ${t}TableView : `)))+ne),O=c("getDefaultCellComponent","tableId: Id, cellId: Id",Vt(R(((e,t,l)=>`tableId == ${l} ? ${Vt(k(e,((e,l,a,n,o)=>`cellId == ${n} ? `+t+o+"CellView : ")))+ne} : `)))+ne);F(u,u,e,Ke(1,0)+re);const j=F(p,p,a+Ee,Ye(i,De)+re);F(Ae+u+Ie,Ae+u+Ie,Xt,Ke(1,9)+Qt,At(zt(u)+Zt+t,zt(u)+ie),Wt(u),Kt,At(al,`tables: ${t})`+We,Ut),ol),F(ce+u+Ie,ce+u+Ie,Ie,Ke(1,12),l,l,l,nl,ol);const M=I(h+ve,Et("tableId?: TId","rowId: Id","cellId?: CId",L+fe+N,Bt),tt(de+h),`<TId extends ${a}, CId extends ${o}<TId>>`),z=I(b+ve,Et("tableId?: TId","rowId: Id",L+fe+N,"cellComponents?: {readonly [CId in "+o+`<TId>]?: ComponentType<${M}<TId, CId>>;}`,`getCellComponentProps?: (cellId: ${o}<TId>) => ExtraProps`,ll,Bt),tt(de+b),`<TId extends ${a}>`),W=I(i+ve,Et("tableId?: TId",L+fe+N,`rowComponent?: ComponentType<${z}<TId>>`,"getRowComponentProps?: (rowId: Id) => ExtraProps",ll,Bt),tt(de+i),`<TId extends ${a}>`),B=I("Sorted"+i+ve,Et("tableId?: TId","cellId?: "+o+"<TId>","descending?: boolean","offset?: number","limit?: number",L+fe+N,`rowComponent?: ComponentType<${z}<TId>>`,"getRowComponentProps?: (rowId: Id) => ExtraProps",ll,Bt),tt(de+"sorted "+i),`<TId extends ${a}>`),_=I(u+ve,Et(L+fe+N,"tableComponents?: {readonly [TId in "+a+`]?: ComponentType<${W}<TId>>;}`,`getTableComponentProps?: (tableId: ${a}) => ExtraProps`,ll,Bt),tt(qe(1,1)));s(1,D,_,W,B,z,M),U(u+sl,"{"+L+", tableComponents, getTableComponentProps"+tl+"}: "+_,[ae+`(${j}(${L}).map((tableId) => {`,"const Table = (tableComponents?.[tableId] ?? "+E+"(tableId)) as React.ComponentType<TableProps<typeof tableId>>;","return <Table",`{...${le}(getTableComponentProps, tableId)}`,"tableId={tableId}","key={tableId}",J,Ft,"/>;","}), separator)"],Ke(1,13)+re),R(((e,t,a)=>{const[n,o,d,r,I]=Y(S,e);s(null,P,n,o,d,r,I),F(t+i,i,n,st(e)+re,l,a);const c=F(t+C,C,$,Ye(b,ot(e))+re,l,a),u=F(t+g,g,$,Ye(b,ot(e),1)+re,"cellId?: "+I+", descending?: boolean, offset?: number, limit?: number",a+", cellId, descending, offset, limit");F(t+b,b,d,rt(e)+re,dl,At(a,Yt));const p=F(t+m,m,I+Ee,Ye(h,dt(e))+re,dl,At(a,Yt));F(Ae+t+i+Ie,Ae+i+Ie,Xt,st(e,9)+Qt,At(zt(i)+Zt+o,zt(i)+ie),At(a,Wt(i)),Kt,At(al,`table: ${o})`+We,Ut),ol),F(ce+t+i+Ie,ce+i+Ie,Ie,st(e,12),l,a,l,nl,ol),F(Ae+t+b+Ie,Ae+b+Ie,Xt,rt(e,9)+Qt,At(dl,zt(b)+Zt+r,zt(b)+ie),At(a,Yt,Wt(b)),Kt,At(al,`row: ${r})`+We,Ut),ol),F("Add"+t+b+Ie,"Add"+b+Ie,Xt,rt(e,10)+Qt,At(zt(b)+Zt+r,zt(b)+ie),At(a,Wt(b)),Kt,"then?: ("+At(dl+we,"store: Store","row: "+r+")"+We,"then"+ie)+", reuseRowIds?: boolean",ol+", reuseRowIds"),F(Ae+t+Te+b+Ie,Ae+Te+b+Ie,Xt,rt(e,11)+Qt,At(dl,zt(Te+b)+Zt+r,zt(Te+b)+ie),At(a,Yt,Wt(Te+b)),Kt,At(al,`partialRow: ${r})`+We,Ut),ol),F(ce+t+b+Ie,ce+b+Ie,Ie,rt(e,12),dl,At(a,Yt),l,nl,ol);const f=U(t+b+sl,"{rowId, "+L+", cellComponents, getCellComponentProps"+tl+`}: ${z}<'${e}'>`,[ae+`(${p}(rowId, ${L}).map((cellId) => {`,"const Cell = (cellComponents?.[cellId] ?? "+O+`(${a}, cellId)) as React.ComponentType<CellProps<typeof `+a+", typeof cellId>>;","return <Cell",`{...${le}(getCellComponentProps, cellId)} `,"key={cellId}",`tableId={${a}}`,el,"cellId={cellId}",J,Ft,"/>;","})"+tl+", rowId)"],rt(e,13)+re);U(t+"Sorted"+i+sl,"{cellId, descending, offset, limit, ...props}: "+B+`<'${e}'>`,A+"(props, "+u+`(cellId, descending, offset, limit, props.${L}), ${a}, ${f});`,st(e,13)+", sorted"+re),U(t+i+sl,`props: ${W}<'${e}'>`,A+"(props, "+c+`(props.${L}), ${a}, ${f});`,st(e,13)+re),k(e,((n,o,d,r,I)=>{const c="Map"+Rt(o,1);s(0,P,c),s(1,P,c);const $=F(t+I+h,h,o+(G(d)?we:l),It(e,n)+re,dl,At(a,Yt,r));F(Ae+t+I+h+Ie,Ae+h+Ie,Xt,It(e,n,9)+Qt,At(dl,zt(h)+Zt+o+" | "+c,zt(h)+ie),At(a,Yt,r,Wt(h)),Kt,At(al,`cell: ${o} | ${c})`+We,Ut),ol),F(ce+t+I+h+Ie,ce+h+Ie,Ie,It(e,n,12),At(dl,"forceDel?: boolean"),At(a,Yt,r,"forceDel"),l,nl,ol),U(t+I+h+sl,`{rowId, ${L}, debugIds}: `+M+`<'${e}', '${n}'>`,[ae+`('' + ${$}(rowId, `+L+`) ?? '', undefined, debugIds, ${r})`],It(e,n,13)+re)}))}));const Z=Vt(R((e=>Y(S,e)?.[4]??l))," | ");F(u+r,u+r,ze,Ke(1,8)+" changes",rl(d),Il()),F(p+r,p+r,ze,nt(2,0,1),rl(f),Il()),F(i+r,i+r,ze,nt(3,0),rl(w,`tableId: ${a} | null`),Il("tableId")),F(C+r,C+r,ze,nt(4,3,1),rl(y,`tableId: ${a} | null`),Il("tableId")),F(g+r,g+r,ze,nt(13,3,1),rl(T,`tableId: ${a} | null`,"cellId: "+Z+we,"descending: boolean","offset: number","limit: number"+we),Il("tableId","cellId","descending","offset","limit")),F(b+r,b+r,ze,nt(5,3),rl(v,`tableId: ${a} | null`,Yt+": IdOrNull"),Il("tableId",Yt)),F(m+r,m+r,ze,nt(6,5,1),rl(V,`tableId: ${a} | null`,Yt+": IdOrNull"),Il("tableId",Yt)),F(h+r,h+r,ze,nt(7,5),rl(x,`tableId: ${a} | null`,Yt+": IdOrNull",`cellId: ${Z} | null`),Il("tableId",Yt,"cellId"))}if(!Z(t)){const[e,t,a,n,d,$]=o;s(null,P,...o),s(1,P,N);const i=c("getDefaultValueComponent","valueId: Id",Vt(S(((e,t,l,a,n)=>`valueId == ${a} ? `+n+"ValueView : ")))+ne);F(w,w,e,Ke(2,0)+re);const u=F(y,y,a+Ee,Ye(f,De)+re);F(Ae+w+Ie,Ae+w+Ie,Xt,Ke(2,9)+Qt,At(zt(w)+Zt+t,zt(w)+ie),Wt(w),Kt,At(al,`values: ${t})`+We,Ut),ol),F(Ae+Te+w+Ie,Ae+Te+w+Ie,Xt,Ke(2,11)+Qt,At(zt(Te+w)+Zt+t,zt(Te+w)+ie),Wt(Te+w),Kt,At(al,`partialValues: ${t})`+We,Ut),ol),F(ce+w+Ie,ce+w+Ie,Ie,Ke(2,12),l,l,l,nl,ol);const p=I(f+ve,Et("valueId?: VId",L+fe+N,Bt),tt("a Value"),`<VId extends ${a}>`),b=I(w+ve,Et(L+fe+N,"valueComponents?: {readonly [VId in "+a+`]?: ComponentType<${p}<VId>>;}`,`getValueComponentProps?: (valueId: ${a}) => ExtraProps`,ll,Bt),tt(qe(2,1)));s(1,D,b,p),U(w+sl,"{"+L+", valueComponents, getValueComponentProps"+tl+"}: "+b,[ae+`(${u}(${L}).map((valueId) => {`,"const Value = valueComponents?.[valueId] ?? "+i+"(valueId);","return <Value",`{...${le}(getValueComponentProps, valueId)}`,"key={valueId}",J,Ft,"/>;","}), separator)"],Ke(2,13)+re),S(((e,t,a,n,o)=>{const d="Map"+Rt(t,1);s(0,P,d),s(1,P,d);const r=F(o+f,f,t,ct(e)+re,l,n);F(Ae+o+f+Ie,Ae+f+Ie,Xt,ct(e,9)+Qt,At(zt(f)+Zt+t+" | "+d,zt(f)+ie),At(n,Wt(f)),Kt,At(al,`value: ${t} | ${d})`+We,Ut),ol),F(ce+o+f+Ie,ce+f+Ie,Ie,ct(e,12),l,n,l,nl,ol),U(o+f+sl,`{${L}, debugIds}: ${p}<'${e}'>`,[ae+`('' + ${r}(`+L+`) ?? '', undefined, debugIds, ${n})`],ct(e,13)+re)})),F(w+r,w+r,ze,Ke(2,8)+" changes",rl(n),Il()),F(y+r,y+r,ze,nt(10,0,1),rl(d),Il()),F(f+r,f+r,ze,nt(11,0),rl($,`valueId: ${a} | null`),Il("valueId"))}return U(Ve,`{${L}, ${L}ById, children}: `+Q+" & {children: React.ReactNode}",["{",Ht,"return (","<Context."+Ve,"value={useMemo(",`() => [${L} ?? contextValue[0], {...contextValue[1], ...${L}ById}],`,`[${L}, ${L}ById, contextValue],`,")}>","{children}",`</Context.${Ve}>`,");","}"],"Wraps part of an application in a context that provides default objects to be used by hooks and components within"),[d(...v(0),...V(),..._(0)),d(...v(1),...x(),..._(1))]},$l=(e,t,a)=>{if(Z(e)&&Z(t))return[l,l,l,l];const[n,o,d,s]=Jt(e,t,a);return[n,o,...cl(e,t,a,d,s)]},il={parser:"typescript",singleQuote:!0,trailingComma:"all",bracketSpacing:!1,jsdocSingleLineComment:!1},ul=Ot((e=>{const t=()=>{const t=O(e.getTablesSchemaJson());return!Z(t)||T(e.getTableIds(),(l=>{const a=e.getRowIds(l),n=X();if(T(a,(t=>T(e.getCellIds(l,t),(a=>{const o=e.getCell(l,t,a),d=ae(n,a,(()=>[z(o),X(),[0],0])),[s,r,[I]]=d,c=ae(r,o,(()=>0))+1;return c>I&&(d[2]=[c,o]),le(r,o,c),d[3]++,s==z(o)})))))return t[l]={},q(n,(([e,,[,n],o],r)=>{t[l][r]={[d]:e,...o==R(a)?{[s]:n}:{}}})),1}))?t:{}},l=()=>{const t=O(e.getValuesSchemaJson());return Z(t)&&e.forEachValue(((e,l)=>{t[e]={[d]:z(l)}})),t},a=e=>$l(t(),l(),e),n=async e=>{const t=["d.ts","ts","d.ts","tsx"];let l;try{l=(await import("prettier")).format}catch(e){l=e=>e}return x(a(e),((e,a)=>Tt(l(e,{...il,filepath:"_."+t[a]}))))};return F({getStoreStats:t=>{let l=0,a=0,n=0;const o={};return e.forEachTable(((e,d)=>{l++;let s=0,r=0;const I={};d(((e,l)=>{s++;let a=0;l((()=>a++)),r+=a,t&&(I[e]={rowCells:a})})),a+=s,n+=r,t&&(o[e]={tableRows:s,tableCells:r,rows:I})})),{totalTables:l,totalRows:a,totalCells:n,totalValues:R(e.getValueIds()),jsonLength:vt(e.getJson()),...t?{detail:{tables:o}}:{}}},getStoreTablesSchema:t,getStoreValuesSchema:l,getStoreApi:a,getPrettyStoreApi:n,getStore:()=>e})}));e.createTools=ul},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseTools={});
