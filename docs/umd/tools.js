var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,l="",a=t(l),n=t(!0),o=t(0),d="type",r="default",s="Listener",I="get",c="add",$="Ids",i="Table",u=i+"s",p=i+$,b="Row",C=b+$,h="Sorted"+b+$,g="Cell",m=g+$,f="Value",w=f+"s",y=f+$,T=(e,t)=>e.every(t),v=(e,t)=>e.sort(t),V=(e,t)=>e.forEach(t),x=(e,t)=>e.map(t),R=e=>e.length,k=e=>0==R(e),S=(e,t)=>e.filter(t),P=(e,...t)=>e.push(...t),A=e=>e.pop(),E=(e,...t)=>e.unshift(...t),D=e=>e.shift(),O=JSON.parse,N=isFinite,j=(e,t)=>e instanceof t,L=e=>null==e,M=e=>e==a||e==n,G=e=>t(e)==a,J=e=>Array.isArray(e),z=e=>{const l=t(e);return M(l)||l==o&&N(e)?l:void 0},W=(e,t)=>e?.has(t)??!1,B=e=>[...e?.values()??[]],F=(e,t)=>e?.forEach(t),U=(e,t)=>e?.delete(t),_=e=>new Map(e),Z=(e,t)=>e?.get(t),H=(e,t)=>F(e,((e,l)=>t(l,e))),Q=(e,t)=>x([...e?.entries()??[]],(([e,l])=>t(l,e))),q=(e,t,l)=>L(l)?(U(e,t),e):e?.set(t,l),K=(e,t,l)=>(W(e,t)||q(e,t,l()),Z(e,t)),X=e=>e.toUpperCase(),Y=e=>e.toLowerCase(),ee="a ",te="A function for",le=", and registers a listener so that any changes to that result will cause a re-render",ae="Callback",ne="Del",oe="Deps",de=oe+"?: React.DependencyList",re="doRollback?: DoRollback",se="actions: () => Return, "+re,Ie="export",ce="Id",$e="Invalid",ie="Json",ue=Y(s),pe="?: ",be=" | undefined",Ce="NonNullable",he="Partial",ge="Props",me="Provider",fe=`Registers a ${ue} that will be called`,we="Represents",ye="rowId: "+ce,Te="Schema",ve="Set",Ve=", descending?: boolean, offset?: number, limit?: number",xe="[]",Re="the Store",ke="Transaction",Se=Y(ke),Pe="Execute a "+Se+" to make multiple mutations",Ae="Explicitly starts a "+Se,Ee="Explicitly finishes a "+Se,De="the end of the "+Se,Oe="void",Ne=" => "+Oe,je="WhenSet",Le=" when setting it",Me=ee+"string serialization of",Ge=" ",Je="Gets a callback that can ",ze="the ",We=" the schema for",Be=(e=0,t=0)=>`the ${rt[e]}content of`+(t?Ge+Re:l),Fe=(e=0,t,a=0)=>nt[t]+Ge+Be(e,1)+(a?" when setting it":l),Ue=(e,t=0)=>we+` a Row when ${t?"s":"g"}etting ${Be()} the '${e}' `+i,_e=(e,t,l=0)=>`Gets ${l?"sorted, paginated":"the"} Ids of the ${e}s in `+t,Ze=(e,t)=>`Calls a function for each ${e} in `+t,He=e=>"The props passed to a component that renders "+e,Qe=e=>"A function that takes "+e,qe=(e,t=0)=>te+" listening to changes to "+dt[e]+" in "+dt[t],Ke=(e,t,a=0)=>fe+" whenever "+dt[e]+" in "+dt[t]+" change"+(a?l:"s"),Xe=e=>`the '${e}' `+i,Ye=e=>"the specified Row in "+Xe(e),et=(e,t=0)=>nt[t]+` ${Be()} `+Xe(e),tt=(e,t=0)=>nt[t]+` ${Be()} `+Ye(e),lt=(e,t,l=0)=>nt[l]+` the '${t}' Cell for `+Ye(e),at=(e,t=0)=>nt[t]+` the '${e}' Value`,nt=["Gets","Checks existence of","Sets","Deletes","Sets part of",we,"Gets "+Me,"Sets "+Me,fe+" whenever",Je+"set",Je+"add",Je+"set part of",Je+"delete","Renders","Gets "+Me+We,"Sets"+We,"Deletes"+We],ot=[I,"has","set","del","set","forEach",c,l],dt=[Re,u,ze+i+Ge+$,ee+i,ze+b+Ge+$,ee+b,ze+g+Ge+$,ee+g,"invalid Cell changes",w,ze+f+Ge+$,ee+f,"invalid Value changes",ze+"sorted "+b+Ge+$],rt=[l,"tabular ","keyed value "],st=e=>new Set(J(e)||L(e)?e:[e]),It=(e,t)=>e?.add(t),ct=/[^A-Za-z]+/,$t=/[^A-Za-z0-9]+/,it=/^( *)\/\*\* *(.*?) *\*\/$/gm,ut=(e,t,l)=>e.substring(t,l),pt=e=>e.includes(","),bt=(e,t,l,a=1)=>{const n=`${t}${1==a?"":a}`;return W(e,n)?bt(e,t,l,a+1):(q(e,n,l),n)},Ct=e=>e.replace(it,((e,t,l)=>{const a=77-ht(t);return`${t}/**\n${l.replace(RegExp(`([^\\n]{1,${a}})(\\s|$)`,"g"),t+" * $1\n")}${t} */`})),ht=e=>e.length,gt=(e,t=l)=>e.join(t),mt=e=>e.flat(1e3),ft=(e,t=0)=>gt(x(e.split($t),((e,l)=>(l>0||t?X:Y)(ut(e,0,1))+ut(e,1)))),wt=e=>X(gt((e&&!ct.test(e[0])?e:" "+e).split($t),"_")),yt=e=>`/** ${e}. */`,Tt=(...e)=>gt(S(e,(e=>e)),", "),vt=(...e)=>"{"+gt(e,"; ")+"}",Vt=(...e)=>vt(...x(e,(e=>"readonly "+e))),xt=()=>{const e=[_(),_(),_(),_()],t=_(),a=_();return[(...e)=>gt(mt(e),"\n"),(t,l,...a)=>V(a,(a=>V([0,1],(n=>(t??n)==n?It(K(e[n],l,st),a):0)))),(e,a,n,o=l,d=1)=>bt(t,e,[a,n,o,d]),(e,t,l)=>bt(a,e,J(l)?[`(${t}) => {`,l,"}"]:[`(${t}) => ${l}`]),(e,t)=>Z(a,e)===t?e:bt(a,e,t),(t=0)=>x([...v(Q(e[t],((e,t)=>`import {${gt(v(B(e)),", ")}} from '${t}';`)),((e,t)=>pt(e)!=pt(t)?pt(e)?-1:1:e>t?1:-1)),l],(e=>e.replace("{React}","React"))),()=>Q(t,(([e,t,a,n],o)=>[yt(t),`${n?Ie+" ":l}type ${o}${a} = ${e};`,l])),()=>Q(a,((e,t)=>(e=J(e)?e:[e],P(e,A(e)+";"),[`const ${t} = ${D(e)}`,e,l])))]},Rt=Object,kt=Rt.keys,St=Rt.freeze,Pt=e=>j(e,Rt)&&e.constructor==Rt,At=(e,t)=>x(Rt.entries(e),(([e,l])=>t(l,e))),Et=e=>Pt(e)&&k(kt(e)),Dt=e=>{const t=new WeakMap;return l=>(t.has(l)||t.set(l,e(l)),t.get(l))},Ot=(e,t,l)=>[t=>At(e,((e,a)=>t(a,ft(a,1),l(wt(a),`'${a}'`)))),(t,a)=>At(e[t],((e,t)=>a(t,e[d],e[r],l(wt(t),`'${t}'`),ft(t,1)))),e=>At(t,((t,a)=>e(a,t[d],t[r],l(wt(a),`'${a}'`),ft(a,1))))],Nt=(e,t,a,n)=>[(n,o)=>{const d=n+": "+o,r=e(u,vt(...t((e=>`'${e}'?: {[rowId: Id]: `+vt(...a(e,((e,t,a)=>`'${e}'${L(a)?"?":l}: ${t}`)))+"}"))),Fe(1,5)),I=e(u+je,vt(...t((e=>`'${e}'?: {[rowId: Id]: `+vt(...a(e,((e,t)=>`'${e}'?: ${t}`)))+"}"))),Fe(1,5,1)),c=e(i+ce,"keyof "+r,"A "+i+" Id in "+Re),$=`<TId extends ${c}>`,f=e(i,Ce+`<${r}[TId]>`,"A "+i+" in "+Re,$),w=e(i+je,Ce+`<${I}[TId]>`,"A "+i+" in "+Re+Le,$),y=e(b,f+"<TId>[Id]","A "+b+" in a "+i,$),T=e(b+je,w+"<TId>[Id]","A "+b+" in a "+i+Le,$),v=e(g+ce,`Extract<keyof ${y}<TId>, Id>`,"A "+g+" Id in a "+b,$),V=e(g,Ce+`<${r}[TId]>[Id][CId]`,"A "+g+" in a "+b,`<TId extends ${c}, CId extends ${v}<TId>>`),x=e("CellIdCellArray",`CId extends ${v}<TId> ? [cellId: CId, cell: ${V}<TId, CId>] : never`,g+" Ids and types in a "+b,`<TId extends ${c}, CId = ${v}<TId>>`,0),R=e(g+ae,`(...[cellId, cell]: ${x}<TId>)`+Ne,Qe(ee+g+" Id, and "+g),$),k=e(b+ae,"(rowId: Id, forEachCell: (cellCallback: CellCallback<TId>) "+Ne+") "+Ne,Qe(ee+b+" Id, and a "+g+" iterator"),$),S=e("TableIdForEachRowArray",`TId extends ${c} ? [tableId: TId, forEachRow: (rowCallback: ${k}<TId>)${Ne}] : never`,i+" Ids and callback types",`<TId = ${c}>`,0),P=e(i+ae,`(...[tableId, forEachRow]: ${S})`+Ne,Qe(ee+i+" Id, and a "+b+" iterator"),l),A=e("TableIdRowIdCellIdArray",`TId extends ${c} ? [tableId: TId, rowId: Id, cellId: ${v}<TId>] : never`,"Ids for GetCellChange",`<TId = ${c}>`,0),E=e("GetCellChange",`(...[tableId, rowId, cellId]: ${A}) => CellChange`,te+" returning information about any Cell's changes during a "+Se),D=e(u+s,`(${d}, getCellChange: ${E}${be})`+Ne,qe(1)),O=e(p+s,`(${d})`+Ne,qe(2)),N=e(i+s,`(${d}, tableId: ${c}, getCellChange: ${E}${be})`+Ne,qe(3)),j=e(C+s,`(${d}, tableId: ${c})`+Ne,qe(4,3)),M=e(h+s,"("+Tt(d,"tableId: "+c,"cellId: Id"+be,"descending: boolean","offset: number","limit: number"+be,"sortedRowIds: Ids")+")"+Ne,qe(13,3)),G=e(b+s,"("+Tt(""+d,"tableId: "+c,ye,`getCellChange: ${E}${be}`)+")"+Ne,qe(5,3)),J=e(m+s,"("+Tt(""+d,"tableId: "+c,ye)+")"+Ne,qe(6,5)),z=e("CellListenerArgsArrayInner",`CId extends ${v}<TId> ? [${d}, tableId: TId, ${ye}, cellId: CId, newCell: ${V}<TId, CId> ${be}, oldCell: ${V}<TId, CId> ${be}, getCellChange: ${E} ${be}] : never`,"Cell args for CellListener",`<TId extends ${c}, CId = ${v}<TId>>`,0),W=e("CellListenerArgsArrayOuter",`TId extends ${c} ? `+z+"<TId> : never","Table args for CellListener",`<TId = ${c}>`,0);return[r,I,c,f,w,y,T,v,V,R,k,P,D,O,N,j,M,G,J,e(g+s,`(...[${n}, tableId, rowId, cellId, newCell, oldCell, getCellChange]: ${W})`+Ne,qe(7,5)),e($e+g+s,`(${d}, tableId: Id, ${ye}, cellId: Id, invalidCells: any[])`+Ne,qe(8))]},(t,a)=>{const o=t+": "+a,d=e(w,vt(...n(((e,t,a)=>`'${e}'${L(a)?"?":l}: ${t}`))),Fe(2,5)),r=e(w+je,vt(...n(((e,t)=>`'${e}'?: ${t}`))),Fe(2,5,1)),I=e(f+ce,"keyof "+d,"A "+f+" Id in "+Re),c=e(f,Ce+`<${d}[VId]>`,"A "+f+" Id in "+Re,`<VId extends ${I}>`),$=e("ValueIdValueArray",`VId extends ${I} ? [valueId: VId, value: ${c}<VId>] : never`,f+" Ids and types in "+Re,`<VId = ${I}>`,0),i=e(f+ae,`(...[valueId, value]: ${$})`+Ne,Qe(ee+f+" Id, and "+f)),u=e("GetValueChange",`(valueId: ${I}) => ValueChange`,te+" returning information about any Value's changes during a "+Se),p=e(w+s,`(${o}, getValueChange: ${u}${be})`+Ne,qe(9)),b=e(y+s,`(${o})`+Ne,qe(10)),C=e("ValueListenerArgsArray",`VId extends ${I} ? [${o}, valueId: VId, newValue: ${c}<VId> ${be}, oldValue: ${c}<VId> ${be}, getValueChange: ${u} ${be}] : never`,"Value args for ValueListener",`<VId = ${I}>`,0);return[d,r,I,c,i,p,b,e(f+s,`(...[${t}, valueId, newValue, oldValue, getValueChange]: `+C+")"+Ne,qe(11)),e($e+f+s,`(${o}, valueId: Id, invalidValues: any[])`+Ne,qe(12))]},(t,l)=>e(ke+s,`(${t}: ${l}, cellsTouched: boolean, valuesTouched: boolean)`+Ne,te+" listening to the completion of a "+Se)],jt=(e,t=l,a=l)=>`store.${e}(${t})`+(a?" as "+a:l),Lt=(e,t=l)=>`fluent(() => ${jt(e,t)})`,Mt=(e,t=l,a=l)=>`store.${e}(${t?t+", ":l}proxy(listener)${a?", "+a:l})`,Gt=(e,t,a)=>{const[o,I,T,v,x,R,k,S]=xt(),[A,D,O]=Ot(e,t,x),[N,j,M]=Nt(T,A,D,O),J=_(),z=(e=0)=>Q(J,(([t,a,n,o,d],r)=>{const s=e?[r+`: ${d}(${t}): ${a} => ${n},`]:[r+d+`(${t}): ${a};`];return e||E(s,yt(o)),P(s,l),s})),W=(e,t,a,n,o,d=l)=>bt(J,e,[t,a,n,o,d]),F=(e,t,a,n,o,d=l,r=l,s=l)=>W(ot[e]+t+(4==e?he:l)+a,d,n,(n==X?Lt:jt)(ot[e]+(4==e?he:l)+a,r,e?void 0:n),o,s),U=(e,t,a,n=l,o=l,d=1,r=l)=>W(c+e+s,(n?n+", ":l)+ue+": "+t+(d?", mutator?: boolean":l),ce,Mt(c+e+s,o,d?"mutator":l),a,r),K=`./${ft(a)}.d`,X=ft(a,1),Y=ft(X),ee=[],te=_();let le=[],ne=[];if(I(1,K,X,`create${X} as create${X}Decl`),!Et(e)){I(0,"tinybase","CellChange"),I(null,"tinybase",$);const[e,t,a,o,s,c,f,w,y,v,R,k,S,E,O,j,M,J,z,W,H]=N(Y,X),Q=_();A(((e,t)=>{const l=`<'${e}'>`,a=[T(t+i,o+l,we+` the '${e}' `+i),T(t+i+je,s+l,we+` the '${e}' `+i+Le),T(t+b,c+l,Ue(e)),T(t+b+je,f+l,Ue(e,1)),T(t+g+ce,w+l,`A Cell Id for the '${e}' `+i),T(t+g+ae,v+l,Qe(`a Cell Id and value from a Row in the '${e}' `+i)),T(t+b+ae,R+l,Qe(`a Row Id from the '${e}' Table, and a Cell iterator`))];q(Q,e,a),I(1,K,...a)})),I(1,K,e,t,a,w,k,S,E,O,j,M,J,z,W,H),le=[e,t,a,w,S,E,O,j,M,J,z,W,Q],V([[e],[n],[X,"tables: "+t,"tables"],[X]],(([e,t,a],n)=>F(n,l,u,e,Fe(1,n),t,a))),F(0,l,p,a+xe,_e(i,Re)),F(5,l,i,Oe,Ze(i,Re),"tableCallback: "+k,"tableCallback as any"),A(((e,t,a)=>{const[o,d,r,s,I,c,u]=Z(Q,e);V([[o],[n],[X,"table: "+d,", table"],[X]],(([n,o,d=l],r)=>F(r,t,i,n,et(e,r),o,a+d))),F(0,t,C,$,_e(b,Xe(e)),l,a),F(0,t,h,$,_e(b,Xe(e),1),"cellId?: "+I+Ve,a+", cellId, descending, offset, limit"),F(5,t,b,Oe,Ze(b,Xe(e)),"rowCallback: "+u,a+", rowCallback as any"),V([[r],[n],[X,", row: "+s,", row"],[X],[X,", partialRow: "+s,", partialRow"]],(([n,o=l,d=l],r)=>F(r,t,b,n,tt(e,r),ye+o,a+", rowId"+d))),F(6,t,b,ce+be,"Add a new Row to "+Xe(e),"row: "+s,a+", row"),F(0,t,m,I+xe,_e(g,Ye(e)),ye,a+", rowId"),F(5,t,g,Oe,Ze(g,Ye(e)),ye+", cellCallback: "+c,a+", rowId, cellCallback as any"),D(e,((o,d,r,s,I)=>{const c="Map"+ft(d,1);q(te,d,c);const $=d+(L(r)?be:l);V([[$],[n],[X,`, cell: ${d} | `+c,", cell as any"],[X]],(([n,d=l,r=l],c)=>F(c,t+I,g,n,lt(e,o,c),ye+d,a+", rowId, "+s+r)))}))})),F(0,l,u+ie,ie,Fe(1,6)),F(2,l,u+ie,X,Fe(1,7),"tablesJson: "+ie,"tables"+ie),U(u,S,Fe(1,8)+" changes"),U(p,E,Ke(2,0,1)),U(i,O,Ke(3,0),`tableId: ${a} | null`,"tableId"),U(C,j,Ke(4,3,1),`tableId: ${a} | null`,"tableId"),U(h,M,Ke(13,3,1),Tt("tableId: TId",`cellId: ${w}<TId>`+be,"descending: boolean","offset: number","limit: number"+be),Tt("tableId","cellId","descending","offset","limit"),1,"<TId extends TableId>"),U(b,J,Ke(5,3),`tableId: ${a} | null, rowId: IdOrNull`,"tableId, rowId"),U(m,z,Ke(6,5,1),`tableId: ${a} | null, rowId: IdOrNull`,"tableId, rowId"),U(g,W,Ke(7,5),`tableId: ${a} | null, rowId: IdOrNull, cellId: ${gt(A((e=>Z(Q,e)?.[4]??l))," | ")} | null`,"tableId, rowId, cellId"),U($e+g,H,fe+" whenever an invalid Cell change was attempted","tableId: IdOrNull, rowId: IdOrNull, cellId: IdOrNull","tableId, rowId, cellId"),I(1,K,...B(te)),P(ee,".set"+u+Te+"({",mt(A(((e,t,a)=>[`[${a}]: {`,...D(e,((e,t,a,n)=>`[${n}]: {[${x(wt(d),`'${d}'`)}]: ${x(wt(t),`'${t}'`)}${L(a)?l:`, [${x(wt(r),`'${r}'`)}]: `+(G(a)?x(wt(a),`'${a}'`):a)}},`)),"},"]))),"})")}if(!Et(t)){const[e,t,a,o,s,c,$,i,u]=j(Y,X);I(1,K,e,t,a,s,c,$,i,u),ne=[e,t,a,c,$,i],V([[e],[n],[X,"values: "+t,"values"],[X],[X,"partialValues: "+t,"partialValues"]],(([e,t,a],n)=>F(n,l,w,e,Fe(2,n),t,a))),F(0,l,y,a+xe,_e(f,Re)),F(5,l,f,"void",Ze(f,Re),"valueCallback: "+s,"valueCallback as any"),O(((e,t,a,o,d)=>{const r="Map"+ft(t,1);q(te,t,r),V([[t],[n],[X,`value: ${t} | `+r,", value as any"],[X]],(([t,a,n=l],r)=>F(r,d,f,t,at(e,r),a,o+n)))})),F(0,l,w+ie,ie,Fe(2,6)),F(2,l,w+ie,X,Fe(2,7),"valuesJson: "+ie,"values"+ie),U(w,c,Fe(2,8)+" changes"),U(y,$,Ke(10,0,1)),U(f,i,Ke(11,0),`valueId: ${a} | null`,"valueId"),U($e+f,u,fe+" whenever an invalid Value change was attempted","valueId: IdOrNull","valueId"),I(1,K,...B(te)),I(0,"tinybase","ValueChange"),P(ee,".set"+w+Te+"({",O(((e,t,a,n)=>[`[${n}]: {[${x(wt(d),`'${d}'`)}]: ${x(wt(t),`'${t}'`)}${L(a)?l:`, [${x(wt(r),`'${r}'`)}]: `+(G(a)?x(wt(a),`'${a}'`):a)}},`])),"})")}H(te,((e,t)=>T(t,`(cell: ${e}${be}) => `+e,`Takes a ${e} Cell value and returns another`))),I(null,"tinybase","DoRollback",ce,"IdOrNull",ie,"Store"),F(0,l,ie,ie,Fe(0,6)),F(2,l,ie,X,Fe(0,7),"tablesAndValuesJson: "+ie,"tablesAndValuesJson"),F(7,l,Se,"Return",Pe,se,"actions, doRollback","<Return>"),F(7,l,"start"+ke,X,Ae),F(7,l,"finish"+ke,X,Ee,re,"doRollback");const oe=M(Y,X);return U("WillFinish"+ke,oe,fe+" just before "+De,l,l,0),U("DidFinish"+ke,oe,fe+" just after "+De,l,l,0),F(7,l,"call"+s,X,"Manually provoke a listener to be called","listenerId: Id","listenerId"),F(3,l,s,X,"Remove a listener that was previously added to "+Re,"listenerId: Id","listenerId"),W("getStore",l,"Store","store",nt[0]+" the underlying Store object"),I(1,"tinybase","createStore"),I(1,K,X,`create${X} as create${X}Decl`,oe),x("store",["createStore()",...ee]),v("fluent","actions: () => Store",["actions();",`return ${Y};`]),v("proxy","listener: any",`(_: Store, ...params: any[]) => listener(${Y}, ...params)`),x(Y,["{",...z(1),"}"]),[o(...R(0),...k(),Ie+" interface "+X+" {",...z(0),"}",l,yt(`Creates a ${X} object`),Ie+" function create"+X+"(): "+X+";"),o(...R(1),Ie+" const create"+X+": typeof create"+X+"Decl = () => {",...S(),`return Object.freeze(${Y});`,"};"),le,ne]},Jt=e=>I+e,zt=e=>Tt(Jt(e),Jt(e)+oe),Wt="debugIds?: boolean",Bt="debugIds={debugIds}",Ft="then"+de,Ut="Parameter",_t=": (parameter: "+Ut+", store: Store) => ",Zt="const contextValue = useContext(Context);",Ht=", based on a parameter",Qt=": ",qt="<"+Ut+",>",Kt=Ut+"ized"+ae+"<"+Ut+">",Xt="rowId",Yt="rowId={rowId}",el=", separator, debugIds",tl="separator?: ReactElement | string",ll="then?: (store: Store",al=Tt(ll+")"+Ne,Ft),nl="then, then"+oe,ol=Xt+Qt+ce,dl="View",rl=(e,...t)=>Tt(...t,ue+": "+e,ue+de,"mutator?: boolean"),sl=(...e)=>Tt(...e,ue,ue+oe,"mutator"),Il=(e,t,a,n,o)=>{const[d,r,I,c,T,v,V,x]=xt(),[R,k,S]=Ot(e,t,T),A=`./${ft(a)}.d`,D=`./${ft(a)}-ui-react.d`,O="tinybase/ui-react",N=ft(a,1),j=ft(N),M=N+"Or"+N+ce,G=j+"Or"+N+ce,J=j+`={${j}}`,z=_(),W=(e,t,a,n,o,d=l)=>(r(1,D,e+" as "+e+"Decl"),bt(z,e,[t,a,n,o,d])),B=(e,t,a,n,o,d=l)=>W("use"+e,t,a,n,o,d),F=(e,t,a,n,o=l,d=l,s=l,I=l,c=l)=>(r(1,O,`use${t} as use${t}Core`),B(e,Tt(o,X,I),a,te+`(${G}, use${t}Core, [`+(d||l)+(c?"], ["+c:l)+"]);",n,s)),U=(e,t,l,a)=>W(e,t,1,l,a),H=(e=0)=>Q(z,(([t,a,n,o,d],r)=>{const s=e?[Ie+` const ${r}: typeof ${r}Decl = ${d}(${t}): ${1==a?"any":a} =>`,n]:[Ie+` function ${r}${d}(${t}): ${1==a?"ComponentReturnType":a};`];return e||E(s,yt(o)),P(s,l),s}));r(null,"tinybase",ce,"Store",ae,Ut+"ized"+ae),r(0,O,"ComponentReturnType"),r(null,O,"ExtraProps"),r(0,A,N);const q=I(M,N+" | "+ce,`Used when you need to refer to a ${N} in a React hook or component`),K=I(me+ge,Vt(j+pe+N,j+`ById?: {[${j}Id: Id]: ${N}}`),`Used with the ${me} component, so that a `+N+" can be passed into the context of an application");r(0,"react","ReactElement","ComponentType"),r(1,"react","React"),r(1,D,q,K);const X=G+pe+q;T("{createContext, useContext, useMemo}","React"),T("Context",`createContext<[${N}?, {[${j}Id: Id]: ${N}}?]>([])`),B("Create"+N,`create: () => ${N}, create`+de,N,"\n// eslint-disable-next-line react-hooks/exhaustive-deps\nuseMemo(create, createDeps)",`Create a ${N} within a React application with convenient memoization`);const Y=B(N,"id?: Id",N+be,["{",Zt,"return id == null ? contextValue[0] : contextValue[1]?.[id];","}"],`Get a reference to a ${N} from within a ${me} component context`),te=c("useHook",G+`: ${q} | undefined, hook: (...params: any[]) => any, preParams: any[], postParams: any[] = []`,[`const ${j} = ${Y}(${G} as Id);`,`return hook(...preParams, ((${G} == null || typeof ${G} == 'string')`,`? ${j} : ${G})?.getStore(), ...postParams)`]),oe=c("getProps","getProps: ((id: any) => ExtraProps) | undefined, id: Id","(getProps == null) ? ({} as ExtraProps) : getProps(id)"),re=c("wrap",Tt("children: any","separator?: any","encloseWithId?: boolean","id?: Id"),["const separated = separator==null || !Array.isArray(children)"," ? children"," : children.map((child, c) => (c > 0 ? [separator, child] : child));","return encloseWithId ? [id, ':{', separated, '}'] : separated;"]),se=T("NullComponent","() => null");if(!Et(e)){const[e,t,a,o,d,f,w,y,T,v,V,x,S]=n;r(null,A,e,t,a,d,f,w,y,T,v,V,x),r(0,A,o),r(1,A,N),r(null,"tinybase",$,"IdOrNull");const P=c("tableView",`{${j}, rowComponent, getRowComponentProps`+el+"}: any, rowIds: Ids, tableId: Id, defaultRowComponent: React.ComponentType<any>",["const Row = rowComponent ?? defaultRowComponent;",`return ${re}(rowIds.map((rowId) => (`,"<Row","{..."+oe+"(getRowComponentProps, rowId)}","key={rowId}","tableId={tableId}",Yt,J,Bt,"/>","))",el,", tableId,",");"]),E=c("getDefaultTableComponent","tableId: Id",gt(R(((e,t,l)=>`tableId == ${l} ? ${t}TableView : `)))+se),O=c("getDefaultCellComponent","tableId: Id, cellId: Id",gt(R(((e,t,l)=>`tableId == ${l} ? ${gt(k(e,((e,l,a,n,o)=>`cellId == ${n} ? `+t+o+"CellView : ")))+se} : `)))+se);F(u,u,e,Fe(1,0)+le);const M=F(p,p,a+xe,_e(i,Re)+le);F(ve+u+ae,ve+u+ae,Kt,Fe(1,9)+Ht,Tt(Jt(u)+_t+t,Jt(u)+de),zt(u),qt,Tt(ll,`tables: ${t})`+Ne,Ft),nl),F(ne+u+ae,ne+u+ae,ae,Fe(1,12),l,l,l,al,nl);const G=I(g+ge,Vt("tableId?: TId","rowId: Id","cellId?: CId",j+pe+N,Wt),He(ee+g),`<TId extends ${a}, CId extends ${o}<TId>>`),z=I(b+ge,Vt("tableId?: TId","rowId: Id",j+pe+N,"cellComponents?: {readonly [CId in "+o+`<TId>]?: ComponentType<${G}<TId, CId>>;}`,`getCellComponentProps?: (cellId: ${o}<TId>) => ExtraProps`,tl,Wt),He(ee+b),`<TId extends ${a}>`),W=I(i+ge,Vt("tableId?: TId",j+pe+N,`rowComponent?: ComponentType<${z}<TId>>`,"getRowComponentProps?: (rowId: Id) => ExtraProps",tl,Wt),He(ee+i),`<TId extends ${a}>`),B=I("Sorted"+i+ge,Vt("tableId?: TId","cellId?: "+o+"<TId>","descending?: boolean","offset?: number","limit?: number",j+pe+N,`rowComponent?: ComponentType<${z}<TId>>`,"getRowComponentProps?: (rowId: Id) => ExtraProps",tl,Wt),He(ee+"sorted "+i),`<TId extends ${a}>`),_=I(u+ge,Vt(j+pe+N,"tableComponents?: {readonly [TId in "+a+`]?: ComponentType<${W}<TId>>;}`,`getTableComponentProps?: (tableId: ${a}) => ExtraProps`,tl,Wt),He(Be(1,1)));r(1,D,_,W,B,z,G),U(u+dl,"{"+j+", tableComponents, getTableComponentProps"+el+"}: "+_,[re+`(${M}(${j}).map((tableId) => {`,"const Table = (tableComponents?.[tableId] ?? "+E+"(tableId)) as React.ComponentType<TableProps<typeof tableId>>;","return <Table",`{...${oe}(getTableComponentProps, tableId)}`,"tableId={tableId}","key={tableId}",J,Bt,"/>;","}), separator)"],Fe(1,13)+le),R(((e,t,a)=>{const[n,o,d,s,I]=Z(S,e);r(null,A,n,o,d,s,I),F(t+i,i,n,et(e)+le,l,a);const c=F(t+C,C,$,_e(b,Xe(e))+le,l,a),u=F(t+h,h,$,_e(b,Xe(e),1)+le,"cellId?: "+I+", descending?: boolean, offset?: number, limit?: number",a+", cellId, descending, offset, limit");F(t+b,b,d,tt(e)+le,ol,Tt(a,Xt));const p=F(t+m,m,I+xe,_e(g,Ye(e))+le,ol,Tt(a,Xt));F(ve+t+i+ae,ve+i+ae,Kt,et(e,9)+Ht,Tt(Jt(i)+_t+o,Jt(i)+de),Tt(a,zt(i)),qt,Tt(ll,`table: ${o})`+Ne,Ft),nl),F(ne+t+i+ae,ne+i+ae,ae,et(e,12),l,a,l,al,nl),F(ve+t+b+ae,ve+b+ae,Kt,tt(e,9)+Ht,Tt(ol,Jt(b)+_t+s,Jt(b)+de),Tt(a,Xt,zt(b)),qt,Tt(ll,`row: ${s})`+Ne,Ft),nl),F("Add"+t+b+ae,"Add"+b+ae,Kt,tt(e,10)+Ht,Tt(Jt(b)+_t+s,Jt(b)+de),Tt(a,zt(b)),qt,"then?: ("+Tt(ol+be,"store: Store","row: "+s+")"+Ne,"then"+de),nl),F(ve+t+he+b+ae,ve+he+b+ae,Kt,tt(e,11)+Ht,Tt(ol,Jt(he+b)+_t+s,Jt(he+b)+de),Tt(a,Xt,zt(he+b)),qt,Tt(ll,`partialRow: ${s})`+Ne,Ft),nl),F(ne+t+b+ae,ne+b+ae,ae,tt(e,12),ol,Tt(a,Xt),l,al,nl);const f=U(t+b+dl,"{rowId, "+j+", cellComponents, getCellComponentProps"+el+`}: ${z}<'${e}'>`,[re+`(${p}(rowId, ${j}).map((cellId) => {`,"const Cell = (cellComponents?.[cellId] ?? "+O+`(${a}, cellId)) as React.ComponentType<CellProps<typeof `+a+", typeof cellId>>;","return <Cell",`{...${oe}(getCellComponentProps, cellId)} `,"key={cellId}",`tableId={${a}}`,Yt,"cellId={cellId}",J,Bt,"/>;","})"+el+", rowId)"],tt(e,13)+le);U(t+"Sorted"+i+dl,"{cellId, descending, offset, limit, ...props}: "+B+`<'${e}'>`,P+"(props, "+u+`(cellId, descending, offset, limit, props.${j}), ${a}, ${f});`,et(e,13)+", sorted"+le),U(t+i+dl,`props: ${W}<'${e}'>`,P+"(props, "+c+`(props.${j}), ${a}, ${f});`,et(e,13)+le),k(e,((n,o,d,s,I)=>{const c="Map"+ft(o,1);r(0,A,c),r(1,A,c);const $=F(t+I+g,g,o+(L(d)?be:l),lt(e,n)+le,ol,Tt(a,Xt,s));F(ve+t+I+g+ae,ve+g+ae,Kt,lt(e,n,9)+Ht,Tt(ol,Jt(g)+_t+o+" | "+c,Jt(g)+de),Tt(a,Xt,s,zt(g)),qt,Tt(ll,`cell: ${o} | ${c})`+Ne,Ft),nl),F(ne+t+I+g+ae,ne+g+ae,ae,lt(e,n,12),Tt(ol,"forceDel?: boolean"),Tt(a,Xt,s,"forceDel"),l,al,nl),U(t+I+g+dl,`{rowId, ${j}, debugIds}: `+G+`<'${e}', '${n}'>`,[re+`('' + ${$}(rowId, `+j+`) ?? '', undefined, debugIds, ${s})`],lt(e,n,13)+le)}))}));const H=gt(R((e=>Z(S,e)?.[4]??l))," | ");F(u+s,u+s,Oe,Fe(1,8)+" changes",rl(d),sl()),F(p+s,p+s,Oe,Ke(2,0,1),rl(f),sl()),F(i+s,i+s,Oe,Ke(3,0),rl(w,`tableId: ${a} | null`),sl("tableId")),F(C+s,C+s,Oe,Ke(4,3,1),rl(y,`tableId: ${a} | null`),sl("tableId")),F(h+s,h+s,Oe,Ke(13,3,1),rl(T,`tableId: ${a} | null`,"cellId: "+H+be,"descending: boolean","offset: number","limit: number"+be),sl("tableId","cellId","descending","offset","limit")),F(b+s,b+s,Oe,Ke(5,3),rl(v,`tableId: ${a} | null`,Xt+": IdOrNull"),sl("tableId",Xt)),F(m+s,m+s,Oe,Ke(6,5,1),rl(V,`tableId: ${a} | null`,Xt+": IdOrNull"),sl("tableId",Xt)),F(g+s,g+s,Oe,Ke(7,5),rl(x,`tableId: ${a} | null`,Xt+": IdOrNull",`cellId: ${H} | null`),sl("tableId",Xt,"cellId"))}if(!Et(t)){const[e,t,a,n,d,$]=o;r(null,A,...o),r(1,A,N);const i=c("getDefaultValueComponent","valueId: Id",gt(S(((e,t,l,a,n)=>`valueId == ${a} ? `+n+"ValueView : ")))+se);F(w,w,e,Fe(2,0)+le);const u=F(y,y,a+xe,_e(f,Re)+le);F(ve+w+ae,ve+w+ae,Kt,Fe(2,9)+Ht,Tt(Jt(w)+_t+t,Jt(w)+de),zt(w),qt,Tt(ll,`values: ${t})`+Ne,Ft),nl),F(ve+he+w+ae,ve+he+w+ae,Kt,Fe(2,11)+Ht,Tt(Jt(he+w)+_t+t,Jt(he+w)+de),zt(he+w),qt,Tt(ll,`partialValues: ${t})`+Ne,Ft),nl),F(ne+w+ae,ne+w+ae,ae,Fe(2,12),l,l,l,al,nl);const p=I(f+ge,Vt("valueId?: VId",j+pe+N,Wt),He("a Value"),`<VId extends ${a}>`),b=I(w+ge,Vt(j+pe+N,"valueComponents?: {readonly [VId in "+a+`]?: ComponentType<${p}<VId>>;}`,`getValueComponentProps?: (valueId: ${a}) => ExtraProps`,tl,Wt),He(Be(2,1)));r(1,D,b,p),U(w+dl,"{"+j+", valueComponents, getValueComponentProps"+el+"}: "+b,[re+`(${u}(${j}).map((valueId) => {`,"const Value = valueComponents?.[valueId] ?? "+i+"(valueId);","return <Value",`{...${oe}(getValueComponentProps, valueId)}`,"key={valueId}",J,Bt,"/>;","}), separator)"],Fe(2,13)+le),S(((e,t,a,n,o)=>{const d="Map"+ft(t,1);r(0,A,d),r(1,A,d);const s=F(o+f,f,t,at(e)+le,l,n);F(ve+o+f+ae,ve+f+ae,Kt,at(e,9)+Ht,Tt(Jt(f)+_t+t+" | "+d,Jt(f)+de),Tt(n,zt(f)),qt,Tt(ll,`value: ${t} | ${d})`+Ne,Ft),nl),F(ne+o+f+ae,ne+f+ae,ae,at(e,12),l,n,l,al,nl),U(o+f+dl,`{${j}, debugIds}: ${p}<'${e}'>`,[re+`('' + ${s}(`+j+`) ?? '', undefined, debugIds, ${n})`],at(e,13)+le)})),F(w+s,w+s,Oe,Fe(2,8)+" changes",rl(n),sl()),F(y+s,y+s,Oe,Ke(10,0,1),rl(d),sl()),F(f+s,f+s,Oe,Ke(11,0),rl($,`valueId: ${a} | null`),sl("valueId"))}return U(me,`{${j}, ${j}ById, children}: `+K+" & {children: React.ReactNode}",["{",Zt,"return (","<Context."+me,"value={useMemo(",`() => [${j} ?? contextValue[0], {...contextValue[1], ...${j}ById}],`,`[${j}, ${j}ById, contextValue],`,")}>","{children}",`</Context.${me}>`,");","}"],"Wraps part of an application in a context that provides default objects to be used by hooks and components within"),[d(...v(0),...V(),...H(0)),d(...v(1),...x(),...H(1))]},cl=(e,t,a)=>{if(Et(e)&&Et(t))return[l,l,l,l];const[n,o,d,r]=Gt(e,t,a);return[n,o,...Il(e,t,a,d,r)]},$l={parser:"typescript",singleQuote:!0,trailingComma:"all",bracketSpacing:!1,jsdocSingleLineComment:!1},il=Dt((e=>{const t=()=>{const t=O(e.getTablesSchemaJson());return!Et(t)||T(e.getTableIds(),(l=>{const a=e.getRowIds(l),n=_();if(T(a,(t=>T(e.getCellIds(l,t),(a=>{const o=e.getCell(l,t,a),d=K(n,a,(()=>[z(o),_(),[0],0])),[r,s,[I]]=d,c=K(s,o,(()=>0))+1;return c>I&&(d[2]=[c,o]),q(s,o,c),d[3]++,r==z(o)})))))return t[l]={},F(n,(([e,,[,n],o],s)=>{t[l][s]={[d]:e,...o==R(a)?{[r]:n}:{}}})),1}))?t:{}},l=()=>{const t=O(e.getValuesSchemaJson());return Et(t)&&e.forEachValue(((e,l)=>{t[e]={[d]:z(l)}})),t},a=e=>cl(t(),l(),e),n=async e=>{const t=["d.ts","ts","d.ts","tsx"];let l;try{l=(await import("prettier")).format}catch(e){l=e=>e}return x(a(e),((e,a)=>Ct(l(e,{...$l,filepath:"_."+t[a]}))))};return St({getStoreStats:t=>{let l=0,a=0,n=0;const o={};return e.forEachTable(((e,d)=>{l++;let r=0,s=0;const I={};d(((e,l)=>{r++;let a=0;l((()=>a++)),s+=a,t&&(I[e]={rowCells:a})})),a+=r,n+=s,t&&(o[e]={tableRows:r,tableCells:s,rows:I})})),{totalTables:l,totalRows:a,totalCells:n,totalValues:R(e.getValueIds()),jsonLength:ht(e.getJson()),...t?{detail:{tables:o}}:{}}},getStoreTablesSchema:t,getStoreValuesSchema:l,getStoreApi:a,getPrettyStoreApi:n,getStore:()=>e})}));e.createTools=il},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseTools={});
