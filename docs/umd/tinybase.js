var e,t;e=this,t=function(e,t){"use strict";const s=e=>typeof e,n="",o=s(n),r=s(!0),a=s(0),i=s(s),l="type",c="default",d="utf8",u="Listener",f="Result",h="add",g="Table",w="RowIds",L="CellIds",p="Cell",v=e=>n+e,R=(e,t)=>e.includes(t),I=(e,t)=>e.every(t),y=(e,t)=>I(e,((s,n)=>0==n||t(e[n-1],s)<=0)),S=(e,t)=>e.sort(t),T=(e,t)=>e.forEach(t),b=(e,t)=>e.map(t),C=e=>k(e,((e,t)=>e+t),0),m=e=>e.length,E=e=>0==m(e),k=(e,t,s)=>e.reduce(t,s),M=(e,t,s)=>e.slice(t,s),x=(e,...t)=>e.push(...t),D=e=>e.pop(),A=e=>e.shift(),F=e=>JSON.stringify(e,((e,t)=>O(t,Map)?k([...t],((e,[t,s])=>(e[t]=s,e)),{}):t)),P=JSON.parse,J=Math.max,Q=Math.min,j=isFinite,O=(e,t)=>e instanceof t,z=e=>null==e,N=(e,t,s)=>z(e)?s?.():t(e),W=e=>e==o||e==r,B=e=>s(e)==i,_=()=>{},q=e=>e.size,H=(e,t)=>e?.has(t)??!1,$=e=>z(e)||0==q(e),G=e=>[...e?.values()??[]],K=e=>e.clear(),U=(e,t)=>e?.forEach(t),V=(e,t)=>e?.delete(t),X=e=>new Map(e),Y=e=>[...e?.keys()??[]],Z=(e,t)=>e?.get(t),ee=(e,t)=>U(e,((e,s)=>t(s,e))),te=(e,t,s)=>z(s)?(V(e,t),e):e?.set(t,s),se=(e,t,s)=>(H(e,t)||te(e,t,s()),Z(e,t)),ne=(e,t,s)=>{const n={},o=t??(e=>e);return U(e,((e,t)=>N(o(e),(e=>s?.(e)?0:n[t]=e)))),n},oe=(e,t)=>{const s=X(),n=t??(e=>e);return U(e,((e,t)=>s.set(t,n(e)))),s},re=e=>oe(e,oe),ae=(e,t,s,n,o=0)=>N((s?se:Z)(e,t[o],o>m(t)-2?s:X),(r=>{if(o>m(t)-2)return n?.(r)&&te(e,t[o]),r;const a=ae(r,t,s,n,o+1);return $(r)&&te(e,t[o]),a})),ie=e=>new Set(e),le=(e,t)=>e?.add(t),ce=(e,t,s)=>{const n=e.hasRow,o=X(),r=X(),a=X(),i=X(),l=X(),c=(t,s,...n)=>{const o=se(l,t,ie);return T(n,(t=>le(o,t)&&s&&e.callListener(t))),n},d=(t,...s)=>N(Z(l,t),(n=>{T(E(s)?G(n):s,(t=>{e.delListener(t),V(n,t)})),$(n)&&te(l,t)})),u=(e,s)=>{te(o,e,s),H(r,e)||(te(r,e,t()),te(a,e,X()),te(i,e,X()))},f=e=>{te(o,e),te(r,e),te(a,e),te(i,e),d(e)};return[()=>e,()=>Y(o),e=>ee(r,e),e=>H(r,e),e=>Z(o,e),e=>Z(r,e),(e,t)=>te(r,e,t),u,(t,o,r,l,f)=>{u(t,o);const h=X(),g=X(),w=Z(a,t),L=Z(i,t),p=t=>{const r=s=>e.getCell(o,t,s),a=Z(w,t),i=n(o,t)?s(l(r,t)):void 0;if(a!=i&&te(h,t,[a,i]),!z(f)){const e=Z(L,t),s=n(o,t)?f(r,t):void 0;e!=s&&te(g,t,s)}},v=e=>{r((()=>{U(h,(([,e],t)=>te(w,t,e))),U(g,((e,t)=>te(L,t,e)))}),h,g,w,L,e),K(h),K(g)};ee(w,p),e.hasTable(o)&&T(e.getRowIds(o),(e=>{H(w,e)||p(e)})),v(!0),d(t),c(t,0,e.addRowListener(o,null,((e,t,s)=>p(s))),e.addTableListener(o,(()=>v())))},f,()=>ee(l,f),c,d]},de=(e,t)=>s(e)==o?t=>t(e):e??(()=>t??n),ue=e=>{const t=new WeakMap;return s=>(t.has(s)||t.set(s,e(s)),t.get(s))},fe=/^\d+$/,he=()=>{const e=[];let t=0;return[()=>A(e)??n+t++,t=>{fe.test(t)&&m(e)<1e3&&x(e,t)}]},ge=e=>{let t;const[s,o]=he(),r=X();return[(o,a,i)=>{t??=e();const l=s();return te(r,l,[o,a,i]),le(ae(a,i??[n],ie),l),l},(e,s,...o)=>T(((e,t=[n])=>{const s=[],o=(e,n)=>n==m(t)?x(s,e):null===t[n]?U(e,(e=>o(e,n+1))):T([t[n],null],(t=>o(Z(e,t),n+1)));return o(e,0),s})(e,s),(e=>U(e,(e=>Z(r,e)[0](t,...s??[],...o))))),e=>N(Z(r,e),(([,t,s])=>(ae(t,s??[n],void 0,(t=>(V(t,e),$(t)?1:0))),te(r,e),o(e),s))),(e,s,n)=>N(Z(r,e),(([e,,o=[]])=>{const r=(...a)=>{const i=m(a);i==m(o)?e(t,...a,...n(a)):z(o[i])?T(s[i](...a),(e=>r(...a,e))):r(...a,o[i])};r()}))]},we=Object,Le=we.keys,pe=we.isFrozen,ve=we.freeze,Re=(e,t)=>!z(((e,t)=>N(e,(e=>e[t])))(e,t)),Ie=(e,t)=>delete e[t],ye=(e,t)=>T(we.entries(e),(([e,s])=>t(s,e))),Se=e=>E(Le(e)),Te=e=>{const t=s(e);return W(t)||t==a&&j(e)?t:void 0},be=(e,t,s,n,o)=>z(o)?e.delCell(t,s,n,!0):e.setCell(t,s,n,o),Ce=ue((e=>{let t,s,o,r=100,a=X(),i=1;const l=X(),c=X(),[d,u,f]=ge((()=>Q)),h=X(),g=X(),w=[],L=[],p=(t,s)=>{i=0,e.transaction((()=>U(Z(h,s),((s,n)=>U(s,((s,o)=>U(s,((s,r)=>be(e,n,o,r,s[t]))))))))),i=1},v=e=>{te(h,e),te(g,e),u(c,[e])},I=(e,t)=>T(((e,t)=>e.splice(0,t))(e,t??m(e)),v),y=()=>I(w,m(w)-r),S=e.addCellListener(null,null,null,((e,s,n,r,l,c)=>{if(i){N(t,(()=>{x(w,t),y(),I(L),t=void 0,o=1}));const e=se(a,s,X),i=se(e,n,X),d=se(i,r,(()=>[c,void 0]));d[1]=l,d[0]===l&&$(te(i,r))&&$(te(e,n))&&$(te(a,s))&&(t=D(w),o=1),M()}})),b=(e="")=>(z(t)&&(t=n+s++,te(h,t,a),P(t,e),a=X(),o=1),t),C=()=>{E(w)||(L.unshift(b()),p(0,t),t=D(w),o=1)},k=()=>{E(L)||(x(w,t),t=A(L),p(1,t),o=1)},M=()=>{o&&(u(l),o=0)},F=e=>{const t=b(e);return M(),t},P=(e,t)=>(J(e)&&Z(g,e)!==t&&(te(g,e,t),u(c,[e])),Q),J=e=>H(h,e),Q={setSize:e=>(r=e,y(),Q),addCheckpoint:F,setCheckpoint:P,getStore:()=>e,getCheckpointIds:()=>[[...w],t,[...L]],forEachCheckpoint:e=>ee(g,e),hasCheckpoint:J,getCheckpoint:e=>Z(g,e),goBackward:()=>(C(),M(),Q),goForward:()=>(k(),M(),Q),goTo:e=>{const s=R(w,e)?C:R(L,e)?k:null;for(;!z(s)&&e!=t;)s();return M(),Q},addCheckpointIdsListener:e=>d(e,l),addCheckpointListener:(e,t)=>d(t,c,[e]),delListener:e=>(f(e),Q),clear:()=>(I(w),I(L),z(t)||v(t),t=void 0,s=0,F(),Q),destroy:()=>{e.delListener(S)},getListenerStats:()=>({})};return ve(Q.clear())})),me=(e,t)=>e<t?-1:1,Ee=ue((e=>{const t=X(),s=X(),[o,r,a,i,l,c,d,,u,f,h]=ce(e,X,(e=>z(e)?n:e+n)),[g,w,L]=ge((()=>v)),p=(t,s,n)=>{const o=l(t);U(n,((t,n)=>s(n,(s=>U(t,(t=>s(t,(s=>e.forEachCell(o,t,s)))))))))},v={setIndexDefinition:(e,n,o,r,a,i=me)=>{const l=z(a)?void 0:([e],[t])=>a(e,t);return u(e,n,((n,o,a,u,f,h)=>{let g=0;const L=ie(),p=ie(),v=c(e);if(U(o,(([e,t],s)=>{z(e)||(le(L,e),N(Z(v,e),(t=>{V(t,s),$(t)&&(te(v,e),g=1)}))),z(t)||(le(L,t),H(v,t)||(te(v,t,ie()),g=1),le(Z(v,t),s),z(r)||le(p,t))})),n(),$(f)||(h?ee(v,(e=>le(p,e))):ee(a,(e=>N(Z(u,e),(e=>le(p,e))))),U(p,(e=>{const t=(t,s)=>i(Z(f,t),Z(f,s),e),s=[...Z(v,e)];y(s,t)||(te(v,e,ie(S(s,t))),le(L,e))}))),(g||h)&&!z(l)){const t=[...v];y(t,l)||(d(e,X(S(t,l))),g=1)}g&&w(t,[e]),U(L,(t=>w(s,[e,t])))}),de(o),N(r,de)),v},delIndexDefinition:e=>(f(e),v),getStore:o,getIndexIds:r,forEachIndex:e=>a(((t,s)=>e(t,(e=>p(t,e,s))))),forEachSlice:(e,t)=>p(e,t,c(e)),hasIndex:i,hasSlice:(e,t)=>H(c(e),t),getTableId:l,getSliceIds:e=>Y(c(e)),getSliceRowIds:(e,t)=>G(Z(c(e),t)),addSliceIdsListener:(e,s)=>g(s,t,[e]),addSliceRowIdsListener:(e,t,n)=>g(n,s,[e,t]),delListener:e=>(L(e),v),destroy:h,getListenerStats:()=>({})};return ve(v)})),ke=X([["avg",[(e,t)=>C(e)/t,(e,t,s)=>e+(t-e)/(s+1),(e,t,s)=>e+(e-t)/(s-1),(e,t,s,n)=>e+(t-s)/n]],["max",[e=>J(...e),(e,t)=>J(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:J(t,e)]],["min",[e=>Q(...e),(e,t)=>Q(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:Q(t,e)]],["sum",[e=>C(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,s)=>e-s+t]]]),Me=(e,t,s,n,o,r=!1)=>{if($(s))return;const[a,i,l,c]=o;return r||=z(e),U(n,(([s,n])=>{r||(e=z(s)?i?.(e,n,t++):z(n)?l?.(e,s,t--):c?.(e,n,s,t),r||=z(e))})),r?a(G(s),q(s)):e},xe=ue((e=>{const t=X(),[s,o,r,a,i,l,c,,d,u,f]=ce(e,_,(e=>isNaN(e)||z(e)||!0===e||!1===e||e===n?void 0:1*e)),[h,g,w]=ge((()=>L)),L={setMetricDefinition:(e,s,n,o,r,a,i)=>{const u=B(n)?[n,r,a,i]:Z(ke,n)??Z(ke,"sum");return d(e,s,((s,n,o,r,a,i)=>{const d=l(e),f=q(r);i||=z(d),s();let h=Me(d,f,r,n,u,i);j(h)||(h=void 0),h!=d&&(c(e,h),g(t,[e],h,d))}),de(o,1)),L},delMetricDefinition:e=>(u(e),L),getStore:s,getMetricIds:o,forEachMetric:r,hasMetric:a,getTableId:i,getMetric:l,addMetricListener:(e,s)=>h(s,t,[e]),delListener:e=>(w(e),L),destroy:f,getListenerStats:()=>({})};return ve(L)})),De=(e,t,s,o,r)=>{let a,i=0;const l={load:async s=>{if(2!=i){i=1;const o=await t();z(o)||o==n?e.setTables(s):e.setJson(o),i=0}return l},startAutoLoad:async e=>(l.stopAutoLoad(),await l.load(e),o(l.load),l),stopAutoLoad:()=>(r(),l),save:async()=>(1!=i&&(i=2,await s(e.getJson()),i=0),l),startAutoSave:async()=>(await l.stopAutoSave().save(),a=e.addTablesListener((()=>l.save())),l),stopAutoSave:()=>(N(a,e.delListener),l),getStore:()=>e,destroy:()=>l.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return ve(l)},Ae="storage",Fe=globalThis.window,Pe=(e,t,s)=>{let n;return De(e,(async()=>s.getItem(t)),(async e=>s.setItem(t,e)),(e=>{n=n=>{n.storageArea===s&&n.key===t&&e()},Fe.addEventListener(Ae,n)}),(()=>{Fe.removeEventListener(Ae,n),n=void 0}))},Je=e=>e.headers.get("ETag"),Qe=ue((e=>{const t=e.createStore,[s,o,r,a,i,,,l,,c,d,v,R]=ce(e,(()=>!0),_),y=t(),S=t(),b=X(),C=(e,t,...s)=>T(s,(s=>le(se(se(b,t,X),e,ie),s))),k=e=>{N(Z(b,e),(e=>{ee(e,((e,t)=>U(t,(t=>e.delListener(t))))),K(e)})),T([S,y],(t=>t.delTable(e)))},D=(e,t,s)=>C(t,e,t.addWillFinishTransactionListener(s.startTransaction),t.addDidFinishTransactionListener((()=>s.finishTransaction()))),A={setQueryDefinition:(t,s,o)=>{l(t,s),k(t);const r=[],a=[[null,[s,null,null,[],X()]]],i=[],c=[],d=[];o({select:(e,t)=>{const s=B(e)?[m(r)+n,e]:[z(t)?e:t,s=>s(e,t)];return x(r,s),{as:e=>s[0]=e}},join:(e,t,s)=>{const n=z(s)||B(t)?null:t,o=z(n)?t:s,r=[e,[e,n,B(o)?o:e=>e(o),[],X()]];return x(a,r),{as:e=>r[0]=e}},where:(e,t,s)=>x(i,B(e)?e:z(s)?s=>s(e)===t:n=>n(e,t)===s),group:(e,t,s,n,o)=>{const r=[e,[e,B(t)?[t,s,n,o]:Z(ke,t)??[(e,t)=>t]]];return x(c,r),{as:e=>r[0]=e}},having:(e,t)=>x(d,B(e)?e:s=>s(e)===t)});const u=X(r);if($(u))return A;const f=X(a);ee(f,((e,[,t])=>N(Z(f,t),(({3:t})=>z(e)?0:x(t,e)))));const h=X(c);let g=y;if($(h)&&E(d))g=S;else{D(t,g,S);const e=X();ee(h,((t,[s,n])=>le(se(e,s,ie),[t,n])));const s=ie();ee(u,(t=>H(e,t)?0:le(s,t)));const n=X(),o=(s,n,o,r)=>N(s,(([a,i,l,c])=>{ee(n,((t,[s])=>{const n=se(a,t,X),i=Z(n,o),l=r?void 0:s;if(i!==l){const s=ie([[i,l]]),r=q(n);te(n,o,l),U(Z(e,t),(([e,t])=>{const o=Me(c[e],r,n,s,t);c[e]=z(Te(o))?null:o}))}})),$(i)||!I(d,(e=>e((e=>c[e]))))?S.delRow(t,l):z(l)?s[2]=S.addRow(t,c):S.setRow(t,l,c)}));C(g,t,g.addRowListener(t,null,((r,a,i,l)=>{const c=[],d=[],u=X(),f=g.hasRow(t,i);let h=!f;U(s,(e=>{const[s,n,o]=l(t,i,e);x(c,n),x(d,o),h||=s})),ee(e,(e=>{const[s,,n]=l(t,i,e);(h||s)&&te(u,e,[n])})),h&&o(ae(n,c,void 0,(([,e])=>(V(e,i),$(e)))),u,i,1),f&&o(ae(n,d,(()=>{const e={};return U(s,(s=>e[s]=g.getCell(t,i,s))),[X(),ie(),void 0,e]}),(([,e])=>{le(e,i)})),u,i)})))}D(t,e,g);const w=(n,o,r,a)=>{const l=t=>e.getCell(o,r,t);T(a,(s=>{const[o,,r,a,i]=Z(f,s),c=r?.(l,n),[d,u]=Z(i,n)??[];c!=d&&(z(u)||R(t,u),te(i,n,z(c)?null:[c,...v(t,1,e.addRowListener(o,c,(()=>w(n,o,c,a))))]))})),(n=>{const o=(t,o)=>e.getCell(...z(o)?[s,n,t]:t===s?[s,n,o]:[Z(f,t)?.[0],Z(Z(f,t)?.[4],n)?.[0],o]);g.transaction((()=>I(i,(e=>e(o)))?ee(u,((e,s)=>be(g,t,n,e,s(o,n)))):g.delRow(t,n)))})(n)},{3:L}=Z(f,null);return g.transaction((()=>v(t,1,e.addRowListener(s,null,((n,o,r)=>{e.hasRow(s,r)?w(r,s,r,L):(g.delRow(t,r),U(f,(({4:e})=>N(Z(e,r),(([,s])=>{R(t,s),te(e,r)})))))}))))),A},delQueryDefinition:e=>(k(e),c(e),A),getStore:s,getQueryIds:o,forEachQuery:r,hasQuery:a,getTableId:i,delListener:e=>(S.delListener(e),A),destroy:d,getListenerStats:()=>{const{tables:e,tableIds:t,transaction:s,...n}=S.getListenerStats();return n}};return ye({[g]:[1,1],[w]:[0,1],SortedRowIds:[0,5],Row:[1,2],[L]:[0,2],[p]:[1,3]},(([e,t],s)=>{T(e?["get","has","forEach"]:["get"],(e=>A[e+f+s]=(...t)=>S[e+s](...t))),A[h+f+s+u]=(...e)=>S[h+s+u](...M(e,0,t),((s,...n)=>e[t](A,...n)))})),ve(A)})),je=ue((e=>{const t=X(),s=X(),o=X(),r=X(),[a,i,l,c,d,u,,,f,h,g]=ce(e,(()=>[X(),X(),X(),X()]),(e=>z(e)?void 0:e+n)),[w,L,p]=ge((()=>y)),v=(e,t,s)=>N(u(e),(([n,,o])=>{if(!H(o,t)){const r=ie();if(d(e)!=I(e))le(r,t);else{let e=t;for(;!z(e)&&!H(r,e);)le(r,e),e=Z(n,e)}if(s)return r;te(o,t,r)}return Z(o,t)})),R=(e,t)=>N(u(e),(([,,e])=>te(e,t))),I=e=>Z(t,e),y={setRelationshipDefinition:(e,n,a,i)=>(te(t,e,a),f(e,n,((t,n)=>{const a=ie(),i=ie(),l=ie(),[c,d]=u(e);U(n,(([t,s],n)=>{z(t)||(le(i,t),N(Z(d,t),(e=>{V(e,n),$(e)&&te(d,t)}))),z(s)||(le(i,s),H(d,s)||te(d,s,ie()),le(Z(d,s),n)),le(a,n),te(c,n,s),ee(Z(r,e),(t=>{H(v(e,t),n)&&le(l,t)}))})),t(),U(a,(t=>L(s,[e,t]))),U(i,(t=>L(o,[e,t]))),U(l,(t=>{R(e,t),L(r,[e,t])}))}),de(i)),y),delRelationshipDefinition:e=>(te(t,e),h(e),y),getStore:a,getRelationshipIds:i,forEachRelationship:t=>l((s=>t(s,(t=>e.forEachRow(d(s),t))))),hasRelationship:c,getLocalTableId:d,getRemoteTableId:I,getRemoteRowId:(e,t)=>Z(u(e)?.[0],t),getLocalRowIds:(e,t)=>G(Z(u(e)?.[1],t)),getLinkedRowIds:(e,t)=>z(u(e))?[t]:G(v(e,t,!0)),addRemoteRowIdListener:(e,t,n)=>w(n,s,[e,t]),addLocalRowIdsListener:(e,t,s)=>w(s,o,[e,t]),addLinkedRowIdsListener:(e,t,s)=>(v(e,t),w(s,r,[e,t])),delListener:e=>(R(...p(e)),y),destroy:g,getListenerStats:()=>({})};return ve(y)})),Oe=e=>[e,e],ze=()=>[X(),X()],Ne=(e,t,s,n=te)=>{const o=(r=Y(e),a=e=>!Re(t,e),r.filter(a));var r,a;return T(Le(t),(n=>s(e,n,t[n]))),T(o,(t=>n(e,t))),e},We=(e,t,s)=>z(e)||!(e=>O(e,we)&&e.constructor==we)(e)||Se(e)||pe(e)?(s?.(),!1):(ye(e,((s,n)=>{t(s,n)||Ie(e,n)})),!Se(e)),Be=(e,t,s)=>te(e,t,Z(e,t)==-s?void 0:s),_e=()=>{let e,t,s=0;const n=X(),o=X(),r=X(),i=X(),d=X(),f=X(),y=X(),C=X(),E=X(),k=ze(),D=ze(),A=ze(),J=ze(),Q=ze(),j=ze(),O=ze(),_=ze(),q=ze(),G=ze(),[ae,ce,de,ue]=ge((()=>dt)),fe=(t,s)=>(!e||H(f,s)||Ge(s))&&We(t,((e,t)=>we(s,t,e)),(()=>Ge(s))),we=(e,t,s,n)=>We(n?s:pe(s,e,t),((n,o)=>N(Le(e,t,o,n),(e=>(s[o]=e,!0)),(()=>!1))),(()=>Ge(e,t))),Le=(t,s,n,o)=>e?N(Z(Z(f,t),n),(e=>Te(o)!=e.type?Ge(t,s,n,o,e.default):o),(()=>Ge(t,s,n,o))):z(Te(o))?Ge(t,s,n,o):o,pe=(e,t,s)=>(N(Z(y,t),(([n,o])=>{U(n,((t,s)=>{Re(e,s)||(e[s]=t)})),U(o,(n=>{Re(e,n)||Ge(t,s,n)}))})),e),Ce=e=>Ne(f,e,((e,t,s)=>{const n=X(),o=ie();Ne(se(f,t,X),s,((e,t,s)=>{te(e,t,s),N(s.default,(e=>te(n,t,e)),(()=>le(o,t)))})),te(y,t,[n,o])}),((e,t)=>{te(f,t),te(y,t)})),Ee=e=>Ne(E,e,((e,t,s)=>ke(t,s)),((e,t)=>Pe(t))),ke=(e,t)=>Ne(se(E,e,(()=>(je(e,1),X()))),t,((t,s,n)=>Me(e,t,s,n)),((t,s)=>Je(e,t,s))),Me=(e,t,s,n,o)=>Ne(se(t,s,(()=>(qe(e,s,1),X()))),n,((t,n,o)=>xe(e,s,t,n,o)),((n,r)=>Qe(e,t,s,n,r,o))),xe=(e,t,s,n,o)=>{H(s,n)||He(e,t,n,1);const r=Z(s,n);o!==r&&($e(e,t,n,r,o),te(s,n,o))},De=(e,t,s,n,o)=>N(Z(t,s),(t=>xe(e,s,t,n,o)),(()=>Me(e,t,s,pe({[n]:o},e,s)))),Ae=e=>{const[t]=se(C,e,he),s=t();return H(Z(E,e),s)?Ae(e):s},Fe=e=>Z(E,e)??ke(e,{}),Pe=e=>ke(e,{}),Je=(e,t,s)=>{const[,n]=se(C,e,he);n(s),Me(e,t,s,{},!0)},Qe=(e,t,s,n,o,r)=>{const a=Z(Z(y,e)?.[0],o);if(!z(a)&&!r)return xe(e,s,n,o,a);const i=t=>{$e(e,s,t,Z(n,t)),He(e,s,t,-1),te(n,t)};z(a)?i(o):ee(n,i),$(n)&&(qe(e,s,-1),$(te(t,s))&&(je(e,-1),te(E,e)))},je=(e,t)=>Be(n,e,t),qe=(e,t,s)=>Be(se(o,e,X),t,s),He=(e,t,s,n)=>Be(se(se(r,e,X),t,X),s,n),$e=(e,t,s,n,o)=>se(se(se(i,e,X),t,X),s,(()=>[n,0]))[1]=o,Ge=(e,t,s,n,o)=>(x(se(se(se(d,e,X),t,X),s,(()=>[])),n),o),Ke=(e,t,s)=>N(Z(Z(Z(i,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...Oe(ot(e,t,s))])),Ue=e=>$(d)||$(q[e])?0:U(e?oe(d,re):d,((t,s)=>U(t,((t,n)=>U(t,((t,o)=>ce(q[e],[s,n,o],t))))))),Ve=(e,t,s)=>{if(!$(t))return ce(e,s),1},Xe=e=>{const t=$(Q[e]),s=$(O[e])&&$(J[e])&&t&&$(D[e]),a=$(_[e])&&$(j[e])&&$(A[e])&&$(k[e]);if(!s||!a){const l=e?[oe(n),re(o),oe(r,re),oe(i,re)]:[n,o,r,i];if(!s){U(l[2],((t,s)=>U(t,((t,n)=>Ve(O[e],t,[s,n])))));const s=ie();U(l[1],((n,o)=>{Ve(J[e],n,[o])&&!t&&(ce(Q[e],[o,null]),le(s,o))})),t||U(l[3],((t,n)=>{if(!H(s,n)){const s=ie();U(t,(e=>U(e,(([t,n],o)=>n!==t?le(s,o):V(e,o))))),U(s,(t=>ce(Q[e],[n,t])))}})),Ve(D[e],l[0])}if(!a){let t;U(l[3],((s,n)=>{let o;U(s,((s,r)=>{let a;U(s,(([s,i],l)=>{i!==s&&(ce(_[e],[n,r,l],i,s,Ke),t=o=a=1)})),a&&ce(j[e],[n,r],Ke)})),o&&ce(A[e],[n],Ke)})),t&&ce(k[e],void 0,Ke)}}},Ye=(e,...t)=>(it((()=>e(...b(t,v)))),dt),Ze=()=>ne(E,(e=>ne(e,ne))),et=()=>Y(E),tt=e=>Y(Z(E,v(e))),st=(e,t,s,n=0,o)=>{const r=[];return ee(Z(E,v(e)),((e,s)=>x(r,[z(t)?e:Z(s,v(t)),e]))),b(M(S(r,(([e],[t])=>me(e,t)*(s?-1:1))),n,z(o)?o:n+o),(([,e])=>e))},nt=(e,t)=>Y(Z(Z(E,v(e)),v(t))),ot=(e,t,s)=>Z(Z(Z(E,v(e)),v(t)),v(s)),rt=e=>Ye((()=>(e=>We(e,fe,Ge))(e)?Ee(e):0)),at=()=>Ye((()=>Ee({}))),it=(e,t)=>{if(-1==s)return;lt();const n=e?.();return ct(t),n},lt=()=>(s++,dt),ct=e=>(s>0&&(s--,0==s&&(t=!$(i),s=1,Ue(1),t&&Xe(1),s=-1,e?.(ne(i,(e=>ne(e,(e=>ne(e,(e=>[...e]),(([e,t])=>e===t))),Se)),Se),ne(d,(e=>ne(e,ne))))&&(s=1,U(i,((e,t)=>U(e,((e,s)=>U(e,(([e],n)=>be(dt,t,s,n,e))))))),s=-1,t=!1),ce(G[0],void 0,t),Ue(0),t&&Xe(0),ce(G[1],void 0,t),s=0,T([i,d,n,o,r],K))),dt),dt={getTables:Ze,getTableIds:et,getTable:e=>ne(Z(E,v(e)),ne),getRowIds:tt,getSortedRowIds:st,getRow:(e,t)=>ne(Z(Z(E,v(e)),v(t))),getCellIds:nt,getCell:ot,hasTables:()=>!$(E),hasTable:e=>H(E,v(e)),hasRow:(e,t)=>H(Z(E,v(e)),v(t)),hasCell:(e,t,s)=>H(Z(Z(E,v(e)),v(t)),v(s)),getJson:()=>F(E),getSchemaJson:()=>F(f),setTables:rt,setTable:(e,t)=>Ye((e=>fe(t,e)?ke(e,t):0),e),setRow:(e,t,s)=>Ye(((e,t)=>we(v(e),v(t),s)?Me(v(e),Fe(v(e)),v(t),s):0),e,t),addRow:(e,t)=>it((()=>{let s;return we(e,s,t)&&(e=v(e),Me(e,Fe(e),s=Ae(e),t)),s})),setPartialRow:(e,t,s)=>Ye(((e,t)=>{if(we(e,t,s,1)){const n=Fe(e);ye(s,((s,o)=>De(e,n,t,o,s)))}}),e,t),setCell:(e,t,s,n)=>Ye(((e,t,s)=>N(Le(e,t,s,B(n)?n(ot(e,t,s)):n),(n=>De(e,Fe(e),t,s,n)))),e,t,s),setJson:e=>{try{"{}"===e?at():rt(P(e))}catch{}return dt},setSchema:t=>Ye((()=>{if((e=(e=>We(e,(e=>We(e,(e=>{if(!We(e,((e,t)=>R([l,c],t))))return!1;const t=e.type;return!(!W(t)&&t!=a||(Te(e.default)!=t&&Ie(e,c),0))})))))(t))&&(Ce(t),!$(E))){const e=Ze();at(),rt(e)}})),delTables:at,delTable:e=>Ye((e=>H(E,e)?Pe(e):0),e),delRow:(e,t)=>Ye(((e,t)=>N(Z(E,e),(s=>H(s,t)?Je(e,s,t):0))),e,t),delCell:(e,t,s,n)=>Ye(((e,t,s)=>N(Z(E,e),(o=>N(Z(o,t),(r=>H(r,s)?Qe(e,o,t,r,s,n):0))))),e,t,s),delSchema:()=>Ye((()=>{Ce({}),e=!1})),transaction:it,startTransaction:lt,finishTransaction:ct,forEachTable:e=>U(E,((t,s)=>e(s,(e=>U(t,((t,s)=>e(s,(e=>ee(t,e))))))))),forEachRow:(e,t)=>U(Z(E,v(e)),((e,s)=>t(s,(t=>ee(e,t))))),forEachCell:(e,t,s)=>ee(Z(Z(E,v(e)),v(t)),s),addSortedRowIdsListener:(e,t,s,n,o,r,a)=>{let i=st(e,t,s,n,o);return ae((()=>{const a=st(e,t,s,n,o);var l,c;c=i,m(l=a)===m(c)&&I(l,((e,t)=>c[t]===e))||(i=a,r(dt,e,t,s,n,o,i))}),Q[a?1:0],[e,t])},addWillFinishTransactionListener:e=>ae(e,G[0]),addDidFinishTransactionListener:e=>ae(e,G[1]),callListener:e=>(ue(e,[et,tt,nt],(e=>z(e[2])?[]:Oe(ot(...e)))),dt),delListener:e=>(de(e),dt),getListenerStats:()=>({}),createStore:_e};return ye({Tables:[0,k],TableIds:[0,D],[g]:[1,A],[w]:[1,J],Row:[2,j],[L]:[2,O],[p]:[3,_],InvalidCell:[3,q]},(([e,t],s)=>{dt[h+s+u]=(...s)=>ae(s[e],t[s[e+1]?1:0],e>0?M(s,0,e):void 0)})),ve(dt)};e.createCheckpoints=Ce,e.createCustomPersister=De,e.createFilePersister=(e,s)=>{let n;return De(e,(async()=>{try{return await t.promises.readFile(s,d)}catch{}}),(async e=>{try{await t.promises.writeFile(s,e,d)}catch{}}),(e=>{n=t.watch(s,e)}),(()=>{n?.close(),n=void 0}))},e.createIndexes=Ee,e.createLocalPersister=(e,t)=>Pe(e,t,localStorage),e.createMetrics=xe,e.createQueries=Qe,e.createRelationships=je,e.createRemotePersister=(e,t,s,n)=>{let o,r;return De(e,(async()=>{const e=await fetch(t);return r=Je(e),e.text()}),(async e=>await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:e})),(e=>{o=setInterval((async()=>{const s=await fetch(t,{method:"HEAD"}),n=Je(s);z(r)||z(n)||n==r||(r=n,e())}),1e3*n)}),(()=>{N(o,clearInterval),o=void 0}))},e.createSessionPersister=(e,t)=>Pe(e,t,sessionStorage),e.createStore=_e,e.defaultSorter=me,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("fs")):"function"==typeof define&&define.amd?define(["exports","fs"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBase={},e.fs);
