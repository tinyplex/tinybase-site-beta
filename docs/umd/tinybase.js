var e,t;e=this,t=function(e,t){"use strict";const s=e=>typeof e,n="",o=s(n),r=s(!0),a=s(0),i=s(s),l="default",c="utf8",d="Listener",u="Result",f="add",h="Table",g="RowIds",w="CellIds",L="Cell",p=e=>n+e,R=(e,t)=>e.includes(t),v=(e,t)=>e.every(t),y=(e,t)=>m(e)===m(t)&&v(e,((e,s)=>t[s]===e)),I=(e,t)=>v(e,((s,n)=>0==n||t(e[n-1],s)<=0)),S=(e,t)=>e.sort(t),T=(e,t)=>e.forEach(t),b=(e,t)=>e.map(t),C=e=>k(e,((e,t)=>e+t),0),m=e=>e.length,E=e=>0==m(e),k=(e,t,s)=>e.reduce(t,s),M=(e,t,s)=>e.slice(t,s),x=(e,...t)=>e.push(...t),A=e=>e.pop(),D=e=>e.shift(),F=e=>JSON.stringify(e,((e,t)=>z(t,Map)?k([...t],((e,[t,s])=>(e[t]=s,e)),{}):t)),J=JSON.parse,P=Math.max,Q=Math.min,j=isFinite,z=(e,t)=>e instanceof t,N=e=>null==e,O=(e,t,s)=>N(e)?s?.():t(e),W=e=>e==o||e==r,B=e=>s(e)==i,q=e=>Array.isArray(e),H=()=>{},$=e=>e.size,G=(e,t)=>e?.has(t)??!1,K=e=>N(e)||0==$(e),U=e=>[...e?.values()??[]],V=e=>e.clear(),X=(e,t)=>e?.forEach(t),Y=(e,t)=>e?.delete(t),Z=e=>new Map(e),_=e=>[...e?.keys()??[]],ee=(e,t)=>e?.get(t),te=(e,t)=>X(e,((e,s)=>t(s,e))),se=(e,t,s)=>N(s)?(Y(e,t),e):e?.set(t,s),ne=(e,t,s)=>(G(e,t)||se(e,t,s()),ee(e,t)),oe=(e,t,s)=>{const n={},o=t??(e=>e);return X(e,((e,t)=>O(o(e),(e=>s?.(e)?0:n[t]=e)))),n},re=(e,t)=>{const s=Z(),n=t??(e=>e);return X(e,((e,t)=>s.set(t,n(e)))),s},ae=e=>re(e,re),ie=(e,t,s,n,o=0)=>O((s?ne:ee)(e,t[o],o>m(t)-2?s:Z),(r=>{if(o>m(t)-2)return n?.(r)&&se(e,t[o]),r;const a=ie(r,t,s,n,o+1);return K(r)&&se(e,t[o]),a})),le=e=>new Set(q(e)||N(e)?e:[e]),ce=(e,t)=>e?.add(t),de=(e,t,s)=>{const n=e.hasRow,o=Z(),r=Z(),a=Z(),i=Z(),l=Z(),c=(t,s,...n)=>{const o=ne(l,t,le);return T(n,(t=>ce(o,t)&&s&&e.callListener(t))),n},d=(t,...s)=>O(ee(l,t),(n=>{T(E(s)?U(n):s,(t=>{e.delListener(t),Y(n,t)})),K(n)&&se(l,t)})),u=(e,s)=>{se(o,e,s),G(r,e)||(se(r,e,t()),se(a,e,Z()),se(i,e,Z()))},f=e=>{se(o,e),se(r,e),se(a,e),se(i,e),d(e)};return[()=>e,()=>_(o),e=>te(r,e),e=>G(r,e),e=>ee(o,e),e=>ee(r,e),(e,t)=>se(r,e,t),u,(t,o,r,l,f)=>{u(t,o);const h=Z(),g=Z(),w=ee(a,t),L=ee(i,t),p=t=>{const r=s=>e.getCell(o,t,s),a=ee(w,t),i=n(o,t)?s(l(r,t)):void 0;if(a===i||q(a)&&q(i)&&y(a,i)||se(h,t,[a,i]),!N(f)){const e=ee(L,t),s=n(o,t)?f(r,t):void 0;e!=s&&se(g,t,s)}},R=e=>{r((()=>{X(h,(([,e],t)=>se(w,t,e))),X(g,((e,t)=>se(L,t,e)))}),h,g,w,L,e),V(h),V(g)};te(w,p),e.hasTable(o)&&T(e.getRowIds(o),(e=>{G(w,e)||p(e)})),R(!0),d(t),c(t,0,e.addRowListener(o,null,((e,t,s)=>p(s))),e.addTableListener(o,(()=>R())))},f,()=>te(l,f),c,d]},ue=(e,t)=>s(e)==o?t=>t(e):e??(()=>t??n),fe=e=>{const t=new WeakMap;return s=>(t.has(s)||t.set(s,e(s)),t.get(s))},he=/^\d+$/,ge=()=>{const e=[];let t=0;return[()=>D(e)??n+t++,t=>{he.test(t)&&m(e)<1e3&&x(e,t)}]},we=e=>{let t;const[s,o]=ge(),r=Z();return[(o,a,i)=>{t??=e();const l=s();return se(r,l,[o,a,i]),ce(ie(a,i??[n],le),l),l},(e,s,...o)=>T(((e,t=[n])=>{const s=[],o=(e,n)=>n==m(t)?x(s,e):null===t[n]?X(e,(e=>o(e,n+1))):T([t[n],null],(t=>o(ee(e,t),n+1)));return o(e,0),s})(e,s),(e=>X(e,(e=>ee(r,e)[0](t,...s??[],...o))))),e=>O(ee(r,e),(([,t,s])=>(ie(t,s??[n],void 0,(t=>(Y(t,e),K(t)?1:0))),se(r,e),o(e),s))),(e,s,n)=>O(ee(r,e),(([e,,o=[]])=>{const r=(...a)=>{const i=m(a);i==m(o)?e(t,...a,...n(a)):N(o[i])?T(s[i](...a),(e=>r(...a,e))):r(...a,o[i])};r()}))]},Le=Object,pe=Le.keys,Re=Le.isFrozen,ve=Le.freeze,ye=(e,t)=>!N(((e,t)=>O(e,(e=>e[t])))(e,t)),Ie=(e,t)=>delete e[t],Se=(e,t)=>b(Le.entries(e),(([e,s])=>t(s,e))),Te=e=>E(pe(e)),be=e=>{const t=s(e);return W(t)||t==a&&j(e)?t:void 0},Ce=(e,t,s,n,o)=>N(o)?e.delCell(t,s,n,!0):e.setCell(t,s,n,o),me=fe((e=>{let t,s,o,r=100,a=Z(),i=1;const l=Z(),c=Z(),[d,u,f]=we((()=>Q)),h=Z(),g=Z(),w=[],L=[],p=(t,s)=>{i=0,e.transaction((()=>X(ee(h,s),((s,n)=>X(s,((s,o)=>X(s,((s,r)=>Ce(e,n,o,r,s[t]))))))))),i=1},v=e=>{se(h,e),se(g,e),u(c,[e])},y=(e,t)=>T(((e,t)=>e.splice(0,t))(e,t??m(e)),v),I=()=>y(w,m(w)-r),S=e.addCellListener(null,null,null,((e,s,n,r,l,c)=>{if(i){O(t,(()=>{x(w,t),I(),y(L),t=void 0,o=1}));const e=ne(a,s,Z),i=ne(e,n,Z),d=ne(i,r,(()=>[c,void 0]));d[1]=l,d[0]===l&&K(se(i,r))&&K(se(e,n))&&K(se(a,s))&&(t=A(w),o=1),M()}})),b=(e="")=>(N(t)&&(t=n+s++,se(h,t,a),J(t,e),a=Z(),o=1),t),C=()=>{E(w)||(((e,...t)=>{e.unshift(...t)})(L,b()),p(0,t),t=A(w),o=1)},k=()=>{E(L)||(x(w,t),t=D(L),p(1,t),o=1)},M=()=>{o&&(u(l),o=0)},F=e=>{const t=b(e);return M(),t},J=(e,t)=>(P(e)&&ee(g,e)!==t&&(se(g,e,t),u(c,[e])),Q),P=e=>G(h,e),Q={setSize:e=>(r=e,I(),Q),addCheckpoint:F,setCheckpoint:J,getStore:()=>e,getCheckpointIds:()=>[[...w],t,[...L]],forEachCheckpoint:e=>te(g,e),hasCheckpoint:P,getCheckpoint:e=>ee(g,e),goBackward:()=>(C(),M(),Q),goForward:()=>(k(),M(),Q),goTo:e=>{const s=R(w,e)?C:R(L,e)?k:null;for(;!N(s)&&e!=t;)s();return M(),Q},addCheckpointIdsListener:e=>d(e,l),addCheckpointListener:(e,t)=>d(t,c,[e]),delListener:e=>(f(e),Q),clear:()=>(y(w),y(L),N(t)||v(t),t=void 0,s=0,F(),Q),destroy:()=>{e.delListener(S)},getListenerStats:()=>({})};return ve(Q.clear())})),Ee=(e,t)=>e<t?-1:1,ke=fe((e=>{const t=Z(),s=Z(),[o,r,a,i,l,c,d,,u,f,h]=de(e,Z,(e=>N(e)?n:q(e)?b(e,p):p(e))),[g,w,L]=we((()=>v)),R=(t,s,n)=>{const o=l(t);X(n,((t,n)=>s(n,(s=>X(t,(t=>s(t,(s=>e.forEachCell(o,t,s)))))))))},v={setIndexDefinition:(e,n,o,r,a,i=Ee)=>{const l=N(a)?void 0:([e],[t])=>a(e,t);return u(e,n,((n,o,a,u,f,h)=>{let g=0;const L=le(),p=le(),R=c(e);if(X(o,(([e,t],s)=>{const n=le(e),o=le(t);X(n,(e=>Y(o,e)?Y(n,e):0)),X(n,(e=>{ce(L,e),O(ee(R,e),(t=>{Y(t,s),K(t)&&(se(R,e),g=1)}))})),X(o,(e=>{ce(L,e),G(R,e)||(se(R,e,le()),g=1),ce(ee(R,e),s),N(r)||ce(p,e)}))})),n(),K(f)||(h?te(R,(e=>ce(p,e))):te(a,(e=>O(ee(u,e),(e=>ce(p,e))))),X(p,(e=>{const t=(t,s)=>i(ee(f,t),ee(f,s),e),s=[...ee(R,e)];I(s,t)||(se(R,e,le(S(s,t))),ce(L,e))}))),(g||h)&&!N(l)){const t=[...R];I(t,l)||(d(e,Z(S(t,l))),g=1)}g&&w(t,[e]),X(L,(t=>w(s,[e,t])))}),ue(o),O(r,ue)),v},delIndexDefinition:e=>(f(e),v),getStore:o,getIndexIds:r,forEachIndex:e=>a(((t,s)=>e(t,(e=>R(t,e,s))))),forEachSlice:(e,t)=>R(e,t,c(e)),hasIndex:i,hasSlice:(e,t)=>G(c(e),t),getTableId:l,getSliceIds:e=>_(c(e)),getSliceRowIds:(e,t)=>U(ee(c(e),t)),addSliceIdsListener:(e,s)=>g(s,t,[e]),addSliceRowIdsListener:(e,t,n)=>g(n,s,[e,t]),delListener:e=>(L(e),v),destroy:h,getListenerStats:()=>({})};return ve(v)})),Me=Z([["avg",[(e,t)=>C(e)/t,(e,t,s)=>e+(t-e)/(s+1),(e,t,s)=>e+(e-t)/(s-1),(e,t,s,n)=>e+(t-s)/n]],["max",[e=>P(...e),(e,t)=>P(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:P(t,e)]],["min",[e=>Q(...e),(e,t)=>Q(t,e),(e,t)=>t==e?void 0:e,(e,t,s)=>s==e?void 0:Q(t,e)]],["sum",[e=>C(e),(e,t)=>e+t,(e,t)=>e-t,(e,t,s)=>e-s+t]]]),xe=(e,t,s,n,o,r=!1)=>{if(K(s))return;const[a,i,l,c]=o;return r||=N(e),X(n,(([s,n])=>{r||(e=N(s)?i?.(e,n,t++):N(n)?l?.(e,s,t--):c?.(e,n,s,t),r||=N(e))})),r?a(U(s),$(s)):e},Ae=fe((e=>{const t=Z(),[s,o,r,a,i,l,c,,d,u,f]=de(e,H,(e=>isNaN(e)||N(e)||!0===e||!1===e||e===n?void 0:1*e)),[h,g,w]=we((()=>L)),L={setMetricDefinition:(e,s,n,o,r,a,i)=>{const u=B(n)?[n,r,a,i]:ee(Me,n)??ee(Me,"sum");return d(e,s,((s,n,o,r,a,i)=>{const d=l(e),f=$(r);i||=N(d),s();let h=xe(d,f,r,n,u,i);j(h)||(h=void 0),h!=d&&(c(e,h),g(t,[e],h,d))}),ue(o,1)),L},delMetricDefinition:e=>(u(e),L),getStore:s,getMetricIds:o,forEachMetric:r,hasMetric:a,getTableId:i,getMetric:l,addMetricListener:(e,s)=>h(s,t,[e]),delListener:e=>(w(e),L),destroy:f,getListenerStats:()=>({})};return ve(L)})),De=(e,t,s,o,r)=>{let a,i=0;const l={load:async s=>{if(2!=i){i=1;const o=await t();N(o)||o==n?e.setTables(s):e.setJson(o),i=0}return l},startAutoLoad:async e=>(l.stopAutoLoad(),await l.load(e),o(l.load),l),stopAutoLoad:()=>(r(),l),save:async()=>(1!=i&&(i=2,await s(e.getJson()),i=0),l),startAutoSave:async()=>(await l.stopAutoSave().save(),a=e.addTablesListener((()=>l.save())),l),stopAutoSave:()=>(O(a,e.delListener),l),getStore:()=>e,destroy:()=>l.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return ve(l)},Fe="storage",Je=globalThis.window,Pe=(e,t,s)=>{let n;return De(e,(async()=>s.getItem(t)),(async e=>s.setItem(t,e)),(e=>{n=n=>{n.storageArea===s&&n.key===t&&e()},Je.addEventListener(Fe,n)}),(()=>{Je.removeEventListener(Fe,n),n=void 0}))},Qe=e=>e.headers.get("ETag"),je=fe((e=>{const t=e.createStore,[s,o,r,a,i,,,l,,c,p,R,y]=de(e,(()=>!0),H),I=t(),S=t(),b=Z(),C=(e,t,...s)=>T(s,(s=>ce(ne(ne(b,t,Z),e,le),s))),k=e=>{O(ee(b,e),(e=>{te(e,((e,t)=>X(t,(t=>e.delListener(t))))),V(e)})),T([S,I],(t=>t.delTable(e)))},A=(e,t,s)=>C(t,e,t.addWillFinishTransactionListener(s.startTransaction),t.addDidFinishTransactionListener((()=>s.finishTransaction()))),D={setQueryDefinition:(t,s,o)=>{l(t,s),k(t);const r=[],a=[[null,[s,null,null,[],Z()]]],i=[],c=[],d=[];o({select:(e,t)=>{const s=B(e)?[m(r)+n,e]:[N(t)?e:t,s=>s(e,t)];return x(r,s),{as:e=>s[0]=e}},join:(e,t,s)=>{const n=N(s)||B(t)?null:t,o=N(n)?t:s,r=[e,[e,n,B(o)?o:e=>e(o),[],Z()]];return x(a,r),{as:e=>r[0]=e}},where:(e,t,s)=>x(i,B(e)?e:N(s)?s=>s(e)===t:n=>n(e,t)===s),group:(e,t,s,n,o)=>{const r=[e,[e,B(t)?[t,s,n,o]:ee(Me,t)??[(e,t)=>t]]];return x(c,r),{as:e=>r[0]=e}},having:(e,t)=>x(d,B(e)?e:s=>s(e)===t)});const u=Z(r);if(K(u))return D;const f=Z(a);te(f,((e,[,t])=>O(ee(f,t),(({3:t})=>N(e)?0:x(t,e)))));const h=Z(c);let g=I;if(K(h)&&E(d))g=S;else{A(t,g,S);const e=Z();te(h,((t,[s,n])=>ce(ne(e,s,le),[t,n])));const s=le();te(u,(t=>G(e,t)?0:ce(s,t)));const n=Z(),o=(s,n,o,r)=>O(s,(([a,i,l,c])=>{te(n,((t,[s])=>{const n=ne(a,t,Z),i=ee(n,o),l=r?void 0:s;if(i!==l){const s=le([[i,l]]),r=$(n);se(n,o,l),X(ee(e,t),(([e,t])=>{const o=xe(c[e],r,n,s,t);c[e]=N(be(o))?null:o}))}})),K(i)||!v(d,(e=>e((e=>c[e]))))?S.delRow(t,l):N(l)?s[2]=S.addRow(t,c):S.setRow(t,l,c)}));C(g,t,g.addRowListener(t,null,((r,a,i,l)=>{const c=[],d=[],u=Z(),f=g.hasRow(t,i);let h=!f;X(s,(e=>{const[s,n,o]=l(t,i,e);x(c,n),x(d,o),h||=s})),te(e,(e=>{const[s,,n]=l(t,i,e);(h||s)&&se(u,e,[n])})),h&&o(ie(n,c,void 0,(([,e])=>(Y(e,i),K(e)))),u,i,1),f&&o(ie(n,d,(()=>{const e={};return X(s,(s=>e[s]=g.getCell(t,i,s))),[Z(),le(),void 0,e]}),(([,e])=>{ce(e,i)})),u,i)})))}A(t,e,g);const w=(n,o,r,a)=>{const l=t=>e.getCell(o,r,t);T(a,(s=>{const[o,,r,a,i]=ee(f,s),c=r?.(l,n),[d,u]=ee(i,n)??[];c!=d&&(N(u)||y(t,u),se(i,n,N(c)?null:[c,...R(t,1,e.addRowListener(o,c,(()=>w(n,o,c,a))))]))})),(n=>{const o=(t,o)=>e.getCell(...N(o)?[s,n,t]:t===s?[s,n,o]:[ee(f,t)?.[0],ee(ee(f,t)?.[4],n)?.[0],o]);g.transaction((()=>v(i,(e=>e(o)))?te(u,((e,s)=>Ce(g,t,n,e,s(o,n)))):g.delRow(t,n)))})(n)},{3:L}=ee(f,null);return g.transaction((()=>R(t,1,e.addRowListener(s,null,((n,o,r)=>{e.hasRow(s,r)?w(r,s,r,L):(g.delRow(t,r),X(f,(({4:e})=>O(ee(e,r),(([,s])=>{y(t,s),se(e,r)})))))}))))),D},delQueryDefinition:e=>(k(e),c(e),D),getStore:s,getQueryIds:o,forEachQuery:r,hasQuery:a,getTableId:i,delListener:e=>(S.delListener(e),D),destroy:p,getListenerStats:()=>{const{tables:e,tableIds:t,transaction:s,...n}=S.getListenerStats();return n}};return Se({[h]:[1,1],[g]:[0,1],SortedRowIds:[0,5],Row:[1,2],[w]:[0,2],[L]:[1,3]},(([e,t],s)=>{T(e?["get","has","forEach"]:["get"],(e=>D[e+u+s]=(...t)=>S[e+s](...t))),D[f+u+s+d]=(...e)=>S[f+s+d](...M(e,0,t),((s,...n)=>e[t](D,...n)))})),ve(D)})),ze=fe((e=>{const t=Z(),s=Z(),o=Z(),r=Z(),[a,i,l,c,d,u,,,f,h,g]=de(e,(()=>[Z(),Z(),Z(),Z()]),(e=>N(e)?void 0:e+n)),[w,L,p]=we((()=>I)),R=(e,t,s)=>O(u(e),(([n,,o])=>{if(!G(o,t)){const r=le();if(d(e)!=y(e))ce(r,t);else{let e=t;for(;!N(e)&&!G(r,e);)ce(r,e),e=ee(n,e)}if(s)return r;se(o,t,r)}return ee(o,t)})),v=(e,t)=>O(u(e),(([,,e])=>se(e,t))),y=e=>ee(t,e),I={setRelationshipDefinition:(e,n,a,i)=>(se(t,e,a),f(e,n,((t,n)=>{const a=le(),i=le(),l=le(),[c,d]=u(e);X(n,(([t,s],n)=>{N(t)||(ce(i,t),O(ee(d,t),(e=>{Y(e,n),K(e)&&se(d,t)}))),N(s)||(ce(i,s),G(d,s)||se(d,s,le()),ce(ee(d,s),n)),ce(a,n),se(c,n,s),te(ee(r,e),(t=>{G(R(e,t),n)&&ce(l,t)}))})),t(),X(a,(t=>L(s,[e,t]))),X(i,(t=>L(o,[e,t]))),X(l,(t=>{v(e,t),L(r,[e,t])}))}),ue(i)),I),delRelationshipDefinition:e=>(se(t,e),h(e),I),getStore:a,getRelationshipIds:i,forEachRelationship:t=>l((s=>t(s,(t=>e.forEachRow(d(s),t))))),hasRelationship:c,getLocalTableId:d,getRemoteTableId:y,getRemoteRowId:(e,t)=>ee(u(e)?.[0],t),getLocalRowIds:(e,t)=>U(ee(u(e)?.[1],t)),getLinkedRowIds:(e,t)=>N(u(e))?[t]:U(R(e,t,!0)),addRemoteRowIdListener:(e,t,n)=>w(n,s,[e,t]),addLocalRowIdsListener:(e,t,s)=>w(s,o,[e,t]),addLinkedRowIdsListener:(e,t,s)=>(R(e,t),w(s,r,[e,t])),delListener:e=>(v(...p(e)),I),destroy:g,getListenerStats:()=>({})};return ve(I)})),Ne=e=>[e,e],Oe=()=>[Z(),Z()],We=(e,t,s,n=se)=>{const o=(r=e=>!ye(t,e),_(e).filter(r));var r;return T(pe(t),(n=>s(e,n,t[n]))),T(o,(t=>n(e,t))),e},Be=(e,t,s)=>N(e)||!(e=>z(e,Le)&&e.constructor==Le)(e)||Te(e)||Re(e)?(s?.(),!1):(Se(e,((s,n)=>{t(s,n)||Ie(e,n)})),!Te(e)),qe=(e,t,s)=>se(e,t,ee(e,t)==-s?void 0:s),He=()=>{let e,t,s=0;const n=Z(),o=Z(),r=Z(),i=Z(),c=Z(),u=Z(),v=Z(),I=Z(),C=Z(),m=Oe(),E=Oe(),k=Oe(),A=Oe(),D=Oe(),P=Oe(),Q=Oe(),j=Oe(),z=Oe(),q=Oe(),[H,$,U,ie]=we((()=>lt)),de=(t,s)=>(!e||G(u,s)||$e(s))&&Be(t,((e,t)=>ue(s,t,e)),(()=>$e(s))),ue=(e,t,s,n)=>Be(n?s:he(s,e,t),((n,o)=>O(fe(e,t,o,n),(e=>(s[o]=e,!0)),(()=>!1))),(()=>$e(e,t))),fe=(t,s,n,o)=>e?O(ee(ee(u,t),n),(e=>be(o)!=e.type?$e(t,s,n,o,e.default):o),(()=>$e(t,s,n,o))):N(be(o))?$e(t,s,n,o):o,he=(e,t,s)=>(O(ee(v,t),(([n,o])=>{X(n,((t,s)=>{ye(e,s)||(e[s]=t)})),X(o,(n=>{ye(e,n)||$e(t,s,n)}))})),e),Le=e=>We(u,e,((e,t,s)=>{const n=Z(),o=le();We(ne(u,t,Z),s,((e,t,s)=>{se(e,t,s),O(s.default,(e=>se(n,t,e)),(()=>ce(o,t)))})),se(v,t,[n,o])}),((e,t)=>{se(u,t),se(v,t)})),pe=e=>We(C,e,((e,t,s)=>Re(t,s)),((e,t)=>De(t))),Re=(e,t)=>We(ne(C,e,(()=>(Pe(e,1),Z()))),t,((t,s,n)=>me(e,t,s,n)),((t,s)=>Fe(e,t,s))),me=(e,t,s,n,o)=>We(ne(t,s,(()=>(Qe(e,s,1),Z()))),n,((t,n,o)=>ke(e,s,t,n,o)),((n,r)=>Je(e,t,s,n,r,o))),ke=(e,t,s,n,o)=>{G(s,n)||je(e,t,n,1);const r=ee(s,n);o!==r&&(ze(e,t,n,r,o),se(s,n,o))},Me=(e,t,s,n,o)=>O(ee(t,s),(t=>ke(e,s,t,n,o)),(()=>me(e,t,s,he({[n]:o},e,s)))),xe=e=>{const[t]=ne(I,e,ge),s=t();return G(ee(C,e),s)?xe(e):s},Ae=e=>ee(C,e)??Re(e,{}),De=e=>Re(e,{}),Fe=(e,t,s)=>{const[,n]=ne(I,e,ge);n(s),me(e,t,s,{},!0)},Je=(e,t,s,n,o,r)=>{const a=ee(ee(v,e)?.[0],o);if(!N(a)&&!r)return ke(e,s,n,o,a);const i=t=>{ze(e,s,t,ee(n,t)),je(e,s,t,-1),se(n,t)};N(a)?i(o):te(n,i),K(n)&&(Qe(e,s,-1),K(se(t,s))&&(Pe(e,-1),se(C,e),se(I,e)))},Pe=(e,t)=>qe(n,e,t),Qe=(e,t,s)=>qe(ne(o,e,Z),t,s),je=(e,t,s,n)=>qe(ne(ne(r,e,Z),t,Z),s,n),ze=(e,t,s,n,o)=>ne(ne(ne(i,e,Z),t,Z),s,(()=>[n,0]))[1]=o,$e=(e,t,s,n,o)=>(x(ne(ne(ne(c,e,Z),t,Z),s,(()=>[])),n),o),Ge=(e,t,s)=>O(ee(ee(ee(i,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...Ne(st(e,t,s))])),Ke=e=>K(c)||K(z[e])?0:X(e?re(c,ae):c,((t,s)=>X(t,((t,n)=>X(t,((t,o)=>$(z[e],[s,n,o],t))))))),Ue=(e,t,s)=>{if(!K(t))return $(e,s),1},Ve=e=>{const t=K(D[e]),s=K(Q[e])&&K(A[e])&&t&&K(E[e]),a=K(j[e])&&K(P[e])&&K(k[e])&&K(m[e]);if(!s||!a){const l=e?[re(n),ae(o),re(r,ae),re(i,ae)]:[n,o,r,i];if(!s){X(l[2],((t,s)=>X(t,((t,n)=>Ue(Q[e],t,[s,n])))));const s=le();X(l[1],((n,o)=>{Ue(A[e],n,[o])&&!t&&($(D[e],[o,null]),ce(s,o))})),t||X(l[3],((t,n)=>{if(!G(s,n)){const s=le();X(t,(e=>X(e,(([t,n],o)=>n!==t?ce(s,o):Y(e,o))))),X(s,(t=>$(D[e],[n,t])))}})),Ue(E[e],l[0])}if(!a){let t;X(l[3],((s,n)=>{let o;X(s,((s,r)=>{let a;X(s,(([s,i],l)=>{i!==s&&($(j[e],[n,r,l],i,s,Ge),t=o=a=1)})),a&&$(P[e],[n,r],Ge)})),o&&$(k[e],[n],Ge)})),t&&$(m[e],void 0,Ge)}}},Xe=(e,...t)=>(rt((()=>e(...b(t,p)))),lt),Ye=()=>oe(C,(e=>oe(e,oe))),Ze=()=>_(C),_e=e=>_(ee(C,p(e))),et=(e,t,s,n=0,o)=>{return b(M(S((r=ee(C,p(e)),a=(e,s)=>[N(t)?s:ee(e,p(t)),s],b([...r?.entries()??[]],(([e,t])=>a(t,e)))),(([e],[t])=>Ee(e,t)*(s?-1:1))),n,N(o)?o:n+o),(([,e])=>e));var r,a},tt=(e,t)=>_(ee(ee(C,p(e)),p(t))),st=(e,t,s)=>ee(ee(ee(C,p(e)),p(t)),p(s)),nt=e=>Xe((()=>(e=>Be(e,de,$e))(e)?pe(e):0)),ot=()=>Xe((()=>pe({}))),rt=(e,t)=>{if(-1==s)return;at();const n=e();return it(t),n},at=()=>(s++,lt),it=e=>(s>0&&(s--,0==s&&(t=!K(i),s=1,Ke(1),t&&Ve(1),s=-1,e?.(oe(i,(e=>oe(e,(e=>oe(e,(e=>[...e]),(([e,t])=>e===t))),Te)),Te),oe(c,(e=>oe(e,oe))))&&(s=1,X(i,((e,t)=>X(e,((e,s)=>X(e,(([e],n)=>Ce(lt,t,s,n,e))))))),s=-1,t=!1),$(q[0],void 0,t),Ke(0),t&&Ve(0),$(q[1],void 0,t),s=0,T([i,c,n,o,r],V))),lt),lt={getTables:Ye,getTableIds:Ze,getTable:e=>oe(ee(C,p(e)),oe),getRowIds:_e,getSortedRowIds:et,getRow:(e,t)=>oe(ee(ee(C,p(e)),p(t))),getCellIds:tt,getCell:st,hasTables:()=>!K(C),hasTable:e=>G(C,p(e)),hasRow:(e,t)=>G(ee(C,p(e)),p(t)),hasCell:(e,t,s)=>G(ee(ee(C,p(e)),p(t)),p(s)),getJson:()=>F(C),getSchemaJson:()=>F(u),setTables:nt,setTable:(e,t)=>Xe((e=>de(t,e)?Re(e,t):0),e),setRow:(e,t,s)=>Xe(((e,t)=>ue(p(e),p(t),s)?me(p(e),Ae(p(e)),p(t),s):0),e,t),addRow:(e,t)=>rt((()=>{let s;return ue(e,s,t)&&(e=p(e),me(e,Ae(e),s=xe(e),t)),s})),setPartialRow:(e,t,s)=>Xe(((e,t)=>{if(ue(e,t,s,1)){const n=Ae(e);Se(s,((s,o)=>Me(e,n,t,o,s)))}}),e,t),setCell:(e,t,s,n)=>Xe(((e,t,s)=>O(fe(e,t,s,B(n)?n(st(e,t,s)):n),(n=>Me(e,Ae(e),t,s,n)))),e,t,s),setJson:e=>{try{"{}"===e?ot():nt(J(e))}catch{}return lt},setSchema:t=>Xe((()=>{if((e=(e=>Be(e,(e=>Be(e,(e=>{if(!Be(e,((e,t)=>R(["type",l],t))))return!1;const t=e.type;return!(!W(t)&&t!=a||(be(e.default)!=t&&Ie(e,l),0))})))))(t))&&(Le(t),!K(C))){const e=Ye();ot(),nt(e)}})),delTables:ot,delTable:e=>Xe((e=>G(C,e)?De(e):0),e),delRow:(e,t)=>Xe(((e,t)=>O(ee(C,e),(s=>G(s,t)?Fe(e,s,t):0))),e,t),delCell:(e,t,s,n)=>Xe(((e,t,s)=>O(ee(C,e),(o=>O(ee(o,t),(r=>G(r,s)?Je(e,o,t,r,s,n):0))))),e,t,s),delSchema:()=>Xe((()=>{Le({}),e=!1})),transaction:rt,startTransaction:at,finishTransaction:it,forEachTable:e=>X(C,((t,s)=>e(s,(e=>X(t,((t,s)=>e(s,(e=>te(t,e))))))))),forEachRow:(e,t)=>X(ee(C,p(e)),((e,s)=>t(s,(t=>te(e,t))))),forEachCell:(e,t,s)=>te(ee(ee(C,p(e)),p(t)),s),addSortedRowIdsListener:(e,t,s,n,o,r,a)=>{let i=et(e,t,s,n,o);return H((()=>{const a=et(e,t,s,n,o);y(a,i)||(i=a,r(lt,e,t,s,n,o,i))}),D[a?1:0],[e,t])},addWillFinishTransactionListener:e=>H(e,q[0]),addDidFinishTransactionListener:e=>H(e,q[1]),callListener:e=>(ie(e,[Ze,_e,tt],(e=>N(e[2])?[]:Ne(st(...e)))),lt),delListener:e=>(U(e),lt),getListenerStats:()=>({}),createStore:He};return Se({Tables:[0,m],TableIds:[0,E],[h]:[1,k],[g]:[1,A],Row:[2,P],[w]:[2,Q],[L]:[3,j],InvalidCell:[3,z]},(([e,t],s)=>{lt[f+s+d]=(...s)=>H(s[e],t[s[e+1]?1:0],e>0?M(s,0,e):void 0)})),ve(lt)};e.createCheckpoints=me,e.createCustomPersister=De,e.createFilePersister=(e,s)=>{let n;return De(e,(async()=>{try{return await t.promises.readFile(s,c)}catch{}}),(async e=>{try{await t.promises.writeFile(s,e,c)}catch{}}),(e=>{n=t.watch(s,e)}),(()=>{n?.close(),n=void 0}))},e.createIndexes=ke,e.createLocalPersister=(e,t)=>Pe(e,t,localStorage),e.createMetrics=Ae,e.createQueries=je,e.createRelationships=ze,e.createRemotePersister=(e,t,s,n)=>{let o,r;return De(e,(async()=>{const e=await fetch(t);return r=Qe(e),e.text()}),(async e=>await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:e})),(e=>{o=setInterval((async()=>{const s=await fetch(t,{method:"HEAD"}),n=Qe(s);N(r)||N(n)||n==r||(r=n,e())}),1e3*n)}),(()=>{O(o,clearInterval),o=void 0}))},e.createSessionPersister=(e,t)=>Pe(e,t,sessionStorage),e.createStore=He,e.defaultSorter=Ee},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("fs")):"function"==typeof define&&define.amd?define(["exports","fs"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBase={},e.fs);
