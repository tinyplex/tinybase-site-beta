var t,e;t=this,e=function(t){"use strict";const e=Object.freeze;t.createCustomPersister=(t,a,s,o,n)=>{let i,r,c=0,d=!1;const u=async t=>{2!=c&&(c=1,await t(),c=0)},y={load:async(e,s)=>(await u((async()=>{let o;try{o=await a()}catch{}t.setContent(o??[e,s])})),y),startAutoLoad:async(e,s)=>(y.stopAutoLoad(),await y.load(e,s),d=!0,r=o((async(e,s)=>{await u((async()=>{if(s)t.setTransactionChanges(s());else try{t.setContent(e?.()??await a())}catch{}}))})),y),stopAutoLoad:()=>(d&&(n(r),r=void 0,d=!1),y),save:async e=>(1!=c&&(c=2,await s(t.getContent,e),c=0),y),startAutoSave:async()=>(await y.stopAutoSave().save(),i=t.addDidFinishTransactionListener(((t,e)=>y.save(e))),y),stopAutoSave:()=>{var e,a;return e=i,a=t.delListener,null==e||a(e),y},getStore:()=>t,destroy:()=>y.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return e(y)}},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TinyBasePersisters={});
