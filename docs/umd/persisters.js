var e,t;e=this,t=function(e,t){"use strict";const s="utf8",a=e=>null==e,o=(e,t,s)=>a(e)?s?.():t(e),r=Object.freeze,n=(e,t,s,n,i)=>{let c,d,l,u=0,y=!1;const f={load:async(s,o)=>{if(2!=u){u=1;const r=await t();a(r)||""==r?e.transaction((()=>e.setTables(s).setValues(o))):e.setJson(r),u=0}return f},startAutoLoad:async(e,t)=>(f.stopAutoLoad(),await f.load(e,t),y=!0,l=n(f.load),f),stopAutoLoad:()=>(y&&(i(l),l=void 0,y=!1),f),save:async()=>(1!=u&&(u=2,await s(e.getJson()),u=0),f),startAutoSave:async()=>(await f.stopAutoSave().save(),c=e.addTablesListener(f.save),d=e.addValuesListener(f.save),f),stopAutoSave:()=>(o(c,e.delListener),o(d,e.delListener),f),getStore:()=>e,destroy:()=>f.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return r(f)},i="storage",c=globalThis.window,d=(e,t,s)=>n(e,(async()=>s.getItem(t)),(async e=>s.setItem(t,e)),(e=>{const a=a=>{a.storageArea===s&&a.key===t&&e()};return c.addEventListener(i,a),a}),(e=>c.removeEventListener(i,e))),l=e=>e.headers.get("ETag");e.createCustomPersister=n,e.createFilePersister=(e,a)=>n(e,(async()=>{try{return await t.promises.readFile(a,s)}catch{}}),(async e=>{try{await t.promises.writeFile(a,e,s)}catch{}}),(e=>t.watch(a,e)),(e=>e?.close())),e.createLocalPersister=(e,t)=>d(e,t,localStorage),e.createRemotePersister=(e,t,s,o)=>{let r;return n(e,(async()=>{const e=await fetch(t);return r=l(e),e.text()}),(async e=>await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:e})),(e=>setInterval((async()=>{const s=await fetch(t,{method:"HEAD"}),o=l(s);a(r)||a(o)||o==r||(r=o,e())}),1e3*o)),(e=>clearInterval(e)))},e.createSessionPersister=(e,t)=>d(e,t,sessionStorage)},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("fs")):"function"==typeof define&&define.amd?define(["exports","fs"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBasePersisters={},e.fs);
