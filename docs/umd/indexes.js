var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),r=e=>n+e,o=e=>null==e,d=(e,t,n)=>o(e)?n?.():t(e),i=e=>Array.isArray(e),l=(e,t)=>e.every(t),c=(e,t)=>l(e,((n,s)=>0==s||t(e[s-1],n)<=0)),a=(e,t)=>e.sort(t),f=(e,t)=>e.forEach(t),u=e=>e.length,h=(e,...t)=>e.push(...t),I=Object.freeze,g=(e,t)=>e?.has(t)??!1,p=e=>o(e)||0==(e=>e?.size??0)(e),y=e=>[...e?.values()??[]],x=e=>e.clear(),v=(e,t)=>e?.forEach(t),S=(e,t)=>e?.delete(t),w=e=>new Map(e),L=e=>[...e?.keys()??[]],b=(e,t)=>e?.get(t),T=(e,t)=>v(e,((e,n)=>t(n,e))),E=(e,t,n)=>o(n)?(S(e,t),e):e?.set(t,n),R=(e,t,n)=>(g(e,t)||E(e,t,n()),b(e,t)),m=(e,t,n,s,r=0)=>d((n?R:b)(e,t[r],r>u(t)-2?n:w),(o=>{if(r>u(t)-2)return s?.(o)&&E(e,t[r]),o;const d=m(o,t,n,s,r+1);return p(o)&&E(e,t[r]),d})),j=e=>new Set(i(e)||o(e)?e:[e]),k=(e,t)=>e?.add(t),z=(e,r)=>t(e)==s?t=>t(e):e??(()=>r??n),A=(e,t)=>(e??0)<(t??0)?-1:1,C=/^\d+$/,D=(e=>{const t=new WeakMap;return e=>(t.has(e)||t.set(e,(e=>{const t=w(),s=w(),[D,M,B,O,W,$,q,,F,G,H]=((e,t,n)=>{const s=e.hasRow,r=w(),c=w(),a=w(),h=w(),I=w(),m=(t,n,...s)=>{const r=R(I,t,j);return f(s,(t=>k(r,t)&&n&&e.callListener(t))),s},z=(t,...n)=>d(b(I,t),(s=>{f(0==u(n)?y(s):n,(t=>{e.delListener(t),S(s,t)})),p(s)&&E(I,t)})),A=(e,n)=>{E(r,e,n),g(c,e)||(E(c,e,t()),E(a,e,w()),E(h,e,w()))},C=e=>{E(r,e),E(c,e),E(a,e),E(h,e),z(e)};return[()=>e,()=>L(r),e=>T(c,e),e=>g(c,e),e=>b(r,e),e=>b(c,e),(e,t)=>E(c,e,t),A,(t,r,d,c,I)=>{A(t,r);const p=w(),y=w(),S=b(a,t),L=b(h,t),R=t=>{const d=n=>e.getCell(r,t,n),a=b(S,t),f=s(r,t)?n(c(d,t)):void 0;var h,g;if(a===f||i(a)&&i(f)&&(g=f,u(h=a)===u(g)&&l(h,((e,t)=>g[t]===e)))||E(p,t,[a,f]),!o(I)){const e=b(L,t),n=s(r,t)?I(d,t):void 0;e!=n&&E(y,t,n)}},j=e=>{d((()=>{v(p,(([,e],t)=>E(S,t,e))),v(y,((e,t)=>E(L,t,e)))}),p,y,S,L,e),x(p),x(y)};T(S,R),e.hasTable(r)&&f(e.getRowIds(r),(e=>{g(S,e)||R(e)})),j(!0),z(t),m(t,0,e.addRowListener(r,null,((e,t,n)=>R(n))),e.addTableListener(r,(()=>j())))},C,()=>T(I,C),m,z]})(e,w,(e=>{return o(e)?n:i(e)?(t=r,e.map(t)):r(e);var t})),[J,K,N]=(e=>{let t;const[s,r]=(()=>{const e=[];let t=0;return[s=>(s?e.shift():null)??n+t++,t=>{C.test(t)&&u(e)<1e3&&h(e,t)}]})(),i=w();return[(e,r,o,d=[],l=(()=>[]))=>{t??=Q;const c=s(1);return E(i,c,[e,r,o,d,l]),k(m(r,o??[n],j),c),c},(e,s,...r)=>f(((e,t=[n])=>{const s=[],r=(e,n)=>n==u(t)?h(s,e):null===t[n]?v(e,(e=>r(e,n+1))):f([t[n],null],(t=>r(b(e,t),n+1)));return r(e,0),s})(e,s),(e=>v(e,(e=>b(i,e)[0](t,...s??[],...r))))),e=>d(b(i,e),(([,t,s])=>(m(t,s??[n],void 0,(t=>(S(t,e),p(t)?1:0))),E(i,e),r(e),s))),e=>d(b(i,e),(([e,,n=[],s,r])=>{const d=(...i)=>{const l=u(i);l==u(n)?e(t,...i,...r(i)):o(n[l])?f(s[l]?.(...i)??[],(e=>d(...i,e))):d(...i,n[l])};d()}))]})(),P=(t,n,s)=>{const r=W(t);v(s,((t,s)=>n(s,(n=>v(t,(t=>n(t,(n=>e.forEachCell(r,t,n)))))))))},Q={setIndexDefinition:(e,n,r,i,l,f=A)=>{const u=o(l)?void 0:([e],[t])=>l(e,t);return F(e,n,((n,r,l,h,I,y)=>{let x=0;const L=j(),R=j(),m=$(e);if(v(r,(([e,t],n)=>{const s=j(e),r=j(t);v(s,(e=>S(r,e)?S(s,e):0)),v(s,(e=>{k(L,e),d(b(m,e),(t=>{S(t,n),p(t)&&(E(m,e),x=1)}))})),v(r,(e=>{k(L,e),g(m,e)||(E(m,e,j()),x=1),k(b(m,e),n),o(i)||k(R,e)}))})),n(),p(I)||(y?T(m,(e=>k(R,e))):T(l,(e=>d(b(h,e),(e=>k(R,e))))),v(R,(e=>{const t=(t,n)=>f(b(I,t),b(I,n),e),n=[...b(m,e)];c(n,t)||(E(m,e,j(a(n,t))),k(L,e))}))),(x||y)&&!o(u)){const t=[...m];c(t,u)||(q(e,w(a(t,u))),x=1)}x&&K(t,[e]),v(L,(t=>K(s,[e,t])))}),z(r),d(i,z)),Q},delIndexDefinition:e=>(G(e),Q),getStore:D,getIndexIds:M,forEachIndex:e=>B(((t,n)=>e(t,(e=>P(t,e,n))))),forEachSlice:(e,t)=>P(e,t,$(e)),hasIndex:O,hasSlice:(e,t)=>g($(e),t),getTableId:W,getSliceIds:e=>L($(e)),getSliceRowIds:(e,t)=>y(b($(e),t)),addSliceIdsListener:(e,n)=>J(n,t,[e]),addSliceRowIdsListener:(e,t,n)=>J(n,s,[e,t]),delListener:e=>(N(e),Q),destroy:H,getListenerStats:()=>({})};return I(Q)})(e)),t.get(e))})();e.createIndexes=D},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseIndexes={});
