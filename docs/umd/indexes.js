var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),r=e=>n+e,o=(e,t)=>e.every(t),d=(e,t)=>o(e,((n,s)=>0==s||t(e[s-1],n)<=0)),i=(e,t)=>e.sort(t),l=(e,t)=>e.forEach(t),c=e=>e.length,a=(e,...t)=>e.push(...t),f=e=>null==e,u=(e,t,n)=>f(e)?n?.():t(e),h=e=>Array.isArray(e),I=Object.freeze,g=(e,t)=>e?.has(t)??!1,p=e=>f(e)||0==(e=>e.size)(e),y=e=>[...e?.values()??[]],x=e=>e.clear(),v=(e,t)=>e?.forEach(t),S=(e,t)=>e?.delete(t),w=e=>new Map(e),L=e=>[...e?.keys()??[]],b=(e,t)=>e?.get(t),T=(e,t)=>v(e,((e,n)=>t(n,e))),E=(e,t,n)=>f(n)?(S(e,t),e):e?.set(t,n),R=(e,t,n)=>(g(e,t)||E(e,t,n()),b(e,t)),m=(e,t,n,s,r=0)=>u((n?R:b)(e,t[r],r>c(t)-2?n:w),(o=>{if(r>c(t)-2)return s?.(o)&&E(e,t[r]),o;const d=m(o,t,n,s,r+1);return p(o)&&E(e,t[r]),d})),j=e=>new Set(h(e)||f(e)?e:[e]),k=(e,t)=>e?.add(t),z=(e,r)=>t(e)==s?t=>t(e):e??(()=>r??n),A=(e,t)=>e<t?-1:1,C=/^\d+$/,D=(e=>{const t=new WeakMap;return e=>(t.has(e)||t.set(e,(e=>{const t=w(),s=w(),[D,M,B,O,W,$,q,,F,G,H]=((e,t,n)=>{const s=e.hasRow,r=w(),d=w(),i=w(),a=w(),I=w(),m=(t,n,...s)=>{const r=R(I,t,j);return l(s,(t=>k(r,t)&&n&&e.callListener(t))),s},z=(t,...n)=>u(b(I,t),(s=>{l(0==c(n)?y(s):n,(t=>{e.delListener(t),S(s,t)})),p(s)&&E(I,t)})),A=(e,n)=>{E(r,e,n),g(d,e)||(E(d,e,t()),E(i,e,w()),E(a,e,w()))},C=e=>{E(r,e),E(d,e),E(i,e),E(a,e),z(e)};return[()=>e,()=>L(r),e=>T(d,e),e=>g(d,e),e=>b(r,e),e=>b(d,e),(e,t)=>E(d,e,t),A,(t,r,d,u,I)=>{A(t,r);const p=w(),y=w(),S=b(i,t),L=b(a,t),R=t=>{const d=n=>e.getCell(r,t,n),i=b(S,t),l=s(r,t)?n(u(d,t)):void 0;var a,g;if(i===l||h(i)&&h(l)&&(g=l,c(a=i)===c(g)&&o(a,((e,t)=>g[t]===e)))||E(p,t,[i,l]),!f(I)){const e=b(L,t),n=s(r,t)?I(d,t):void 0;e!=n&&E(y,t,n)}},j=e=>{d((()=>{v(p,(([,e],t)=>E(S,t,e))),v(y,((e,t)=>E(L,t,e)))}),p,y,S,L,e),x(p),x(y)};T(S,R),e.hasTable(r)&&l(e.getRowIds(r),(e=>{g(S,e)||R(e)})),j(!0),z(t),m(t,0,e.addRowListener(r,null,((e,t,n)=>R(n))),e.addTableListener(r,(()=>j())))},C,()=>T(I,C),m,z]})(e,w,(e=>{return f(e)?n:h(e)?(t=r,e.map(t)):r(e);var t})),[J,K,N]=(e=>{let t;const[s,r]=(()=>{const e=[];let t=0;return[s=>(s?e.shift():null)??n+t++,t=>{C.test(t)&&c(e)<1e3&&a(e,t)}]})(),o=w();return[(e,r,d,i=[],l=(()=>[]))=>{t??=Q;const c=s(1);return E(o,c,[e,r,d,i,l]),k(m(r,d??[n],j),c),c},(e,s,...r)=>l(((e,t=[n])=>{const s=[],r=(e,n)=>n==c(t)?a(s,e):null===t[n]?v(e,(e=>r(e,n+1))):l([t[n],null],(t=>r(b(e,t),n+1)));return r(e,0),s})(e,s),(e=>v(e,(e=>b(o,e)[0](t,...s??[],...r))))),e=>u(b(o,e),(([,t,s])=>(m(t,s??[n],void 0,(t=>(S(t,e),p(t)?1:0))),E(o,e),r(e),s))),e=>u(b(o,e),(([e,,n=[],s,r])=>{const o=(...d)=>{const i=c(d);i==c(n)?e(t,...d,...r(d)):f(n[i])?l(s[i]?.(...d)??[],(e=>o(...d,e))):o(...d,n[i])};o()}))]})(),P=(t,n,s)=>{const r=W(t);v(s,((t,s)=>n(s,(n=>v(t,(t=>n(t,(n=>e.forEachCell(r,t,n)))))))))},Q={setIndexDefinition:(e,n,r,o,l,c=A)=>{const a=f(l)?void 0:([e],[t])=>l(e,t);return F(e,n,((n,r,l,h,I,y)=>{let x=0;const L=j(),R=j(),m=$(e);if(v(r,(([e,t],n)=>{const s=j(e),r=j(t);v(s,(e=>S(r,e)?S(s,e):0)),v(s,(e=>{k(L,e),u(b(m,e),(t=>{S(t,n),p(t)&&(E(m,e),x=1)}))})),v(r,(e=>{k(L,e),g(m,e)||(E(m,e,j()),x=1),k(b(m,e),n),f(o)||k(R,e)}))})),n(),p(I)||(y?T(m,(e=>k(R,e))):T(l,(e=>u(b(h,e),(e=>k(R,e))))),v(R,(e=>{const t=(t,n)=>c(b(I,t),b(I,n),e),n=[...b(m,e)];d(n,t)||(E(m,e,j(i(n,t))),k(L,e))}))),(x||y)&&!f(a)){const t=[...m];d(t,a)||(q(e,w(i(t,a))),x=1)}x&&K(t,[e]),v(L,(t=>K(s,[e,t])))}),z(r),u(o,z)),Q},delIndexDefinition:e=>(G(e),Q),getStore:D,getIndexIds:M,forEachIndex:e=>B(((t,n)=>e(t,(e=>P(t,e,n))))),forEachSlice:(e,t)=>P(e,t,$(e)),hasIndex:O,hasSlice:(e,t)=>g($(e),t),getTableId:W,getSliceIds:e=>L($(e)),getSliceRowIds:(e,t)=>y(b($(e),t)),addSliceIdsListener:(e,n)=>J(n,t,[e]),addSliceRowIdsListener:(e,t,n)=>J(n,s,[e,t]),delListener:e=>(N(e),Q),destroy:H,getListenerStats:()=>({})};return I(Q)})(e)),t.get(e))})();e.createIndexes=D},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseIndexes={});
