var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),o=e=>null==e,r=(e,t,n)=>o(e)?n?.():t(e),i=e=>Array.isArray(e),a=(e,t)=>e.forEach(t),l=e=>e.length,d=(e,...t)=>e.push(...t),c=Object.freeze,f=(e,t)=>e?.has(t)??!1,u=e=>o(e)||0==(e=>e.size)(e),h=e=>[...e?.values()??[]],R=e=>e.clear(),p=(e,t)=>e?.forEach(t),g=(e,t)=>e?.delete(t),L=e=>new Map(e),w=(e,t)=>e?.get(t),y=(e,t)=>p(e,((e,n)=>t(n,e))),v=(e,t,n)=>o(n)?(g(e,t),e):e?.set(t,n),I=(e,t,n)=>(f(e,t)||v(e,t,n()),w(e,t)),b=(e,t,n,s,o=0)=>r((n?I:w)(e,t[o],o>l(t)-2?n:L),(r=>{if(o>l(t)-2)return s?.(r)&&v(e,t[o]),r;const i=b(r,t,n,s,o+1);return u(r)&&v(e,t[o]),i})),T=e=>new Set(i(e)||o(e)?e:[e]),m=(e,t)=>e?.add(t),k=/^\d+$/,E=(e=>{const E=new WeakMap;return e=>(E.has(e)||E.set(e,(e=>{const E=L(),x=L(),S=L(),j=L(),[z,A,D,M,B,C,,,O,W,$]=((e,t,s)=>{const d=e.hasRow,c=L(),b=L(),k=L(),E=L(),x=L(),S=(t,n,...s)=>{const o=I(x,t,T);return a(s,(t=>m(o,t)&&n&&e.callListener(t))),s},j=(t,...n)=>r(w(x,t),(s=>{a(0==l(n)?h(s):n,(t=>{e.delListener(t),g(s,t)})),u(s)&&v(x,t)})),z=(e,t)=>{v(c,e,t),f(b,e)||(v(b,e,[L(),L(),L(),L()]),v(k,e,L()),v(E,e,L()))},A=e=>{v(c,e),v(b,e),v(k,e),v(E,e),j(e)};return[()=>e,()=>{return e=c,[...e?.keys()??[]];var e},e=>y(b,e),e=>f(b,e),e=>w(c,e),e=>w(b,e),(e,t)=>v(b,e,t),z,(t,s,r,c,u)=>{z(t,s);const h=L(),g=L(),I=w(k,t),b=w(E,t),T=t=>{const r=n=>e.getCell(s,t,n),a=w(I,t),f=d(s,t)?(R=c(r,t),o(R)?void 0:R+n):void 0;var R,p,L,y;if(a===f||i(a)&&i(f)&&(L=f,l(p=a)===l(L)&&(y=(e,t)=>L[t]===e,p.every(y)))||v(h,t,[a,f]),!o(u)){const e=w(b,t),n=d(s,t)?u(r,t):void 0;e!=n&&v(g,t,n)}},m=e=>{r((()=>{p(h,(([,e],t)=>v(I,t,e))),p(g,((e,t)=>v(b,t,e)))}),h,g,I,b,e),R(h),R(g)};y(I,T),e.hasTable(s)&&a(e.getRowIds(s),(e=>{f(I,e)||T(e)})),m(!0),j(t),S(t,0,e.addRowListener(s,null,((e,t,n)=>T(n))),e.addTableListener(s,(()=>m())))},A,()=>y(x,A),S,j]})(e),[q,F,G]=(e=>{let t;const[s,i]=(()=>{const e=[];let t=0;return[s=>(s?e.shift():null)??n+t++,t=>{k.test(t)&&l(e)<1e3&&d(e,t)}]})(),c=L();return[(e,o,r,i=[],a=(()=>[]))=>{t??=N;const l=s(1);return v(c,l,[e,o,r,i,a]),m(b(o,r??[n],T),l),l},(e,s,...o)=>a(((e,t=[n])=>{const s=[],o=(e,n)=>n==l(t)?d(s,e):null===t[n]?p(e,(e=>o(e,n+1))):a([t[n],null],(t=>o(w(e,t),n+1)));return o(e,0),s})(e,s),(e=>p(e,(e=>w(c,e)[0](t,...s??[],...o))))),e=>r(w(c,e),(([,t,s])=>(b(t,s??[n],void 0,(t=>(g(t,e),u(t)?1:0))),v(c,e),i(e),s))),e=>r(w(c,e),(([e,,n=[],s,r])=>{const i=(...d)=>{const c=l(d);c==l(n)?e(t,...d,...r(d)):o(n[c])?a(s[c]?.(...d)??[],(e=>i(...d,e))):i(...d,n[c])};i()}))]})(),H=(e,t,n)=>r(C(e),(([s,,r])=>{if(!f(r,t)){const i=T();if(B(e)!=K(e))m(i,t);else{let e=t;for(;!o(e)&&!f(i,e);)m(i,e),e=w(s,e)}if(n)return i;v(r,t,i)}return w(r,t)})),J=(e,t)=>r(C(e),(([,,e])=>v(e,t))),K=e=>w(E,e),N={setRelationshipDefinition:(e,i,a,l)=>{return v(E,e,a),O(e,i,((t,n)=>{const s=T(),i=T(),a=T(),[l,d]=C(e);p(n,(([t,n],c)=>{o(t)||(m(i,t),r(w(d,t),(e=>{g(e,c),u(e)&&v(d,t)}))),o(n)||(m(i,n),f(d,n)||v(d,n,T()),m(w(d,n),c)),m(s,c),v(l,c,n),y(w(j,e),(t=>{f(H(e,t),c)&&m(a,t)}))})),t(),p(s,(t=>F(x,[e,t]))),p(i,(t=>F(S,[e,t]))),p(a,(t=>{J(e,t),F(j,[e,t])}))}),t(d=l)==s?e=>e(d):d??(()=>n)),N;var d},delRelationshipDefinition:e=>(v(E,e),W(e),N),getStore:z,getRelationshipIds:A,forEachRelationship:t=>D((n=>t(n,(t=>e.forEachRow(B(n),t))))),hasRelationship:M,getLocalTableId:B,getRemoteTableId:K,getRemoteRowId:(e,t)=>w(C(e)?.[0],t),getLocalRowIds:(e,t)=>h(w(C(e)?.[1],t)),getLinkedRowIds:(e,t)=>o(C(e))?[t]:h(H(e,t,!0)),addRemoteRowIdListener:(e,t,n)=>q(n,x,[e,t]),addLocalRowIdsListener:(e,t,n)=>q(n,S,[e,t]),addLinkedRowIdsListener:(e,t,n)=>(H(e,t),q(n,j,[e,t])),delListener:e=>(J(...G(e)),N),destroy:$,getListenerStats:()=>({})};return c(N)})(e)),E.get(e))})();e.createRelationships=E},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseRelationships={});
