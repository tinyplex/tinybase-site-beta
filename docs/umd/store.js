var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),l=t(!0),a=t(0),o=t(t),r="type",c="default",i="Ids",d="Table",u=d+"s",h=d+i,f="Row",g=f+"Count",T=f+i,b="Cell",V=b+i,C="Value",S=C+"s",v=C+i,y=e=>s+e,w=isFinite,p=(e,t)=>e instanceof t,I=e=>null==e,m=(e,t,s)=>I(e)?s?.():t(e),R=e=>e==n||e==l,J=e=>t(e)==o,E=(e,t)=>e.forEach(t),L=(e,t)=>e.map(t),F=e=>e.length,x=(e,t,s)=>e.slice(t,s),z=(e,...t)=>e.push(...t),O=Object,j=O.keys,k=O.isFrozen,A=O.freeze,M=e=>p(e,O)&&e.constructor==O,N=(e,t)=>!I(((e,t)=>m(e,(e=>e[t])))(e,t)),P=(e,t)=>(delete e[t],e),B=(e,t)=>L(O.entries(e),(([e,s])=>t(s,e))),D=e=>M(e)&&0==(e=>F(j(e)))(e),W=e=>e?.size??0,$=(e,t)=>e?.has(t)??!1,q=e=>I(e)||0==W(e),G=e=>e.clear(),H=(e,t)=>e?.forEach(t),K=(e,t)=>e?.delete(t),Q=e=>new Map(e),U=e=>[...e?.keys()??[]],X=(e,t)=>e?.get(t),Y=(e,t)=>H(e,((e,s)=>t(s,e))),Z=(e,t,s)=>I(s)?(K(e,t),e):e?.set(t,s),_=(e,t,s)=>($(e,t)||Z(e,t,s()),X(e,t)),ee=(e,t,s,n=Z)=>(B(t,((t,n)=>s(e,n,t))),Y(e,(s=>N(t,s)?0:n(e,s))),e),te=(e,t,s)=>{const n={};return H(e,((e,l)=>{const a=t?t(e,l):e;!s?.(a,e)&&(n[l]=a)})),n},se=(e,t,s)=>te(e,(e=>te(e,t,s)),D),ne=(e,t,s)=>te(e,(e=>se(e,t,s)),D),le=(e,t)=>{const s=Q();return H(e,((e,n)=>s.set(n,t?.(e)??e))),s},ae=e=>le(e,le),oe=e=>le(e,ae),re=(e,t,s,n,l=0)=>m((s?_:X)(e,t[l],l>F(t)-2?s:Q),(a=>{if(l>F(t)-2)return n?.(a)&&Z(e,t[l]),a;const o=re(a,t,s,n,l+1);return q(a)&&Z(e,t[l]),o})),ce=e=>new Set(Array.isArray(e)||I(e)?e:[e]),ie=(e,t)=>e?.add(t),de=/^\d+$/,ue=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{de.test(t)&&F(e)<1e3&&z(e,t)}]},he=e=>[e,e],fe=()=>[Q(),Q()],ge=e=>[...e],Te=([e,t])=>e===t,be=e=>{const s=t(e);return R(s)||s==a&&w(e)?s:void 0},Ve=(e,t,s,n,l)=>I(l)?e.delCell(t,s,n,!0):e.setCell(t,s,n,l),Ce=(e,t,s)=>I(s)?e.delValue(t):e.setValue(t,s),Se=e=>JSON.stringify(e,((e,t)=>p(t,Map)?O.fromEntries([...t]):t)),ve=JSON.parse,ye=(e,t,s)=>I(e)||!M(e)||D(e)||k(e)?(s?.(),!1):(B(e,((s,n)=>{t(s,n)||P(e,n)})),!D(e)),we=(e,t,s)=>Z(e,t,X(e,t)==-s?void 0:s),pe=()=>{let e,t,n=!1,l=!1,o=0;const i=Q(),w=Q(),p=Q(),O=Q(),j=Q(),k=Q(),M=Q(),de=Q(),Ie=Q(),me=Q(),Re=Q(),Je=Q(),Ee=Q(),Le=Q(),Fe=ce(),xe=Q(),ze=Q(),Oe=Q(),je=Q(),ke=fe(),Ae=fe(),Me=fe(),Ne=fe(),Pe=fe(),Be=fe(),De=fe(),We=fe(),$e=fe(),qe=fe(),Ge=fe(),He=fe(),Ke=fe(),Qe=fe(),Ue=fe(),Xe=Q(),Ye=fe(),[Ze,_e,et,tt]=(e=>{let t;const[n,l]=ue(),a=Q();return[(e,l,o,r=[],c=(()=>[]))=>{t??=Ts;const i=n(1);return Z(a,i,[e,l,o,r,c]),ie(re(l,o??[s],ce),i),i},(e,n,...l)=>E(((e,t=[s])=>{const n=[],l=(e,s)=>s==F(t)?z(n,e):null===t[s]?H(e,(e=>l(e,s+1))):E([t[s],null],(t=>l(X(e,t),s+1)));return l(e,0),n})(e,n),(e=>H(e,(e=>X(a,e)[0](t,...n??[],...l))))),e=>m(X(a,e),(([,t,n])=>(re(t,n??[s],void 0,(t=>(K(t,e),q(t)?1:0))),Z(a,e),l(e),n))),e=>m(X(a,e),(([e,,s=[],n,l])=>{const a=(...o)=>{const r=F(o);r==F(s)?e(t,...o,...l(o)):I(s[r])?E(n[r]?.(...o)??[],(e=>a(...o,e))):a(...o,s[r])};a()}))]})(),st=e=>{if(!ye(e,((e,t)=>[r,c].includes(t))))return!1;const t=e[r];return!(!R(t)&&t!=a||(be(e[c])!=t&&P(e,c),0))},nt=(t,s)=>(!e||$(Re,s)||Ot(s))&&ye(t,((e,t)=>lt(s,t,e)),(()=>Ot(s))),lt=(e,t,s,n)=>ye(n?s:ct(s,e,t),((n,l)=>m(at(e,t,l,n),(e=>(s[l]=e,!0)),(()=>!1))),(()=>Ot(e,t))),at=(t,s,n,l)=>e?m(X(X(Re,t),n),(e=>be(l)!=e[r]?Ot(t,s,n,l,e[c]):l),(()=>Ot(t,s,n,l))):I(be(l))?Ot(t,s,n,l):l,ot=(e,t)=>ye(t?e:it(e),((t,s)=>m(rt(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>jt())),rt=(e,s)=>t?m(X(Ee,e),(t=>be(s)!=t[r]?jt(e,s,t[c]):s),(()=>jt(e,s))):I(be(s))?jt(e,s):s,ct=(e,t,s)=>(m(X(Je,t),(([n,l])=>{H(n,((t,s)=>{N(e,s)||(e[s]=t)})),H(l,(n=>{N(e,n)||Ot(t,s,n)}))})),e),it=e=>(t&&(H(Le,((t,s)=>{N(e,s)||(e[s]=t)})),H(Fe,(t=>{N(e,t)||jt(t)}))),e),dt=e=>ee(Re,e,((e,t,s)=>{const n=Q(),l=ce();ee(_(Re,t,Q),s,((e,t,s)=>{Z(e,t,s),m(s[c],(e=>Z(n,t,e)),(()=>ie(l,t)))})),Z(Je,t,[n,l])}),((e,t)=>{Z(Re,t),Z(Je,t)})),ut=e=>ee(Ee,e,((e,t,s)=>{Z(Ee,t,s),m(s[c],(e=>Z(Le,t,e)),(()=>ie(Fe,t)))}),((e,t)=>{Z(Ee,t),Z(Le,t),K(Fe,t)})),ht=e=>D(e)?os():ts(e),ft=e=>ee(Oe,e,((e,t,s)=>gt(t,s)),((e,t)=>pt(t))),gt=(e,t)=>ee(_(Oe,e,(()=>(Jt(e,1),Z(xe,e,ue()),Z(ze,e,Q()),Q()))),t,((t,s,n)=>Tt(e,t,s,n)),((t,s)=>It(e,t,s))),Tt=(e,t,s,n,l)=>ee(_(t,s,(()=>(Et(e,s,1),Q()))),n,((t,n,l)=>bt(e,s,t,n,l)),((n,a)=>mt(e,t,s,n,a,l))),bt=(e,t,s,n,l)=>{$(s,n)||Lt(e,t,n,1);const a=X(s,n);l!==a&&(Ft(e,t,n,a,l),Z(s,n,l))},Vt=(e,t,s,n,l)=>m(X(t,s),(t=>bt(e,s,t,n,l)),(()=>Tt(e,t,s,ct({[n]:l},e,s)))),Ct=e=>D(e)?is():ss(e),St=e=>ee(je,e,((e,t,s)=>vt(t,s)),((e,t)=>Rt(t))),vt=(e,t)=>{$(je,e)||xt(e,1);const s=X(je,e);t!==s&&(zt(e,s,t),Z(je,e,t))},yt=(e,t)=>{const[s]=X(xe,e),n=s(t);return $(X(Oe,e),n)?yt(e,t):n},wt=e=>X(Oe,e)??gt(e,{}),pt=e=>gt(e,{}),It=(e,t,s)=>{const[,n]=X(xe,e);n(s),Tt(e,t,s,{},!0)},mt=(e,t,s,n,l,a)=>{const o=X(X(Je,e)?.[0],l);if(!I(o)&&!a)return bt(e,s,n,l,o);const r=t=>{Ft(e,s,t,X(n,t)),Lt(e,s,t,-1),Z(n,t)};I(o)?r(l):Y(n,r),q(n)&&(Et(e,s,-1),q(Z(t,s))&&(Jt(e,-1),Z(Oe,e),Z(xe,e),Z(ze,e)))},Rt=e=>{const t=X(Le,e);if(!I(t))return vt(e,t);zt(e,X(je,e)),xt(e,-1),Z(je,e)},Jt=(e,t)=>we(i,e,t),Et=(e,t,s)=>we(_(O,e,Q),t,s)&&Z(p,e,_(p,e,(()=>0))+s),Lt=(e,t,s,n)=>{const l=X(ze,e),a=X(l,s)??0;(0==a&&1==n||1==a&&-1==n)&&we(_(w,e,Q),s,n),Z(l,s,a!=-n?a+n:null),we(_(_(j,e,Q),t,Q),s,n)},Ft=(e,t,s,n,l)=>_(_(_(k,e,Q),t,Q),s,(()=>[n,0]))[1]=l,xt=(e,t)=>we(M,e,t),zt=(e,t,s)=>_(de,e,(()=>[t,0]))[1]=s,Ot=(e,t,s,n,l)=>(z(_(_(_(Ie,e,Q),t,Q),s,(()=>[])),n),l),jt=(e,t,s)=>(z(_(me,e,(()=>[])),t),s),kt=(e,t,s)=>m(X(X(X(k,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...he(Yt(e,t,s))])),At=e=>m(X(de,e),(([e,t])=>[!0,e,t]),(()=>[!1,...he(es(e))])),Mt=e=>q(Ie)||q(Ge[e])?0:H(e?oe(Ie):Ie,((t,s)=>H(t,((t,n)=>H(t,((t,l)=>_e(Ge[e],[s,n,l],t))))))),Nt=e=>q(me)||q(He[e])?0:H(e?le(me):me,((t,s)=>_e(He[e],[s],t))),Pt=(e,t,s)=>{if(!q(t))return _e(e,s,(()=>te(t))),1},Bt=e=>{const t=q(De[e]),s=q($e[e])&&q(Ne[e])&&q(Pe[e])&&q(Be[e])&&t&&q(Ae[e]),n=q(qe[e])&&q(We[e])&&q(Me[e])&&q(ke[e]);if(!s||!n){const l=e?[le(i),ae(w),le(p),ae(O),oe(j),oe(k)]:[i,w,p,O,j,k];if(!s){Pt(Ae[e],l[0]),H(l[1],((t,s)=>Pt(Ne[e],t,[s]))),H(l[2],((t,s)=>{0!=t&&_e(Pe[e],[s],Kt(s))}));const s=ce();H(l[3],((n,l)=>{Pt(Be[e],n,[l])&&!t&&(_e(De[e],[l,null]),ie(s,l))})),t||H(l[5],((t,n)=>{if(!$(s,n)){const s=ce();H(t,(e=>H(e,(([t,n],l)=>n!==t?ie(s,l):K(e,l))))),H(s,(t=>_e(De[e],[n,t])))}})),H(l[4],((t,s)=>H(t,((t,n)=>Pt($e[e],t,[s,n])))))}if(!n){let t;H(l[5],((s,n)=>{let l;H(s,((s,a)=>{let o;H(s,(([s,r],c)=>{r!==s&&(_e(qe[e],[n,a,c],r,s,kt),t=l=o=1)})),o&&_e(We[e],[n,a],kt)})),l&&_e(Me[e],[n],kt)})),t&&_e(ke[e],void 0,kt)}}},Dt=e=>{const t=q(Qe[e]),s=q(Ue[e])&&q(Ke[e]);if(!t||!s){const n=e?[le(M),le(de)]:[M,de];if(t||Pt(Qe[e],n[0]),!s){let t;H(n[1],(([s,n],l)=>{n!==s&&(_e(Ue[e],[l],n,s,At),t=1)})),t&&_e(Ke[e],void 0,At)}}},Wt=(e,...t)=>(hs((()=>e(...L(t,y)))),Ts),$t=()=>[te(k,((e,t)=>-1===X(i,t)?null:te(e,((e,s)=>-1===X(X(O,t),s)?null:te(e,(([,e])=>e??null),((e,t)=>Te(t)))),D)),D),te(de,(([,e])=>e??null),((e,t)=>Te(t)))],qt=()=>({cellsTouched:n,valuesTouched:l,changedCells:ne(k,ge,Te),invalidCells:ne(Ie),changedValues:te(de,ge,Te),invalidValues:te(me),changedTableIds:te(i),changedRowIds:se(O),changedCellIds:ne(j),changedValueIds:te(M)}),Gt=()=>ne(Oe),Ht=()=>U(Oe),Kt=e=>W(X(Oe,y(e))),Qt=e=>U(X(Oe,y(e))),Ut=(e,t,s,n=0,l)=>{return L(x((o=X(Oe,y(e)),r=(e,s)=>[I(t)?s:X(e,y(t)),s],a=([e],[t])=>((e??0)<(t??0)?-1:1)*(s?-1:1),L([...o?.entries()??[]],(([e,t])=>r(t,e))).sort(a)),n,I(l)?l:n+l),(([,e])=>e));var a,o,r},Xt=(e,t)=>U(X(X(Oe,y(e)),y(t))),Yt=(e,t,s)=>X(X(X(Oe,y(e)),y(t)),y(s)),Zt=()=>te(je),_t=()=>U(je),es=e=>X(je,y(e)),ts=e=>Wt((()=>(e=>ye(e,nt,Ot))(e)?ft(e):0)),ss=e=>Wt((()=>ot(e)?St(e):0)),ns=e=>{try{ht(ve(e))}catch{}return Ts},ls=t=>Wt((()=>{if((e=ye(t,(e=>ye(e,st))))&&(dt(t),!q(Oe))){const e=Gt();os(),ts(e)}})),as=e=>Wt((()=>{if(t=(e=>ye(e,st))(e)){const s=Zt();us(),is(),t=!0,ut(e),ss(s)}})),os=()=>Wt((()=>ft({}))),rs=e=>Wt((e=>$(Oe,e)?pt(e):0),e),cs=(e,t)=>Wt(((e,t)=>m(X(Oe,e),(s=>$(s,t)?It(e,s,t):0))),e,t),is=()=>Wt((()=>St({}))),ds=()=>Wt((()=>{dt({}),e=!1})),us=()=>Wt((()=>{ut({}),t=!1})),hs=(e,t)=>{if(-1!=o){fs();const s=e();return gs(t),s}},fs=()=>(-1!=o&&o++,1==o&&_e(Xe,void 0,$t,qt),Ts),gs=e=>(o>0&&(o--,0==o&&(n=!q(k),l=!q(de),o=1,Mt(1),n&&Bt(1),Nt(1),l&&Dt(1),e?.($t,qt)&&(H(k,((e,t)=>H(e,((e,s)=>H(e,(([e],n)=>Ve(Ts,t,s,n,e))))))),H(de,(([e],t)=>Ce(Ts,t,e))),n=l=!1),_e(Ye[0],void 0,$t,qt),o=-1,Mt(0),n&&Bt(0),Nt(0),l&&Dt(0),_e(Ye[1],void 0,$t,qt),o=0,n=l=!1,E([i,w,p,O,j,k,Ie,M,de,me],G))),Ts),Ts={getContent:()=>[Gt(),Zt()],getTables:Gt,getTableIds:Ht,getTable:e=>se(X(Oe,y(e))),getTableCellIds:e=>U(X(ze,y(e))),getRowCount:Kt,getRowIds:Qt,getSortedRowIds:Ut,getRow:(e,t)=>te(X(X(Oe,y(e)),y(t))),getCellIds:Xt,getCell:Yt,getValues:Zt,getValueIds:_t,getValue:es,hasTables:()=>!q(Oe),hasTable:e=>$(Oe,y(e)),hasTableCell:(e,t)=>$(X(ze,y(e)),y(t)),hasRow:(e,t)=>$(X(Oe,y(e)),y(t)),hasCell:(e,t,s)=>$(X(X(Oe,y(e)),y(t)),y(s)),hasValues:()=>!q(je),hasValue:e=>$(je,y(e)),getTablesJson:()=>Se(Oe),getValuesJson:()=>Se(je),getJson:()=>Se([Oe,je]),getTablesSchemaJson:()=>Se(Re),getValuesSchemaJson:()=>Se(Ee),getSchemaJson:()=>Se([Re,Ee]),setContent:([e,t])=>Wt((()=>{(D(e)?os:ts)(e),(D(t)?is:ss)(t)})),setTables:ts,setTable:(e,t)=>Wt((e=>nt(t,e)?gt(e,t):0),e),setRow:(e,t,s)=>Wt(((e,t)=>lt(e,t,s)?Tt(e,wt(e),t,s):0),e,t),addRow:(e,t,s=!0)=>hs((()=>{let n;return lt(e,n,t)&&(e=y(e),Tt(e,wt(e),n=yt(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>Wt(((e,t)=>{if(lt(e,t,s,1)){const n=wt(e);B(s,((s,l)=>Vt(e,n,t,l,s)))}}),e,t),setCell:(e,t,s,n)=>Wt(((e,t,s)=>m(at(e,t,s,J(n)?n(Yt(e,t,s)):n),(n=>Vt(e,wt(e),t,s,n)))),e,t,s),setValues:ss,setPartialValues:e=>Wt((()=>ot(e,1)?B(e,((e,t)=>vt(t,e))):0)),setValue:(e,t)=>Wt((e=>m(rt(e,J(t)?t(es(e)):t),(t=>vt(e,t)))),e),setTransactionChanges:e=>Wt((()=>{B(e[0],((e,t)=>I(e)?rs(t):B(e,((e,s)=>I(e)?cs(t,s):B(e,((e,n)=>Ve(Ts,t,s,n,e))))))),B(e[1],((e,t)=>Ce(Ts,t,e)))})),setTablesJson:ns,setValuesJson:e=>{try{Ct(ve(e))}catch{}return Ts},setJson:e=>{try{const[t,s]=ve(e);ht(t),Ct(s)}catch{ns(e)}return Ts},setTablesSchema:ls,setValuesSchema:as,setSchema:(e,t)=>Wt((()=>{ls(e),as(t)})),delTables:os,delTable:rs,delRow:cs,delCell:(e,t,s,n)=>Wt(((e,t,s)=>m(X(Oe,e),(l=>m(X(l,t),(a=>$(a,s)?mt(e,l,t,a,s,n):0))))),e,t,s),delValues:is,delValue:e=>Wt((e=>$(je,e)?Rt(e):0),e),delTablesSchema:ds,delValuesSchema:us,delSchema:()=>Wt((()=>{ds(),us()})),transaction:hs,startTransaction:fs,finishTransaction:gs,forEachTable:e=>H(Oe,((t,s)=>e(s,(e=>H(t,((t,s)=>e(s,(e=>Y(t,e))))))))),forEachTableCell:(e,t)=>Y(X(ze,y(e)),t),forEachRow:(e,t)=>H(X(Oe,y(e)),((e,s)=>t(s,(t=>Y(e,t))))),forEachCell:(e,t,s)=>Y(X(X(Oe,y(e)),y(t)),s),forEachValue:e=>Y(je,e),addSortedRowIdsListener:(e,t,s,n,l,a,o)=>{let r=Ut(e,t,s,n,l);return Ze((()=>{const o=Ut(e,t,s,n,l);var c,i,d;i=r,F(c=o)===F(i)&&(d=(e,t)=>i[t]===e,c.every(d))||(r=o,a(Ts,e,t,s,n,l,r))}),De[o?1:0],[e,t],[Ht])},addStartTransactionListener:e=>Ze(e,Xe),addWillFinishTransactionListener:e=>Ze(e,Ye[0]),addDidFinishTransactionListener:e=>Ze(e,Ye[1]),callListener:e=>(tt(e),Ts),delListener:e=>(et(e),Ts),getListenerStats:()=>({}),createStore:pe};return B({[u]:[0,ke],[h]:[0,Ae],[d]:[1,Me,[Ht]],[d+V]:[1,Ne,[Ht]],[g]:[1,Pe,[Ht]],[T]:[1,Be,[Ht]],[f]:[2,We,[Ht,Qt]],[V]:[2,$e,[Ht,Qt]],[b]:[3,qe,[Ht,Qt,Xt],e=>he(Yt(...e))],InvalidCell:[3,Ge],[S]:[0,Ke],[v]:[0,Qe],[C]:[1,Ue,[_t],e=>he(es(e[0]))],InvalidValue:[1,He]},(([e,t,s,n],l)=>{Ts["add"+l+"Listener"]=(...l)=>Ze(l[e],t[l[e+1]?1:0],e>0?x(l,0,e):void 0,s,n)})),A(Ts)};e.createStore=pe},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
