var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),r=t(!0),o=t(0),l=t(t),a="type",i="default",c=e=>n+e,d=(e,t)=>e.forEach(t),u=(e,t)=>e.map(t),f=e=>e.length,h=(e,t,n)=>e.slice(t,n),T=(e,...t)=>e.push(...t),b=e=>JSON.stringify(e,((e,t)=>{return y(t,Map)?(n=[...t],s=(e,[t,n])=>(e[t]=n,e),r={},n.reduce(s,r)):t;var n,s,r})),g=JSON.parse,p=isFinite,y=(e,t)=>e instanceof t,v=e=>null==e,w=(e,t,n)=>v(e)?n?.():t(e),R=e=>e==s||e==r,S=(e,t)=>e?.has(t)??!1,C=e=>v(e)||0==(e=>e.size)(e),I=e=>e.clear(),L=(e,t)=>e?.forEach(t),m=(e,t)=>e?.delete(t),E=e=>new Map(e),J=e=>[...e?.keys()??[]],F=(e,t)=>e?.get(t),x=(e,t)=>L(e,((e,n)=>t(n,e))),z=(e,t,n)=>v(n)?(m(e,t),e):e?.set(t,n),O=(e,t,n)=>(S(e,t)||z(e,t,n()),F(e,t)),j=(e,t,n)=>{const s={},r=t??(e=>e);return L(e,((e,t)=>w(r(e),(e=>n?.(e)?0:s[t]=e)))),s},k=(e,t)=>{const n=E(),s=t??(e=>e);return L(e,((e,t)=>n.set(t,s(e)))),n},A=e=>k(e,k),M=(e,t,n,s,r=0)=>w((n?O:F)(e,t[r],r>f(t)-2?n:E),(o=>{if(r>f(t)-2)return s?.(o)&&z(e,t[r]),o;const l=M(o,t,n,s,r+1);return C(o)&&z(e,t[r]),l})),N=Object,B=N.keys,D=N.isFrozen,P=N.freeze,W=(e,t)=>!v(((e,t)=>w(e,(e=>e[t])))(e,t)),$=(e,t)=>delete e[t],q=(e,t)=>d(N.entries(e),(([e,n])=>t(n,e))),G=e=>{return t=B(e),0==f(t);var t},H=e=>new Set(Array.isArray(e)||v(e)?e:[e]),K=(e,t)=>e?.add(t),Q=/^\d+$/,U=()=>{const e=[];let t=0;return[()=>e.shift()??n+t++,t=>{Q.test(t)&&f(e)<1e3&&T(e,t)}]},V=e=>{let t;const[s,r]=U(),o=E();return[(r,l,a)=>{t??=e();const i=s();return z(o,i,[r,l,a]),K(M(l,a??[n],H),i),i},(e,s,...r)=>d(((e,t=[n])=>{const s=[],r=(e,n)=>n==f(t)?T(s,e):null===t[n]?L(e,(e=>r(e,n+1))):d([t[n],null],(t=>r(F(e,t),n+1)));return r(e,0),s})(e,s),(e=>L(e,(e=>F(o,e)[0](t,...s??[],...r))))),e=>w(F(o,e),(([,t,s])=>(M(t,s??[n],void 0,(t=>(m(t,e),C(t)?1:0))),z(o,e),r(e),s))),(e,n,s)=>w(F(o,e),(([e,,r=[]])=>{const o=(...l)=>{const a=f(l);a==f(r)?e(t,...l,...s(l)):v(r[a])?d(n[a](...l),(e=>o(...l,e))):o(...l,r[a])};o()}))]},X=e=>[e,e],Y=()=>[E(),E()],Z=e=>{const n=t(e);return R(n)||n==o&&p(e)?n:void 0},_=(e,t,n,s=z)=>{const r=(o=J(e),l=e=>!W(t,e),o.filter(l));var o,l;return d(B(t),(s=>n(e,s,t[s]))),d(r,(t=>s(e,t))),e},ee=(e,t,n)=>v(e)||!(e=>y(e,N)&&e.constructor==N)(e)||G(e)||D(e)?(n?.(),!1):(q(e,((n,s)=>{t(n,s)||$(e,s)})),!G(e)),te=(e,t,n)=>z(e,t,F(e,t)==-n?void 0:n),ne=()=>{let e,n,s=0;const r=E(),p=E(),y=E(),M=E(),N=E(),B=E(),D=E(),Q=E(),se=E(),re=Y(),oe=Y(),le=Y(),ae=Y(),ie=Y(),ce=Y(),de=Y(),ue=Y(),fe=Y(),he=Y(),[Te,be,ge,pe]=V((()=>et)),ye=(t,n)=>(!e||S(B,n)||Ne(n))&&ee(t,((e,t)=>ve(n,t,e)),(()=>Ne(n))),ve=(e,t,n,s)=>ee(s?n:Re(n,e,t),((s,r)=>w(we(e,t,r,s),(e=>(n[r]=e,!0)),(()=>!1))),(()=>Ne(e,t))),we=(t,n,s,r)=>e?w(F(F(B,t),s),(e=>Z(r)!=e.type?Ne(t,n,s,r,e.default):r),(()=>Ne(t,n,s,r))):v(Z(r))?Ne(t,n,s,r):r,Re=(e,t,n)=>(w(F(D,t),(([s,r])=>{L(s,((t,n)=>{W(e,n)||(e[n]=t)})),L(r,(s=>{W(e,s)||Ne(t,n,s)}))})),e),Se=e=>_(B,e,((e,t,n)=>{const s=E(),r=H();_(O(B,t,E),n,((e,t,n)=>{z(e,t,n),w(n.default,(e=>z(s,t,e)),(()=>K(r,t)))})),z(D,t,[s,r])}),((e,t)=>{z(B,t),z(D,t)})),Ce=e=>_(se,e,((e,t,n)=>Ie(t,n)),((e,t)=>xe(t))),Ie=(e,t)=>_(O(se,e,(()=>(je(e,1),E()))),t,((t,n,s)=>Le(e,t,n,s)),((t,n)=>ze(e,t,n))),Le=(e,t,n,s,r)=>_(O(t,n,(()=>(ke(e,n,1),E()))),s,((t,s,r)=>me(e,n,t,s,r)),((s,o)=>Oe(e,t,n,s,o,r))),me=(e,t,n,s,r)=>{S(n,s)||Ae(e,t,s,1);const o=F(n,s);r!==o&&(Me(e,t,s,o,r),z(n,s,r))},Ee=(e,t,n,s,r)=>w(F(t,n),(t=>me(e,n,t,s,r)),(()=>Le(e,t,n,Re({[s]:r},e,n)))),Je=e=>{const[t]=O(Q,e,U),n=t();return S(F(se,e),n)?Je(e):n},Fe=e=>F(se,e)??Ie(e,{}),xe=e=>Ie(e,{}),ze=(e,t,n)=>{const[,s]=O(Q,e,U);s(n),Le(e,t,n,{},!0)},Oe=(e,t,n,s,r,o)=>{const l=F(F(D,e)?.[0],r);if(!v(l)&&!o)return me(e,n,s,r,l);const a=t=>{Me(e,n,t,F(s,t)),Ae(e,n,t,-1),z(s,t)};v(l)?a(r):x(s,a),C(s)&&(ke(e,n,-1),C(z(t,n))&&(je(e,-1),z(se,e),z(Q,e)))},je=(e,t)=>te(r,e,t),ke=(e,t,n)=>te(O(p,e,E),t,n),Ae=(e,t,n,s)=>te(O(O(y,e,E),t,E),n,s),Me=(e,t,n,s,r)=>O(O(O(M,e,E),t,E),n,(()=>[s,0]))[1]=r,Ne=(e,t,n,s,r)=>(T(O(O(O(N,e,E),t,E),n,(()=>[])),s),r),Be=(e,t,n)=>w(F(F(F(M,e),t),n),(([e,t])=>[!0,e,t]),(()=>[!1,...X(Ue(e,t,n))])),De=e=>C(N)||C(fe[e])?0:L(e?k(N,A):N,((t,n)=>L(t,((t,s)=>L(t,((t,r)=>be(fe[e],[n,s,r],t))))))),Pe=(e,t,n)=>{if(!C(t))return be(e,n),1},We=e=>{const t=C(ie[e]),n=C(de[e])&&C(ae[e])&&t&&C(oe[e]),s=C(ue[e])&&C(ce[e])&&C(le[e])&&C(re[e]);if(!n||!s){const o=e?[k(r),A(p),k(y,A),k(M,A)]:[r,p,y,M];if(!n){L(o[2],((t,n)=>L(t,((t,s)=>Pe(de[e],t,[n,s])))));const n=H();L(o[1],((s,r)=>{Pe(ae[e],s,[r])&&!t&&(be(ie[e],[r,null]),K(n,r))})),t||L(o[3],((t,s)=>{if(!S(n,s)){const n=H();L(t,(e=>L(e,(([t,s],r)=>s!==t?K(n,r):m(e,r))))),L(n,(t=>be(ie[e],[s,t])))}})),Pe(oe[e],o[0])}if(!s){let t;L(o[3],((n,s)=>{let r;L(n,((n,o)=>{let l;L(n,(([n,a],i)=>{a!==n&&(be(ue[e],[s,o,i],a,n,Be),t=r=l=1)})),l&&be(ce[e],[s,o],Be)})),r&&be(le[e],[s],Be)})),t&&be(re[e],void 0,Be)}}},$e=(e,...t)=>(Ye((()=>e(...u(t,c)))),et),qe=()=>j(se,(e=>j(e,j))),Ge=()=>J(se),He=e=>J(F(se,c(e))),Ke=(e,t,n,s=0,r)=>{const o=[];return x(F(se,c(e)),((e,n)=>T(o,[v(t)?e:F(n,c(t)),e]))),u(h(o.sort((([e],[t])=>(e<t?-1:1)*(n?-1:1))),s,v(r)?r:s+r),(([,e])=>e))},Qe=(e,t)=>J(F(F(se,c(e)),c(t))),Ue=(e,t,n)=>F(F(F(se,c(e)),c(t)),c(n)),Ve=e=>$e((()=>(e=>ee(e,ye,Ne))(e)?Ce(e):0)),Xe=()=>$e((()=>Ce({}))),Ye=(e,t)=>{if(-1==s)return;Ze();const n=e();return _e(t),n},Ze=()=>(s++,et),_e=e=>(s>0&&(s--,0==s&&(n=!C(M),s=1,De(1),n&&We(1),s=-1,e?.(j(M,(e=>j(e,(e=>j(e,(e=>[...e]),(([e,t])=>e===t))),G)),G),j(N,(e=>j(e,j))))&&(s=1,L(M,((e,t)=>L(e,((e,n)=>L(e,(([e],s)=>((e,t,n,s,r)=>v(r)?e.delCell(t,n,s,!0):e.setCell(t,n,s,r))(et,t,n,s,e))))))),s=-1,n=!1),be(he[0],void 0,n),De(0),n&&We(0),be(he[1],void 0,n),s=0,d([M,N,r,p,y],I))),et),et={getTables:qe,getTableIds:Ge,getTable:e=>j(F(se,c(e)),j),getRowIds:He,getSortedRowIds:Ke,getRow:(e,t)=>j(F(F(se,c(e)),c(t))),getCellIds:Qe,getCell:Ue,hasTables:()=>!C(se),hasTable:e=>S(se,c(e)),hasRow:(e,t)=>S(F(se,c(e)),c(t)),hasCell:(e,t,n)=>S(F(F(se,c(e)),c(t)),c(n)),getJson:()=>b(se),getSchemaJson:()=>b(B),setTables:Ve,setTable:(e,t)=>$e((e=>ye(t,e)?Ie(e,t):0),e),setRow:(e,t,n)=>$e(((e,t)=>ve(c(e),c(t),n)?Le(c(e),Fe(c(e)),c(t),n):0),e,t),addRow:(e,t)=>Ye((()=>{let n;return ve(e,n,t)&&(e=c(e),Le(e,Fe(e),n=Je(e),t)),n})),setPartialRow:(e,t,n)=>$e(((e,t)=>{if(ve(e,t,n,1)){const s=Fe(e);q(n,((n,r)=>Ee(e,s,t,r,n)))}}),e,t),setCell:(e,n,s,r)=>$e(((e,n,s)=>w(we(e,n,s,t(r)==l?r(Ue(e,n,s)):r),(t=>Ee(e,Fe(e),n,s,t)))),e,n,s),setJson:e=>{try{"{}"===e?Xe():Ve(g(e))}catch{}return et},setSchema:t=>$e((()=>{if((e=(e=>ee(e,(e=>ee(e,(e=>{if(!ee(e,((e,t)=>[a,i].includes(t))))return!1;const t=e.type;return!(!R(t)&&t!=o||(Z(e.default)!=t&&$(e,i),0))})))))(t))&&(Se(t),!C(se))){const e=qe();Xe(),Ve(e)}})),delTables:Xe,delTable:e=>$e((e=>S(se,e)?xe(e):0),e),delRow:(e,t)=>$e(((e,t)=>w(F(se,e),(n=>S(n,t)?ze(e,n,t):0))),e,t),delCell:(e,t,n,s)=>$e(((e,t,n)=>w(F(se,e),(r=>w(F(r,t),(o=>S(o,n)?Oe(e,r,t,o,n,s):0))))),e,t,n),delSchema:()=>$e((()=>{Se({}),e=!1})),transaction:Ye,startTransaction:Ze,finishTransaction:_e,forEachTable:e=>L(se,((t,n)=>e(n,(e=>L(t,((t,n)=>e(n,(e=>x(t,e))))))))),forEachRow:(e,t)=>L(F(se,c(e)),((e,n)=>t(n,(t=>x(e,t))))),forEachCell:(e,t,n)=>x(F(F(se,c(e)),c(t)),n),addSortedRowIdsListener:(e,t,n,s,r,o,l)=>{let a=Ke(e,t,n,s,r);return Te((()=>{const l=Ke(e,t,n,s,r);var i,c,d;c=a,f(i=l)===f(c)&&(d=(e,t)=>c[t]===e,i.every(d))||(a=l,o(et,e,t,n,s,r,a))}),ie[l?1:0],[e,t])},addWillFinishTransactionListener:e=>Te(e,he[0]),addDidFinishTransactionListener:e=>Te(e,he[1]),callListener:e=>(pe(e,[Ge,He,Qe],(e=>v(e[2])?[]:X(Ue(...e)))),et),delListener:e=>(ge(e),et),getListenerStats:()=>({}),createStore:ne};return q({Tables:[0,re],TableIds:[0,oe],Table:[1,le],RowIds:[1,ae],Row:[2,ce],CellIds:[2,de],Cell:[3,ue],InvalidCell:[3,fe]},(([e,t],n)=>{et["add"+n+"Listener"]=(...n)=>Te(n[e],t[n[e+1]?1:0],e>0?h(n,0,e):void 0)})),P(et)};e.createStore=ne},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
