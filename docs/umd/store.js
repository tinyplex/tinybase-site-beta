var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),l=t(!0),a=t(0),r=t(t),o="type",c="default",i="Ids",d="Table",u=d+"s",h=d+i,f="Row"+i,g="Cell",T=g+i,V="Value",b=V+"s",v=V+i,S=e=>s+e,y=(e,t)=>e.forEach(t),C=(e,t)=>e.map(t),w=e=>e.length,p=(e,t,s)=>e.slice(t,s),I=(e,...t)=>e.push(...t),R=e=>JSON.stringify(e,((e,t)=>{return L(t,Map)?(s=(e,[t,s])=>(e[t]=s,e),n={},[...t].reduce(s,n)):t;var s,n})),m=JSON.parse,J=isFinite,L=(e,t)=>e instanceof t,E=e=>null==e,F=(e,t,s)=>E(e)?s?.():t(e),x=e=>e==n||e==l,z=e=>t(e)==r,O=Object,j=O.keys,k=O.isFrozen,A=O.freeze,M=e=>L(e,O)&&e.constructor==O,N=(e,t)=>!E(((e,t)=>F(e,(e=>e[t])))(e,t)),P=(e,t)=>delete e[t],B=(e,t)=>C(O.entries(e),(([e,s])=>t(s,e))),D=e=>{return M(e)&&(t=j(e),0==w(t));var t},W=(e,t)=>e?.has(t)??!1,$=e=>E(e)||0==(e=>e.size)(e),q=e=>e.clear(),G=(e,t)=>e?.forEach(t),H=(e,t)=>e?.delete(t),K=e=>new Map(e),Q=e=>[...e?.keys()??[]],U=(e,t)=>e?.get(t),X=(e,t)=>G(e,((e,s)=>t(s,e))),Y=(e,t,s)=>E(s)?(H(e,t),e):e?.set(t,s),Z=(e,t,s)=>(W(e,t)||Y(e,t,s()),U(e,t)),_=(e,t,s)=>{const n={};return G(e,((e,l)=>{const a=t?t(e,l):e;!s?.(a,e)&&(n[l]=a)})),n},ee=(e,t,s)=>_(e,(e=>_(e,t,s)),D),te=(e,t,s)=>_(e,(e=>ee(e,t,s)),D),se=(e,t)=>{const s=K();return G(e,((e,n)=>s.set(n,t?.(e)??e))),s},ne=e=>se(e,se),le=e=>se(e,ne),ae=(e,t,s,n,l=0)=>F((s?Z:U)(e,t[l],l>w(t)-2?s:K),(a=>{if(l>w(t)-2)return n?.(a)&&Y(e,t[l]),a;const r=ae(a,t,s,n,l+1);return $(a)&&Y(e,t[l]),r})),re=e=>new Set(Array.isArray(e)||E(e)?e:[e]),oe=(e,t)=>e?.add(t),ce=/^\d+$/,ie=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{ce.test(t)&&w(e)<1e3&&I(e,t)}]},de=e=>[e,e],ue=()=>[K(),K()],he=e=>[...e],fe=([e,t])=>e===t,ge=e=>{const s=t(e);return x(s)||s==a&&J(e)?s:void 0},Te=(e,t,s,n,l)=>E(l)?e.delCell(t,s,n,!0):e.setCell(t,s,n,l),Ve=(e,t,s)=>E(s)?e.delValue(t):e.setValue(t,s),be=(e,t,s,n=Y)=>(B(t,((t,n)=>s(e,n,t))),X(e,(s=>N(t,s)?0:n(e,s))),e),ve=(e,t,s)=>E(e)||!M(e)||D(e)||k(e)?(s?.(),!1):(B(e,((s,n)=>{t(s,n)||P(e,n)})),!D(e)),Se=(e,t,s)=>Y(e,t,U(e,t)==-s?void 0:s),ye=()=>{let e,t,n=!1,l=!1,r=0;const i=K(),J=K(),L=K(),O=K(),j=K(),k=K(),M=K(),ce=K(),Ce=K(),we=K(),pe=K(),Ie=K(),Re=re(),me=K(),Je=K(),Le=K(),Ee=ue(),Fe=ue(),xe=ue(),ze=ue(),Oe=ue(),je=ue(),ke=ue(),Ae=ue(),Me=ue(),Ne=ue(),Pe=ue(),Be=ue(),De=ue(),We=K(),$e=ue(),[qe,Ge,He,Ke]=(e=>{let t;const[n,l]=ie(),a=K();return[(e,l,r,o=[],c=(()=>[]))=>{t??=rs;const i=n(1);return Y(a,i,[e,l,r,o,c]),oe(ae(l,r??[s],re),i),i},(e,n,...l)=>y(((e,t=[s])=>{const n=[],l=(e,s)=>s==w(t)?I(n,e):null===t[s]?G(e,(e=>l(e,s+1))):y([t[s],null],(t=>l(U(e,t),s+1)));return l(e,0),n})(e,n),(e=>G(e,(e=>U(a,e)[0](t,...n??[],...l))))),e=>F(U(a,e),(([,t,n])=>(ae(t,n??[s],void 0,(t=>(H(t,e),$(t)?1:0))),Y(a,e),l(e),n))),e=>F(U(a,e),(([e,,s=[],n,l])=>{const a=(...r)=>{const o=w(r);o==w(s)?e(t,...r,...l(r)):E(s[o])?y(n[o]?.(...r)??[],(e=>a(...r,e))):a(...r,s[o])};a()}))]})(),Qe=e=>{if(!ve(e,((e,t)=>[o,c].includes(t))))return!1;const t=e[o];return!(!x(t)&&t!=a||(ge(e[c])!=t&&P(e,c),0))},Ue=(t,s)=>(!e||W(Ce,s)||Rt(s))&&ve(t,((e,t)=>Xe(s,t,e)),(()=>Rt(s))),Xe=(e,t,s,n)=>ve(n?s:et(s,e,t),((n,l)=>F(Ye(e,t,l,n),(e=>(s[l]=e,!0)),(()=>!1))),(()=>Rt(e,t))),Ye=(t,s,n,l)=>e?F(U(U(Ce,t),n),(e=>ge(l)!=e[o]?Rt(t,s,n,l,e[c]):l),(()=>Rt(t,s,n,l))):E(ge(l))?Rt(t,s,n,l):l,Ze=(e,t)=>ve(t?e:tt(e),((t,s)=>F(_e(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>mt())),_e=(e,s)=>t?F(U(pe,e),(t=>ge(s)!=t[o]?mt(e,s,t[c]):s),(()=>mt(e,s))):E(ge(s))?mt(e,s):s,et=(e,t,s)=>(F(U(we,t),(([n,l])=>{G(n,((t,s)=>{N(e,s)||(e[s]=t)})),G(l,(n=>{N(e,n)||Rt(t,s,n)}))})),e),tt=e=>(t&&(G(Ie,((t,s)=>{N(e,s)||(e[s]=t)})),G(Re,(t=>{N(e,t)||mt(t)}))),e),st=e=>be(Ce,e,((e,t,s)=>{const n=K(),l=re();be(Z(Ce,t,K),s,((e,t,s)=>{Y(e,t,s),F(s[c],(e=>Y(n,t,e)),(()=>oe(l,t)))})),Y(we,t,[n,l])}),((e,t)=>{Y(Ce,t),Y(we,t)})),nt=e=>be(pe,e,((e,t,s)=>{Y(pe,t,s),F(s[c],(e=>Y(Ie,t,e)),(()=>oe(Re,t)))}),((e,t)=>{Y(pe,t),Y(Ie,t),H(Re,t)})),lt=e=>D(e)?Yt():Ht(e),at=e=>be(Je,e,((e,t,s)=>rt(t,s)),((e,t)=>Tt(t))),rt=(e,t)=>be(Z(Je,e,(()=>(St(e,1),K()))),t,((t,s,n)=>ot(e,t,s,n)),((t,s)=>Vt(e,t,s))),ot=(e,t,s,n,l)=>be(Z(t,s,(()=>(yt(e,s,1),K()))),n,((t,n,l)=>ct(e,s,t,n,l)),((n,a)=>bt(e,t,s,n,a,l))),ct=(e,t,s,n,l)=>{W(s,n)||Ct(e,t,n,1);const a=U(s,n);l!==a&&(wt(e,t,n,a,l),Y(s,n,l))},it=(e,t,s,n,l)=>F(U(t,s),(t=>ct(e,s,t,n,l)),(()=>ot(e,t,s,et({[n]:l},e,s)))),dt=e=>D(e)?es():Kt(e),ut=e=>be(Le,e,((e,t,s)=>ht(t,s)),((e,t)=>vt(t))),ht=(e,t)=>{W(Le,e)||pt(e,1);const s=U(Le,e);t!==s&&(It(e,s,t),Y(Le,e,t))},ft=(e,t)=>{const[s]=Z(me,e,ie),n=s(t);return W(U(Je,e),n)?ft(e,t):n},gt=e=>U(Je,e)??rt(e,{}),Tt=e=>rt(e,{}),Vt=(e,t,s)=>{const[,n]=Z(me,e,ie);n(s),ot(e,t,s,{},!0)},bt=(e,t,s,n,l,a)=>{const r=U(U(we,e)?.[0],l);if(!E(r)&&!a)return ct(e,s,n,l,r);const o=t=>{wt(e,s,t,U(n,t)),Ct(e,s,t,-1),Y(n,t)};E(r)?o(l):X(n,o),$(n)&&(yt(e,s,-1),$(Y(t,s))&&(St(e,-1),Y(Je,e),Y(me,e)))},vt=e=>{const t=U(Ie,e);if(!E(t))return ht(e,t);It(e,U(Le,e)),pt(e,-1),Y(Le,e)},St=(e,t)=>Se(i,e,t),yt=(e,t,s)=>Se(Z(J,e,K),t,s),Ct=(e,t,s,n)=>Se(Z(Z(L,e,K),t,K),s,n),wt=(e,t,s,n,l)=>Z(Z(Z(O,e,K),t,K),s,(()=>[n,0]))[1]=l,pt=(e,t)=>Se(j,e,t),It=(e,t,s)=>Z(k,e,(()=>[t,0]))[1]=s,Rt=(e,t,s,n,l)=>(I(Z(Z(Z(M,e,K),t,K),s,(()=>[])),n),l),mt=(e,t,s)=>(I(Z(ce,e,(()=>[])),t),s),Jt=(e,t,s)=>F(U(U(U(O,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...de(Wt(e,t,s))])),Lt=e=>F(U(k,e),(([e,t])=>[!0,e,t]),(()=>[!1,...de(Gt(e))])),Et=e=>$(M)||$(Me[e])?0:G(e?le(M):M,((t,s)=>G(t,((t,n)=>G(t,((t,l)=>Ge(Me[e],[s,n,l],t))))))),Ft=e=>$(ce)||$(Ne[e])?0:G(e?se(ce):ce,((t,s)=>Ge(Ne[e],[s],t))),xt=(e,t,s)=>{if(!$(t))return Ge(e,s),1},zt=e=>{const t=$(Oe[e]),s=$(ke[e])&&$(ze[e])&&t&&$(Fe[e]),n=$(Ae[e])&&$(je[e])&&$(xe[e])&&$(Ee[e]);if(!s||!n){const l=e?[se(i),ne(J),le(L),le(O)]:[i,J,L,O];if(!s){G(l[2],((t,s)=>G(t,((t,n)=>xt(ke[e],t,[s,n])))));const s=re();G(l[1],((n,l)=>{xt(ze[e],n,[l])&&!t&&(Ge(Oe[e],[l,null]),oe(s,l))})),t||G(l[3],((t,n)=>{if(!W(s,n)){const s=re();G(t,(e=>G(e,(([t,n],l)=>n!==t?oe(s,l):H(e,l))))),G(s,(t=>Ge(Oe[e],[n,t])))}})),xt(Fe[e],l[0])}if(!n){let t;G(l[3],((s,n)=>{let l;G(s,((s,a)=>{let r;G(s,(([s,o],c)=>{o!==s&&(Ge(Ae[e],[n,a,c],o,s,Jt),t=l=r=1)})),r&&Ge(je[e],[n,a],Jt)})),l&&Ge(xe[e],[n],Jt)})),t&&Ge(Ee[e],void 0,Jt)}}},Ot=e=>{const t=$(Be[e]),s=$(De[e])&&$(Pe[e]);if(!t||!s){const n=e?[se(j),se(k)]:[j,k];if(t||xt(Be[e],n[0]),!s){let t;G(n[1],(([s,n],l)=>{n!==s&&(Ge(De[e],[l],n,s,Lt),t=1)})),t&&Ge(Pe[e],void 0,Lt)}}},jt=(e,...t)=>(ns((()=>e(...C(t,S)))),rs),kt=()=>[_(O,((e,t)=>-1===U(i,t)?null:_(e,((e,s)=>-1===U(U(J,t),s)?null:_(e,(([,e])=>e??null),((e,t)=>fe(t)))),D)),D),_(k,(([,e])=>e??null),((e,t)=>fe(t)))],At=()=>({cellsTouched:n,valuesTouched:l,changedCells:te(O,he,fe),invalidCells:te(M),changedValues:_(k,he,fe),invalidValues:_(ce),changedTableIds:_(i),changedRowIds:ee(J),changedCellIds:te(L),changedValueIds:_(j)}),Mt=()=>te(Je),Nt=()=>Q(Je),Pt=e=>Q(U(Je,S(e))),Bt=(e,t,s,n=0,l)=>{return C(p((r=U(Je,S(e)),o=(e,s)=>[E(t)?s:U(e,S(t)),s],a=([e],[t])=>(e<t?-1:1)*(s?-1:1),C([...r?.entries()??[]],(([e,t])=>o(t,e))).sort(a)),n,E(l)?l:n+l),(([,e])=>e));var a,r,o},Dt=(e,t)=>Q(U(U(Je,S(e)),S(t))),Wt=(e,t,s)=>U(U(U(Je,S(e)),S(t)),S(s)),$t=()=>_(Le),qt=()=>Q(Le),Gt=e=>U(Le,S(e)),Ht=e=>jt((()=>(e=>ve(e,Ue,Rt))(e)?at(e):0)),Kt=e=>jt((()=>Ze(e)?ut(e):0)),Qt=e=>{try{lt(m(e))}catch{}return rs},Ut=t=>jt((()=>{if((e=ve(t,(e=>ve(e,Qe))))&&(st(t),!$(Je))){const e=Mt();Yt(),Ht(e)}})),Xt=e=>jt((()=>{if(t=(e=>ve(e,Qe))(e)){const s=$t();ss(),es(),t=!0,nt(e),Kt(s)}})),Yt=()=>jt((()=>at({}))),Zt=e=>jt((e=>W(Je,e)?Tt(e):0),e),_t=(e,t)=>jt(((e,t)=>F(U(Je,e),(s=>W(s,t)?Vt(e,s,t):0))),e,t),es=()=>jt((()=>ut({}))),ts=()=>jt((()=>{st({}),e=!1})),ss=()=>jt((()=>{nt({}),t=!1})),ns=(e,t)=>{if(-1!=r){ls();const s=e();return as(t),s}},ls=()=>(-1!=r&&r++,1==r&&Ge(We,void 0,kt,At),rs),as=e=>(r>0&&(r--,0==r&&(n=!$(O),l=!$(k),r=1,Et(1),n&&zt(1),Ft(1),l&&Ot(1),e?.(kt,At)&&(G(O,((e,t)=>G(e,((e,s)=>G(e,(([e],n)=>Te(rs,t,s,n,e))))))),G(k,(([e],t)=>Ve(rs,t,e))),n=l=!1),Ge($e[0],void 0,kt,At),r=-1,Et(0),n&&zt(0),Ft(0),l&&Ot(0),Ge($e[1],void 0,kt,At),r=0,n=l=!1,y([i,J,L,O,M,j,k,ce],q))),rs),rs={getContent:()=>[Mt(),$t()],getTables:Mt,getTableIds:Nt,getTable:e=>ee(U(Je,S(e))),getRowIds:Pt,getSortedRowIds:Bt,getRow:(e,t)=>_(U(U(Je,S(e)),S(t))),getCellIds:Dt,getCell:Wt,getValues:$t,getValueIds:qt,getValue:Gt,hasTables:()=>!$(Je),hasTable:e=>W(Je,S(e)),hasRow:(e,t)=>W(U(Je,S(e)),S(t)),hasCell:(e,t,s)=>W(U(U(Je,S(e)),S(t)),S(s)),hasValues:()=>!$(Le),hasValue:e=>W(Le,S(e)),getTablesJson:()=>R(Je),getValuesJson:()=>R(Le),getJson:()=>R([Je,Le]),getTablesSchemaJson:()=>R(Ce),getValuesSchemaJson:()=>R(pe),getSchemaJson:()=>R([Ce,pe]),setContent:([e,t])=>jt((()=>{Ht(e),Kt(t)})),setTables:Ht,setTable:(e,t)=>jt((e=>Ue(t,e)?rt(e,t):0),e),setRow:(e,t,s)=>jt(((e,t)=>Xe(e,t,s)?ot(e,gt(e),t,s):0),e,t),addRow:(e,t,s=!0)=>ns((()=>{let n;return Xe(e,n,t)&&(e=S(e),ot(e,gt(e),n=ft(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>jt(((e,t)=>{if(Xe(e,t,s,1)){const n=gt(e);B(s,((s,l)=>it(e,n,t,l,s)))}}),e,t),setCell:(e,t,s,n)=>jt(((e,t,s)=>F(Ye(e,t,s,z(n)?n(Wt(e,t,s)):n),(n=>it(e,gt(e),t,s,n)))),e,t,s),setValues:Kt,setPartialValues:e=>jt((()=>Ze(e,1)?B(e,((e,t)=>ht(t,e))):0)),setValue:(e,t)=>jt((e=>F(_e(e,z(t)?t(Gt(e)):t),(t=>ht(e,t)))),e),setTransactionChanges:e=>jt((()=>{B(e[0],((e,t)=>E(e)?Zt(t):B(e,((e,s)=>E(e)?_t(t,s):B(e,((e,n)=>Te(rs,t,s,n,e))))))),B(e[1],((e,t)=>Ve(rs,t,e)))})),setTablesJson:Qt,setValuesJson:e=>{try{dt(m(e))}catch{}return rs},setJson:e=>{try{const[t,s]=m(e);lt(t),dt(s)}catch{Qt(e)}return rs},setTablesSchema:Ut,setValuesSchema:Xt,setSchema:(e,t)=>jt((()=>{Ut(e),Xt(t)})),delTables:Yt,delTable:Zt,delRow:_t,delCell:(e,t,s,n)=>jt(((e,t,s)=>F(U(Je,e),(l=>F(U(l,t),(a=>W(a,s)?bt(e,l,t,a,s,n):0))))),e,t,s),delValues:es,delValue:e=>jt((e=>W(Le,e)?vt(e):0),e),delTablesSchema:ts,delValuesSchema:ss,delSchema:()=>jt((()=>{ts(),ss()})),transaction:ns,startTransaction:ls,finishTransaction:as,forEachTable:e=>G(Je,((t,s)=>e(s,(e=>G(t,((t,s)=>e(s,(e=>X(t,e))))))))),forEachRow:(e,t)=>G(U(Je,S(e)),((e,s)=>t(s,(t=>X(e,t))))),forEachCell:(e,t,s)=>X(U(U(Je,S(e)),S(t)),s),forEachValue:e=>X(Le,e),addSortedRowIdsListener:(e,t,s,n,l,a,r)=>{let o=Bt(e,t,s,n,l);return qe((()=>{const r=Bt(e,t,s,n,l);var c,i,d;i=o,w(c=r)===w(i)&&(d=(e,t)=>i[t]===e,c.every(d))||(o=r,a(rs,e,t,s,n,l,o))}),Oe[r?1:0],[e,t],[Nt])},addStartTransactionListener:e=>qe(e,We),addWillFinishTransactionListener:e=>qe(e,$e[0]),addDidFinishTransactionListener:e=>qe(e,$e[1]),callListener:e=>(Ke(e),rs),delListener:e=>(He(e),rs),getListenerStats:()=>({}),createStore:ye};return B({[u]:[0,Ee],[h]:[0,Fe],[d]:[1,xe,[Nt]],[f]:[1,ze,[Nt]],Row:[2,je,[Nt,Pt]],[T]:[2,ke,[Nt,Pt]],[g]:[3,Ae,[Nt,Pt,Dt],e=>de(Wt(...e))],InvalidCell:[3,Me],[b]:[0,Pe],[v]:[0,Be],[V]:[1,De,[qt],e=>de(Gt(e[0]))],InvalidValue:[1,Ne]},(([e,t,s,n],l)=>{rs["add"+l+"Listener"]=(...l)=>qe(l[e],t[l[e+1]?1:0],e>0?p(l,0,e):void 0,s,n)})),A(rs)};e.createStore=ye},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
