var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",n=t(s),l=t(!0),a=t(0),r=t(t),o="type",c="default",i="Ids",d="Table",u=d+"s",h=d+i,f="Row"+i,g="Cell",T=g+i,V="Value",b=V+"s",v=V+i,S=e=>s+e,y=(e,t)=>e.forEach(t),C=(e,t)=>e.map(t),w=e=>e.length,p=(e,t,s)=>e.slice(t,s),I=(e,...t)=>e.push(...t),R=e=>JSON.stringify(e,((e,t)=>{return L(t,Map)?(s=(e,[t,s])=>(e[t]=s,e),n={},[...t].reduce(s,n)):t;var s,n})),m=JSON.parse,J=isFinite,L=(e,t)=>e instanceof t,E=e=>null==e,F=(e,t,s)=>E(e)?s?.():t(e),x=e=>e==n||e==l,z=e=>t(e)==r,O=Object,j=O.keys,k=O.isFrozen,A=O.freeze,M=e=>L(e,O)&&e.constructor==O,N=(e,t)=>!E(((e,t)=>F(e,(e=>e[t])))(e,t)),P=(e,t)=>delete e[t],B=(e,t)=>C(O.entries(e),(([e,s])=>t(s,e))),D=e=>{return M(e)&&(t=j(e),0==w(t));var t},W=(e,t)=>e?.has(t)??!1,$=e=>E(e)||0==(e=>e.size)(e),q=e=>e.clear(),G=(e,t)=>e?.forEach(t),H=(e,t)=>e?.delete(t),K=e=>new Map(e),Q=e=>[...e?.keys()??[]],U=(e,t)=>e?.get(t),X=(e,t)=>G(e,((e,s)=>t(s,e))),Y=(e,t,s)=>E(s)?(H(e,t),e):e?.set(t,s),Z=(e,t,s)=>(W(e,t)||Y(e,t,s()),U(e,t)),_=(e,t,s)=>{const n={};return G(e,((e,l)=>{const a=t?t(e,l):e;!s?.(a,e)&&(n[l]=a)})),n},ee=(e,t,s)=>_(e,(e=>_(e,t,s)),D),te=(e,t,s)=>_(e,(e=>ee(e,t,s)),D),se=(e,t)=>{const s=K();return G(e,((e,n)=>s.set(n,t?.(e)??e))),s},ne=e=>se(e,se),le=e=>se(e,ne),ae=(e,t,s,n,l=0)=>F((s?Z:U)(e,t[l],l>w(t)-2?s:K),(a=>{if(l>w(t)-2)return n?.(a)&&Y(e,t[l]),a;const r=ae(a,t,s,n,l+1);return $(a)&&Y(e,t[l]),r})),re=e=>new Set(Array.isArray(e)||E(e)?e:[e]),oe=(e,t)=>e?.add(t),ce=/^\d+$/,ie=()=>{const e=[];let t=0;return[n=>(n?e.shift():null)??s+t++,t=>{ce.test(t)&&w(e)<1e3&&I(e,t)}]},de=e=>[e,e],ue=()=>[K(),K()],he=e=>[...e],fe=([e,t])=>e===t,ge=e=>{const s=t(e);return x(s)||s==a&&J(e)?s:void 0},Te=(e,t,s,n,l)=>E(l)?e.delCell(t,s,n,!0):e.setCell(t,s,n,l),Ve=(e,t,s)=>E(s)?e.delValue(t):e.setValue(t,s),be=(e,t,s,n=Y)=>(B(t,((t,n)=>s(e,n,t))),X(e,(s=>N(t,s)?0:n(e,s))),e),ve=(e,t,s)=>E(e)||!M(e)||D(e)||k(e)?(s?.(),!1):(B(e,((s,n)=>{t(s,n)||P(e,n)})),!D(e)),Se=(e,t,s)=>Y(e,t,U(e,t)==-s?void 0:s),ye=()=>{let e,t,n,l,r=0;const i=K(),J=K(),L=K(),O=K(),j=K(),k=K(),M=K(),ce=K(),Ce=K(),we=K(),pe=K(),Ie=K(),Re=re(),me=K(),Je=K(),Le=K(),Ee=ue(),Fe=ue(),xe=ue(),ze=ue(),Oe=ue(),je=ue(),ke=ue(),Ae=ue(),Me=ue(),Ne=ue(),Pe=ue(),Be=ue(),De=ue(),We=ue(),[$e,qe,Ge,He]=(e=>{let t;const[n,l]=ie(),a=K();return[(e,l,r,o=[],c=(()=>[]))=>{t??=as;const i=n(1);return Y(a,i,[e,l,r,o,c]),oe(ae(l,r??[s],re),i),i},(e,n,...l)=>y(((e,t=[s])=>{const n=[],l=(e,s)=>s==w(t)?I(n,e):null===t[s]?G(e,(e=>l(e,s+1))):y([t[s],null],(t=>l(U(e,t),s+1)));return l(e,0),n})(e,n),(e=>G(e,(e=>U(a,e)[0](t,...n??[],...l))))),e=>F(U(a,e),(([,t,n])=>(ae(t,n??[s],void 0,(t=>(H(t,e),$(t)?1:0))),Y(a,e),l(e),n))),e=>F(U(a,e),(([e,,s=[],n,l])=>{const a=(...r)=>{const o=w(r);o==w(s)?e(t,...r,...l(r)):E(s[o])?y(n[o]?.(...r)??[],(e=>a(...r,e))):a(...r,s[o])};a()}))]})(),Ke=e=>{if(!ve(e,((e,t)=>[o,c].includes(t))))return!1;const t=e[o];return!(!x(t)&&t!=a||(ge(e[c])!=t&&P(e,c),0))},Qe=(t,s)=>(!e||W(Ce,s)||It(s))&&ve(t,((e,t)=>Ue(s,t,e)),(()=>It(s))),Ue=(e,t,s,n)=>ve(n?s:_e(s,e,t),((n,l)=>F(Xe(e,t,l,n),(e=>(s[l]=e,!0)),(()=>!1))),(()=>It(e,t))),Xe=(t,s,n,l)=>e?F(U(U(Ce,t),n),(e=>ge(l)!=e[o]?It(t,s,n,l,e[c]):l),(()=>It(t,s,n,l))):E(ge(l))?It(t,s,n,l):l,Ye=(e,t)=>ve(t?e:et(e),((t,s)=>F(Ze(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>Rt())),Ze=(e,s)=>t?F(U(pe,e),(t=>ge(s)!=t[o]?Rt(e,s,t[c]):s),(()=>Rt(e,s))):E(ge(s))?Rt(e,s):s,_e=(e,t,s)=>(F(U(we,t),(([n,l])=>{G(n,((t,s)=>{N(e,s)||(e[s]=t)})),G(l,(n=>{N(e,n)||It(t,s,n)}))})),e),et=e=>(t&&(G(Ie,((t,s)=>{N(e,s)||(e[s]=t)})),G(Re,(t=>{N(e,t)||Rt(t)}))),e),tt=e=>be(Ce,e,((e,t,s)=>{const n=K(),l=re();be(Z(Ce,t,K),s,((e,t,s)=>{Y(e,t,s),F(s[c],(e=>Y(n,t,e)),(()=>oe(l,t)))})),Y(we,t,[n,l])}),((e,t)=>{Y(Ce,t),Y(we,t)})),st=e=>be(pe,e,((e,t,s)=>{Y(pe,t,s),F(s[c],(e=>Y(Ie,t,e)),(()=>oe(Re,t)))}),((e,t)=>{Y(pe,t),Y(Ie,t),H(Re,t)})),nt=e=>D(e)?Xt():Gt(e),lt=e=>be(Je,e,((e,t,s)=>at(t,s)),((e,t)=>gt(t))),at=(e,t)=>be(Z(Je,e,(()=>(vt(e,1),K()))),t,((t,s,n)=>rt(e,t,s,n)),((t,s)=>Tt(e,t,s))),rt=(e,t,s,n,l)=>be(Z(t,s,(()=>(St(e,s,1),K()))),n,((t,n,l)=>ot(e,s,t,n,l)),((n,a)=>Vt(e,t,s,n,a,l))),ot=(e,t,s,n,l)=>{W(s,n)||yt(e,t,n,1);const a=U(s,n);l!==a&&(Ct(e,t,n,a,l),Y(s,n,l))},ct=(e,t,s,n,l)=>F(U(t,s),(t=>ot(e,s,t,n,l)),(()=>rt(e,t,s,_e({[n]:l},e,s)))),it=e=>D(e)?_t():Ht(e),dt=e=>be(Le,e,((e,t,s)=>ut(t,s)),((e,t)=>bt(t))),ut=(e,t)=>{W(Le,e)||wt(e,1);const s=U(Le,e);t!==s&&(pt(e,s,t),Y(Le,e,t))},ht=(e,t)=>{const[s]=Z(me,e,ie),n=s(t);return W(U(Je,e),n)?ht(e,t):n},ft=e=>U(Je,e)??at(e,{}),gt=e=>at(e,{}),Tt=(e,t,s)=>{const[,n]=Z(me,e,ie);n(s),rt(e,t,s,{},!0)},Vt=(e,t,s,n,l,a)=>{const r=U(U(we,e)?.[0],l);if(!E(r)&&!a)return ot(e,s,n,l,r);const o=t=>{Ct(e,s,t,U(n,t)),yt(e,s,t,-1),Y(n,t)};E(r)?o(l):X(n,o),$(n)&&(St(e,s,-1),$(Y(t,s))&&(vt(e,-1),Y(Je,e),Y(me,e)))},bt=e=>{const t=U(Ie,e);if(!E(t))return ut(e,t);pt(e,U(Le,e)),wt(e,-1),Y(Le,e)},vt=(e,t)=>Se(i,e,t),St=(e,t,s)=>Se(Z(J,e,K),t,s),yt=(e,t,s,n)=>Se(Z(Z(L,e,K),t,K),s,n),Ct=(e,t,s,n,l)=>Z(Z(Z(O,e,K),t,K),s,(()=>[n,0]))[1]=l,wt=(e,t)=>Se(j,e,t),pt=(e,t,s)=>Z(k,e,(()=>[t,0]))[1]=s,It=(e,t,s,n,l)=>(I(Z(Z(Z(M,e,K),t,K),s,(()=>[])),n),l),Rt=(e,t,s)=>(I(Z(ce,e,(()=>[])),t),s),mt=(e,t,s)=>F(U(U(U(O,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...de(Dt(e,t,s))])),Jt=e=>F(U(k,e),(([e,t])=>[!0,e,t]),(()=>[!1,...de(qt(e))])),Lt=e=>$(M)||$(Me[e])?0:G(e?le(M):M,((t,s)=>G(t,((t,n)=>G(t,((t,l)=>qe(Me[e],[s,n,l],t))))))),Et=e=>$(ce)||$(Ne[e])?0:G(e?se(ce):ce,((t,s)=>qe(Ne[e],[s],t))),Ft=(e,t,s)=>{if(!$(t))return qe(e,s),1},xt=e=>{const t=$(Oe[e]),s=$(ke[e])&&$(ze[e])&&t&&$(Fe[e]),n=$(Ae[e])&&$(je[e])&&$(xe[e])&&$(Ee[e]);if(!s||!n){const l=e?[se(i),ne(J),le(L),le(O)]:[i,J,L,O];if(!s){G(l[2],((t,s)=>G(t,((t,n)=>Ft(ke[e],t,[s,n])))));const s=re();G(l[1],((n,l)=>{Ft(ze[e],n,[l])&&!t&&(qe(Oe[e],[l,null]),oe(s,l))})),t||G(l[3],((t,n)=>{if(!W(s,n)){const s=re();G(t,(e=>G(e,(([t,n],l)=>n!==t?oe(s,l):H(e,l))))),G(s,(t=>qe(Oe[e],[n,t])))}})),Ft(Fe[e],l[0])}if(!n){let t;G(l[3],((s,n)=>{let l;G(s,((s,a)=>{let r;G(s,(([s,o],c)=>{o!==s&&(qe(Ae[e],[n,a,c],o,s,mt),t=l=r=1)})),r&&qe(je[e],[n,a],mt)})),l&&qe(xe[e],[n],mt)})),t&&qe(Ee[e],void 0,mt)}}},zt=e=>{const t=$(Be[e]),s=$(De[e])&&$(Pe[e]);if(!t||!s){const n=e?[se(j),se(k)]:[j,k];if(t||Ft(Be[e],n[0]),!s){let t;G(n[1],(([s,n],l)=>{n!==s&&(qe(De[e],[l],n,s,Jt),t=1)})),t&&qe(Pe[e],void 0,Jt)}}},Ot=(e,...t)=>(ss((()=>e(...C(t,S)))),as),jt=()=>[_(O,((e,t)=>-1===U(i,t)?null:_(e,((e,s)=>-1===U(U(J,t),s)?null:_(e,(([,e])=>e??null),((e,t)=>fe(t)))),D)),D),_(k,(([,e])=>e??null),((e,t)=>fe(t)))],kt=()=>({cellsTouched:n,valuesTouched:l,changedCells:te(O,he,fe),invalidCells:te(M),changedValues:_(k,he,fe),invalidValues:_(ce),changedTableIds:_(i),changedRowIds:ee(J),changedCellIds:te(L),changedValueIds:_(j)}),At=()=>te(Je),Mt=()=>Q(Je),Nt=e=>Q(U(Je,S(e))),Pt=(e,t,s,n=0,l)=>{return C(p((r=U(Je,S(e)),o=(e,s)=>[E(t)?s:U(e,S(t)),s],a=([e],[t])=>(e<t?-1:1)*(s?-1:1),C([...r?.entries()??[]],(([e,t])=>o(t,e))).sort(a)),n,E(l)?l:n+l),(([,e])=>e));var a,r,o},Bt=(e,t)=>Q(U(U(Je,S(e)),S(t))),Dt=(e,t,s)=>U(U(U(Je,S(e)),S(t)),S(s)),Wt=()=>_(Le),$t=()=>Q(Le),qt=e=>U(Le,S(e)),Gt=e=>Ot((()=>(e=>ve(e,Qe,It))(e)?lt(e):0)),Ht=e=>Ot((()=>Ye(e)?dt(e):0)),Kt=e=>{try{nt(m(e))}catch{}return as},Qt=t=>Ot((()=>{if((e=ve(t,(e=>ve(e,Ke))))&&(tt(t),!$(Je))){const e=At();Xt(),Gt(e)}})),Ut=e=>Ot((()=>{if(t=(e=>ve(e,Ke))(e)){const s=Wt();ts(),_t(),t=!0,st(e),Ht(s)}})),Xt=()=>Ot((()=>lt({}))),Yt=e=>Ot((e=>W(Je,e)?gt(e):0),e),Zt=(e,t)=>Ot(((e,t)=>F(U(Je,e),(s=>W(s,t)?Tt(e,s,t):0))),e,t),_t=()=>Ot((()=>dt({}))),es=()=>Ot((()=>{tt({}),e=!1})),ts=()=>Ot((()=>{st({}),t=!1})),ss=(e,t)=>{if(-1==r)return;ns();const s=e();return ls(t),s},ns=()=>(r++,as),ls=e=>(r>0&&(r--,0==r&&(n=!$(O),l=!$(k),r=1,Lt(1),n&&xt(1),Et(1),l&&zt(1),r=-1,e?.(jt,kt)&&(r=1,G(O,((e,t)=>G(e,((e,s)=>G(e,(([e],n)=>Te(as,t,s,n,e))))))),G(k,(([e],t)=>Ve(as,t,e))),r=-1,n=l=!1),qe(We[0],void 0,jt,kt),Lt(0),n&&xt(0),Et(0),l&&zt(0),qe(We[1],void 0,jt,kt),r=0,y([i,J,L,O,M,j,k,ce],q))),as),as={getContent:()=>[At(),Wt()],getTables:At,getTableIds:Mt,getTable:e=>ee(U(Je,S(e))),getRowIds:Nt,getSortedRowIds:Pt,getRow:(e,t)=>_(U(U(Je,S(e)),S(t))),getCellIds:Bt,getCell:Dt,getValues:Wt,getValueIds:$t,getValue:qt,hasTables:()=>!$(Je),hasTable:e=>W(Je,S(e)),hasRow:(e,t)=>W(U(Je,S(e)),S(t)),hasCell:(e,t,s)=>W(U(U(Je,S(e)),S(t)),S(s)),hasValues:()=>!$(Le),hasValue:e=>W(Le,S(e)),getTablesJson:()=>R(Je),getValuesJson:()=>R(Le),getJson:()=>R([Je,Le]),getTablesSchemaJson:()=>R(Ce),getValuesSchemaJson:()=>R(pe),getSchemaJson:()=>R([Ce,pe]),setContent:([e,t])=>Ot((()=>{Gt(e),Ht(t)})),setTables:Gt,setTable:(e,t)=>Ot((e=>Qe(t,e)?at(e,t):0),e),setRow:(e,t,s)=>Ot(((e,t)=>Ue(e,t,s)?rt(e,ft(e),t,s):0),e,t),addRow:(e,t,s=!0)=>ss((()=>{let n;return Ue(e,n,t)&&(e=S(e),rt(e,ft(e),n=ht(e,s?1:0),t)),n})),setPartialRow:(e,t,s)=>Ot(((e,t)=>{if(Ue(e,t,s,1)){const n=ft(e);B(s,((s,l)=>ct(e,n,t,l,s)))}}),e,t),setCell:(e,t,s,n)=>Ot(((e,t,s)=>F(Xe(e,t,s,z(n)?n(Dt(e,t,s)):n),(n=>ct(e,ft(e),t,s,n)))),e,t,s),setValues:Ht,setPartialValues:e=>Ot((()=>Ye(e,1)?B(e,((e,t)=>ut(t,e))):0)),setValue:(e,t)=>Ot((e=>F(Ze(e,z(t)?t(qt(e)):t),(t=>ut(e,t)))),e),setTransactionChanges:e=>Ot((()=>{B(e[0],((e,t)=>E(e)?Yt(t):B(e,((e,s)=>E(e)?Zt(t,s):B(e,((e,n)=>Te(as,t,s,n,e))))))),B(e[1],((e,t)=>Ve(as,t,e)))})),setTablesJson:Kt,setValuesJson:e=>{try{it(m(e))}catch{}return as},setJson:e=>{try{const[t,s]=m(e);nt(t),it(s)}catch{Kt(e)}return as},setTablesSchema:Qt,setValuesSchema:Ut,setSchema:(e,t)=>Ot((()=>{Qt(e),Ut(t)})),delTables:Xt,delTable:Yt,delRow:Zt,delCell:(e,t,s,n)=>Ot(((e,t,s)=>F(U(Je,e),(l=>F(U(l,t),(a=>W(a,s)?Vt(e,l,t,a,s,n):0))))),e,t,s),delValues:_t,delValue:e=>Ot((e=>W(Le,e)?bt(e):0),e),delTablesSchema:es,delValuesSchema:ts,delSchema:()=>Ot((()=>{es(),ts()})),transaction:ss,startTransaction:ns,finishTransaction:ls,forEachTable:e=>G(Je,((t,s)=>e(s,(e=>G(t,((t,s)=>e(s,(e=>X(t,e))))))))),forEachRow:(e,t)=>G(U(Je,S(e)),((e,s)=>t(s,(t=>X(e,t))))),forEachCell:(e,t,s)=>X(U(U(Je,S(e)),S(t)),s),forEachValue:e=>X(Le,e),addSortedRowIdsListener:(e,t,s,n,l,a,r)=>{let o=Pt(e,t,s,n,l);return $e((()=>{const r=Pt(e,t,s,n,l);var c,i,d;i=o,w(c=r)===w(i)&&(d=(e,t)=>i[t]===e,c.every(d))||(o=r,a(as,e,t,s,n,l,o))}),Oe[r?1:0],[e,t],[Mt])},addWillFinishTransactionListener:e=>$e(e,We[0]),addDidFinishTransactionListener:e=>$e(e,We[1]),callListener:e=>(He(e),as),delListener:e=>(Ge(e),as),getListenerStats:()=>({}),createStore:ye};return B({[u]:[0,Ee],[h]:[0,Fe],[d]:[1,xe,[Mt]],[f]:[1,ze,[Mt]],Row:[2,je,[Mt,Nt]],[T]:[2,ke,[Mt,Nt]],[g]:[3,Ae,[Mt,Nt,Bt],e=>de(Dt(...e))],InvalidCell:[3,Me],[b]:[0,Pe],[v]:[0,Be],[V]:[1,De,[$t],e=>de(qt(e[0]))],InvalidValue:[1,Ne]},(([e,t,s,n],l)=>{as["add"+l+"Listener"]=(...l)=>$e(l[e],t[l[e+1]?1:0],e>0?p(l,0,e):void 0,s,n)})),A(as)};e.createStore=ye},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
