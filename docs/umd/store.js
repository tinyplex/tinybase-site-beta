var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,s="",l=t(s),n=t(!0),a=t(0),o=t(t),r="type",c="default",i="Ids",d="Table",u=d+"s",h=d+i,f="Row",g=f+"Count",T=f+i,b="Cell",V=b+i,C="Value",S=C+"s",v=C+i,y=e=>s+e,p=isFinite,m=e=>null==e,w=(e,t,s)=>m(e)?s?.():t(e),I=e=>e==l||e==n,R=e=>t(e)==o,J=(e,t,s)=>e.slice(t,s),L=e=>e.length,E=(e,t)=>e.forEach(t),F=(e,t)=>e.map(t),O=(e,...t)=>e.push(...t),x=Object,z=e=>x.getPrototypeOf(e),P=x.keys,j=x.isFrozen,k=x.freeze,A=e=>!m(e)&&w(z(e),(e=>e==x.prototype||m(z(e))),(()=>!0)),M=(e,t)=>!m(((e,t)=>w(e,(e=>e[t])))(e,t)),N=(e,t)=>(delete e[t],e),B=(e,t)=>F(x.entries(e),(([e,s])=>t(s,e))),D=e=>A(e)&&0==(e=>L(P(e)))(e),W=e=>e?.size??0,$=(e,t)=>e?.has(t)??!1,q=e=>m(e)||0==W(e),G=e=>e.clear(),H=(e,t)=>e?.forEach(t),K=(e,t)=>e?.delete(t),Q=e=>new Map(e),U=e=>[...e?.keys()??[]],X=(e,t)=>e?.get(t),Y=(e,t)=>H(e,((e,s)=>t(s,e))),Z=(e,t,s)=>m(s)?(K(e,t),e):e?.set(t,s),_=(e,t,s)=>($(e,t)||Z(e,t,s()),X(e,t)),ee=(e,t,s,l=Z)=>(B(t,((t,l)=>s(e,l,t))),Y(e,(s=>M(t,s)?0:l(e,s))),e),te=(e,t,s)=>{const l={};return H(e,((e,n)=>{const a=t?t(e,n):e;!s?.(a,e)&&(l[n]=a)})),l},se=(e,t,s)=>te(e,(e=>te(e,t,s)),D),le=(e,t,s)=>te(e,(e=>se(e,t,s)),D),ne=(e,t)=>{const s=Q();return H(e,((e,l)=>s.set(l,t?.(e)??e))),s},ae=e=>ne(e,ne),oe=e=>ne(e,ae),re=(e,t,s,l,n=0)=>w((s?_:X)(e,t[n],n>L(t)-2?s:Q),(a=>{if(n>L(t)-2)return l?.(a)&&Z(e,t[n]),a;const o=re(a,t,s,l,n+1);return q(a)&&Z(e,t[n]),o})),ce=e=>new Set(Array.isArray(e)||m(e)?e:[e]),ie=(e,t)=>e?.add(t),de=/^\d+$/,ue=()=>{const e=[];let t=0;return[l=>(l?e.shift():null)??s+t++,t=>{de.test(t)&&L(e)<1e3&&O(e,t)}]},he=e=>[e,e],fe=()=>[Q(),Q()],ge=e=>[...e],Te=([e,t])=>e===t,be=e=>{const s=t(e);return I(s)||s==a&&p(e)?s:void 0},Ve=(e,t,s,l,n)=>m(n)?e.delCell(t,s,l,!0):e.setCell(t,s,l,n),Ce=(e,t,s)=>m(s)?e.delValue(t):e.setValue(t,s),Se=e=>JSON.stringify(e,((e,t)=>t instanceof Map?x.fromEntries([...t]):t)),ve=JSON.parse,ye=(e,t,s)=>m(e)||!A(e)||D(e)||j(e)?(s?.(),!1):(B(e,((s,l)=>{t(s,l)||N(e,l)})),!D(e)),pe=(e,t,s)=>Z(e,t,X(e,t)==-s?void 0:s),me=()=>{let e,t,l=!1,n=!1,o=0;const i=Q(),p=Q(),x=Q(),z=Q(),P=Q(),j=Q(),A=Q(),de=Q(),we=Q(),Ie=Q(),Re=Q(),Je=Q(),Le=Q(),Ee=Q(),Fe=ce(),Oe=Q(),xe=Q(),ze=Q(),Pe=Q(),je=fe(),ke=fe(),Ae=fe(),Me=fe(),Ne=fe(),Be=fe(),De=fe(),We=fe(),$e=fe(),qe=fe(),Ge=fe(),He=fe(),Ke=fe(),Qe=fe(),Ue=fe(),Xe=Q(),Ye=fe(),[Ze,_e,et,tt]=(e=>{let t;const[l,n]=ue(),a=Q();return[(e,n,o,r=[],c=(()=>[]))=>{t??=Ts;const i=l(1);return Z(a,i,[e,n,o,r,c]),ie(re(n,o??[s],ce),i),i},(e,l,...n)=>E(((e,t=[s])=>{const l=[],n=(e,s)=>s==L(t)?O(l,e):null===t[s]?H(e,(e=>n(e,s+1))):E([t[s],null],(t=>n(X(e,t),s+1)));return n(e,0),l})(e,l),(e=>H(e,(e=>X(a,e)[0](t,...l??[],...n))))),e=>w(X(a,e),(([,t,l])=>(re(t,l??[s],void 0,(t=>(K(t,e),q(t)?1:0))),Z(a,e),n(e),l))),e=>w(X(a,e),(([e,,s=[],l,n])=>{const a=(...o)=>{const r=L(o);r==L(s)?e(t,...o,...n(o)):m(s[r])?E(l[r]?.(...o)??[],(e=>a(...o,e))):a(...o,s[r])};a()}))]})(),st=e=>{if(!ye(e,((e,t)=>[r,c].includes(t))))return!1;const t=e[r];return!(!I(t)&&t!=a||(be(e[c])!=t&&N(e,c),0))},lt=(t,s)=>(!e||$(Re,s)||zt(s))&&ye(t,((e,t)=>nt(s,t,e)),(()=>zt(s))),nt=(e,t,s,l)=>ye(l?s:ct(s,e,t),((l,n)=>w(at(e,t,n,l),(e=>(s[n]=e,!0)),(()=>!1))),(()=>zt(e,t))),at=(t,s,l,n)=>e?w(X(X(Re,t),l),(e=>be(n)!=e[r]?zt(t,s,l,n,e[c]):n),(()=>zt(t,s,l,n))):m(be(n))?zt(t,s,l,n):n,ot=(e,t)=>ye(t?e:it(e),((t,s)=>w(rt(s,t),(t=>(e[s]=t,!0)),(()=>!1))),(()=>Pt())),rt=(e,s)=>t?w(X(Le,e),(t=>be(s)!=t[r]?Pt(e,s,t[c]):s),(()=>Pt(e,s))):m(be(s))?Pt(e,s):s,ct=(e,t,s)=>(w(X(Je,t),(([l,n])=>{H(l,((t,s)=>{M(e,s)||(e[s]=t)})),H(n,(l=>{M(e,l)||zt(t,s,l)}))})),e),it=e=>(t&&(H(Ee,((t,s)=>{M(e,s)||(e[s]=t)})),H(Fe,(t=>{M(e,t)||Pt(t)}))),e),dt=e=>ee(Re,e,((e,t,s)=>{const l=Q(),n=ce();ee(_(Re,t,Q),s,((e,t,s)=>{Z(e,t,s),w(s[c],(e=>Z(l,t,e)),(()=>ie(n,t)))})),Z(Je,t,[l,n])}),((e,t)=>{Z(Re,t),Z(Je,t)})),ut=e=>ee(Le,e,((e,t,s)=>{Z(Le,t,s),w(s[c],(e=>Z(Ee,t,e)),(()=>ie(Fe,t)))}),((e,t)=>{Z(Le,t),Z(Ee,t),K(Fe,t)})),ht=e=>D(e)?os():ts(e),ft=e=>ee(ze,e,((e,t,s)=>gt(t,s)),((e,t)=>mt(t))),gt=(e,t)=>ee(_(ze,e,(()=>(Jt(e,1),Z(Oe,e,ue()),Z(xe,e,Q()),Q()))),t,((t,s,l)=>Tt(e,t,s,l)),((t,s)=>wt(e,t,s))),Tt=(e,t,s,l,n)=>ee(_(t,s,(()=>(Lt(e,s,1),Q()))),l,((t,l,n)=>bt(e,s,t,l,n)),((l,a)=>It(e,t,s,l,a,n))),bt=(e,t,s,l,n)=>{$(s,l)||Et(e,t,l,1);const a=X(s,l);n!==a&&(Ft(e,t,l,a,n),Z(s,l,n))},Vt=(e,t,s,l,n)=>w(X(t,s),(t=>bt(e,s,t,l,n)),(()=>Tt(e,t,s,ct({[l]:n},e,s)))),Ct=e=>D(e)?is():ss(e),St=e=>ee(Pe,e,((e,t,s)=>vt(t,s)),((e,t)=>Rt(t))),vt=(e,t)=>{$(Pe,e)||Ot(e,1);const s=X(Pe,e);t!==s&&(xt(e,s,t),Z(Pe,e,t))},yt=(e,t)=>{const[s]=X(Oe,e),l=s(t);return $(X(ze,e),l)?yt(e,t):l},pt=e=>X(ze,e)??gt(e,{}),mt=e=>gt(e,{}),wt=(e,t,s)=>{const[,l]=X(Oe,e);l(s),Tt(e,t,s,{},!0)},It=(e,t,s,l,n,a)=>{const o=X(X(Je,e)?.[0],n);if(!m(o)&&!a)return bt(e,s,l,n,o);const r=t=>{Ft(e,s,t,X(l,t)),Et(e,s,t,-1),Z(l,t)};m(o)?r(n):Y(l,r),q(l)&&(Lt(e,s,-1),q(Z(t,s))&&(Jt(e,-1),Z(ze,e),Z(Oe,e),Z(xe,e)))},Rt=e=>{const t=X(Ee,e);if(!m(t))return vt(e,t);xt(e,X(Pe,e)),Ot(e,-1),Z(Pe,e)},Jt=(e,t)=>pe(i,e,t),Lt=(e,t,s)=>pe(_(z,e,Q),t,s)&&Z(x,e,_(x,e,(()=>0))+s),Et=(e,t,s,l)=>{const n=X(xe,e),a=X(n,s)??0;(0==a&&1==l||1==a&&-1==l)&&pe(_(p,e,Q),s,l),Z(n,s,a!=-l?a+l:null),pe(_(_(P,e,Q),t,Q),s,l)},Ft=(e,t,s,l,n)=>_(_(_(j,e,Q),t,Q),s,(()=>[l,0]))[1]=n,Ot=(e,t)=>pe(A,e,t),xt=(e,t,s)=>_(de,e,(()=>[t,0]))[1]=s,zt=(e,t,s,l,n)=>(O(_(_(_(we,e,Q),t,Q),s,(()=>[])),l),n),Pt=(e,t,s)=>(O(_(Ie,e,(()=>[])),t),s),jt=(e,t,s)=>w(X(X(X(j,e),t),s),(([e,t])=>[!0,e,t]),(()=>[!1,...he(Yt(e,t,s))])),kt=e=>w(X(de,e),(([e,t])=>[!0,e,t]),(()=>[!1,...he(es(e))])),At=e=>q(we)||q(Ge[e])?0:H(e?oe(we):we,((t,s)=>H(t,((t,l)=>H(t,((t,n)=>_e(Ge[e],[s,l,n],t))))))),Mt=e=>q(Ie)||q(He[e])?0:H(e?ne(Ie):Ie,((t,s)=>_e(He[e],[s],t))),Nt=(e,t,s)=>{if(!q(t))return _e(e,s,(()=>te(t))),1},Bt=e=>{const t=q(De[e]),s=q($e[e])&&q(Me[e])&&q(Ne[e])&&q(Be[e])&&t&&q(ke[e]),l=q(qe[e])&&q(We[e])&&q(Ae[e])&&q(je[e]);if(!s||!l){const n=e?[ne(i),ae(p),ne(x),ae(z),oe(P),oe(j)]:[i,p,x,z,P,j];if(!s){Nt(ke[e],n[0]),H(n[1],((t,s)=>Nt(Me[e],t,[s]))),H(n[2],((t,s)=>{0!=t&&_e(Ne[e],[s],Kt(s))}));const s=ce();H(n[3],((l,n)=>{Nt(Be[e],l,[n])&&!t&&(_e(De[e],[n,null]),ie(s,n))})),t||H(n[5],((t,l)=>{if(!$(s,l)){const s=ce();H(t,(e=>H(e,(([t,l],n)=>l!==t?ie(s,n):K(e,n))))),H(s,(t=>_e(De[e],[l,t])))}})),H(n[4],((t,s)=>H(t,((t,l)=>Nt($e[e],t,[s,l])))))}if(!l){let t;H(n[5],((s,l)=>{let n;H(s,((s,a)=>{let o;H(s,(([s,r],c)=>{r!==s&&(_e(qe[e],[l,a,c],r,s,jt),t=n=o=1)})),o&&_e(We[e],[l,a],jt)})),n&&_e(Ae[e],[l],jt)})),t&&_e(je[e],void 0,jt)}}},Dt=e=>{const t=q(Qe[e]),s=q(Ue[e])&&q(Ke[e]);if(!t||!s){const l=e?[ne(A),ne(de)]:[A,de];if(t||Nt(Qe[e],l[0]),!s){let t;H(l[1],(([s,l],n)=>{l!==s&&(_e(Ue[e],[n],l,s,kt),t=1)})),t&&_e(Ke[e],void 0,kt)}}},Wt=(e,...t)=>(hs((()=>e(...F(t,y)))),Ts),$t=()=>[te(j,((e,t)=>-1===X(i,t)?null:te(e,((e,s)=>-1===X(X(z,t),s)?null:te(e,(([,e])=>e??null),((e,t)=>Te(t)))),D)),D),te(de,(([,e])=>e??null),((e,t)=>Te(t)))],qt=()=>({cellsTouched:l,valuesTouched:n,changedCells:le(j,ge,Te),invalidCells:le(we),changedValues:te(de,ge,Te),invalidValues:te(Ie),changedTableIds:te(i),changedRowIds:se(z),changedCellIds:le(P),changedValueIds:te(A)}),Gt=()=>le(ze),Ht=()=>U(ze),Kt=e=>W(X(ze,y(e))),Qt=e=>U(X(ze,y(e))),Ut=(e,t,s,l=0,n)=>{return F(J((o=X(ze,y(e)),r=(e,s)=>[m(t)?s:X(e,y(t)),s],a=([e],[t])=>((e??0)<(t??0)?-1:1)*(s?-1:1),F([...o?.entries()??[]],(([e,t])=>r(t,e))).sort(a)),l,m(n)?n:l+n),(([,e])=>e));var a,o,r},Xt=(e,t)=>U(X(X(ze,y(e)),y(t))),Yt=(e,t,s)=>X(X(X(ze,y(e)),y(t)),y(s)),Zt=()=>te(Pe),_t=()=>U(Pe),es=e=>X(Pe,y(e)),ts=e=>Wt((()=>(e=>ye(e,lt,zt))(e)?ft(e):0)),ss=e=>Wt((()=>ot(e)?St(e):0)),ls=e=>{try{ht(ve(e))}catch{}return Ts},ns=t=>Wt((()=>{if((e=ye(t,(e=>ye(e,st))))&&(dt(t),!q(ze))){const e=Gt();os(),ts(e)}})),as=e=>Wt((()=>{if(t=(e=>ye(e,st))(e)){const s=Zt();us(),is(),t=!0,ut(e),ss(s)}})),os=()=>Wt((()=>ft({}))),rs=e=>Wt((e=>$(ze,e)?mt(e):0),e),cs=(e,t)=>Wt(((e,t)=>w(X(ze,e),(s=>$(s,t)?wt(e,s,t):0))),e,t),is=()=>Wt((()=>St({}))),ds=()=>Wt((()=>{dt({}),e=!1})),us=()=>Wt((()=>{ut({}),t=!1})),hs=(e,t)=>{if(-1!=o){fs();const s=e();return gs(t),s}},fs=()=>(-1!=o&&o++,1==o&&_e(Xe,void 0,$t,qt),Ts),gs=e=>(o>0&&(o--,0==o&&(l=!q(j),n=!q(de),o=1,At(1),l&&Bt(1),Mt(1),n&&Dt(1),e?.($t,qt)&&(H(j,((e,t)=>H(e,((e,s)=>H(e,(([e],l)=>Ve(Ts,t,s,l,e))))))),H(de,(([e],t)=>Ce(Ts,t,e))),l=n=!1),_e(Ye[0],void 0,$t,qt),o=-1,At(0),l&&Bt(0),Mt(0),n&&Dt(0),_e(Ye[1],void 0,$t,qt),o=0,l=n=!1,E([i,p,x,z,P,j,we,A,de,Ie],G))),Ts),Ts={getContent:()=>[Gt(),Zt()],getTables:Gt,getTableIds:Ht,getTable:e=>se(X(ze,y(e))),getTableCellIds:e=>U(X(xe,y(e))),getRowCount:Kt,getRowIds:Qt,getSortedRowIds:Ut,getRow:(e,t)=>te(X(X(ze,y(e)),y(t))),getCellIds:Xt,getCell:Yt,getValues:Zt,getValueIds:_t,getValue:es,hasTables:()=>!q(ze),hasTable:e=>$(ze,y(e)),hasTableCell:(e,t)=>$(X(xe,y(e)),y(t)),hasRow:(e,t)=>$(X(ze,y(e)),y(t)),hasCell:(e,t,s)=>$(X(X(ze,y(e)),y(t)),y(s)),hasValues:()=>!q(Pe),hasValue:e=>$(Pe,y(e)),getTablesJson:()=>Se(ze),getValuesJson:()=>Se(Pe),getJson:()=>Se([ze,Pe]),getTablesSchemaJson:()=>Se(Re),getValuesSchemaJson:()=>Se(Le),getSchemaJson:()=>Se([Re,Le]),hasTablesSchema:()=>e,hasValuesSchema:()=>t,setContent:([e,t])=>Wt((()=>{(D(e)?os:ts)(e),(D(t)?is:ss)(t)})),setTables:ts,setTable:(e,t)=>Wt((e=>lt(t,e)?gt(e,t):0),e),setRow:(e,t,s)=>Wt(((e,t)=>nt(e,t,s)?Tt(e,pt(e),t,s):0),e,t),addRow:(e,t,s=!0)=>hs((()=>{let l;return nt(e,l,t)&&(e=y(e),Tt(e,pt(e),l=yt(e,s?1:0),t)),l})),setPartialRow:(e,t,s)=>Wt(((e,t)=>{if(nt(e,t,s,1)){const l=pt(e);B(s,((s,n)=>Vt(e,l,t,n,s)))}}),e,t),setCell:(e,t,s,l)=>Wt(((e,t,s)=>w(at(e,t,s,R(l)?l(Yt(e,t,s)):l),(l=>Vt(e,pt(e),t,s,l)))),e,t,s),setValues:ss,setPartialValues:e=>Wt((()=>ot(e,1)?B(e,((e,t)=>vt(t,e))):0)),setValue:(e,t)=>Wt((e=>w(rt(e,R(t)?t(es(e)):t),(t=>vt(e,t)))),e),setTransactionChanges:e=>Wt((()=>{B(e[0],((e,t)=>m(e)?rs(t):B(e,((e,s)=>m(e)?cs(t,s):B(e,((e,l)=>Ve(Ts,t,s,l,e))))))),B(e[1],((e,t)=>Ce(Ts,t,e)))})),setTablesJson:ls,setValuesJson:e=>{try{Ct(ve(e))}catch{}return Ts},setJson:e=>Wt((()=>{try{const[t,s]=ve(e);ht(t),Ct(s)}catch{ls(e)}})),setTablesSchema:ns,setValuesSchema:as,setSchema:(e,t)=>Wt((()=>{ns(e),as(t)})),delTables:os,delTable:rs,delRow:cs,delCell:(e,t,s,l)=>Wt(((e,t,s)=>w(X(ze,e),(n=>w(X(n,t),(a=>$(a,s)?It(e,n,t,a,s,l):0))))),e,t,s),delValues:is,delValue:e=>Wt((e=>$(Pe,e)?Rt(e):0),e),delTablesSchema:ds,delValuesSchema:us,delSchema:()=>Wt((()=>{ds(),us()})),transaction:hs,startTransaction:fs,finishTransaction:gs,forEachTable:e=>H(ze,((t,s)=>e(s,(e=>H(t,((t,s)=>e(s,(e=>Y(t,e))))))))),forEachTableCell:(e,t)=>Y(X(xe,y(e)),t),forEachRow:(e,t)=>H(X(ze,y(e)),((e,s)=>t(s,(t=>Y(e,t))))),forEachCell:(e,t,s)=>Y(X(X(ze,y(e)),y(t)),s),forEachValue:e=>Y(Pe,e),addSortedRowIdsListener:(e,t,s,l,n,a,o)=>{let r=Ut(e,t,s,l,n);return Ze((()=>{const o=Ut(e,t,s,l,n);var c,i,d;i=r,L(c=o)===L(i)&&(d=(e,t)=>i[t]===e,c.every(d))||(r=o,a(Ts,e,t,s,l,n,r))}),De[o?1:0],[e,t],[Ht])},addStartTransactionListener:e=>Ze(e,Xe),addWillFinishTransactionListener:e=>Ze(e,Ye[0]),addDidFinishTransactionListener:e=>Ze(e,Ye[1]),callListener:e=>(tt(e),Ts),delListener:e=>(et(e),Ts),getListenerStats:()=>({}),createStore:me,addListener:Ze,callListeners:_e};return B({[u]:[0,je],[h]:[0,ke],[d]:[1,Ae,[Ht]],[d+V]:[1,Me,[Ht]],[g]:[1,Ne,[Ht]],[T]:[1,Be,[Ht]],[f]:[2,We,[Ht,Qt]],[V]:[2,$e,[Ht,Qt]],[b]:[3,qe,[Ht,Qt,Xt],e=>he(Yt(...e))],InvalidCell:[3,Ge],[S]:[0,Ke],[v]:[0,Qe],[C]:[1,Ue,[_t],e=>he(es(e[0]))],InvalidValue:[1,He]},(([e,t,s,l],n)=>{Ts["add"+n+"Listener"]=(...n)=>Ze(n[e],t[n[e+1]?1:0],e>0?J(n,0,e):void 0,s,l)})),k(Ts)};e.createStore=me},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
