var e,t;e=this,t=function(e){"use strict";const t=e=>typeof e,n="",s=t(n),r=t(!0),o=t(0),l=t(t),a="type",i="default",c=e=>n+e,d=(e,t)=>e.forEach(t),u=(e,t)=>e.map(t),f=e=>e.length,h=(e,t,n)=>e.slice(t,n),T=(e,...t)=>e.push(...t),b=e=>JSON.stringify(e,((e,t)=>{return v(t,Map)?(n=[...t],s=(e,[t,n])=>(e[t]=n,e),r={},n.reduce(s,r)):t;var n,s,r})),p=JSON.parse,g=isFinite,v=(e,t)=>e instanceof t,y=e=>null==e,w=(e,t,n)=>y(e)?n?.():t(e),R=e=>e==s||e==r,S=(e,t)=>e?.has(t)??!1,C=e=>y(e)||0==(e=>e.size)(e),I=e=>e.clear(),L=(e,t)=>e?.forEach(t),m=(e,t)=>e?.delete(t),E=e=>new Map(e),J=e=>[...e?.keys()??[]],F=(e,t)=>e?.get(t),O=(e,t)=>L(e,((e,n)=>t(n,e))),j=(e,t,n)=>y(n)?(m(e,t),e):e?.set(t,n),x=(e,t,n)=>(S(e,t)||j(e,t,n()),F(e,t)),z=(e,t,n)=>{const s={},r=t??(e=>e);return L(e,((e,t)=>w(r(e),(e=>n?.(e)?0:s[t]=e)))),s},M=(e,t)=>{const n=E(),s=t??(e=>e);return L(e,((e,t)=>n.set(t,s(e)))),n},k=e=>M(e,M),N=(e,t,n,s,r=0)=>w((n?x:F)(e,t[r],r>f(t)-2?n:E),(o=>{if(r>f(t)-2)return s?.(o)&&j(e,t[r]),o;const l=N(o,t,n,s,r+1);return C(o)&&j(e,t[r]),l})),P=Object,_=P.keys,B=P.isFrozen,D=P.freeze,W=(e,t)=>!y(((e,t)=>w(e,(e=>e[t])))(e,t)),$=(e,t)=>delete e[t],q=(e,t)=>d(P.entries(e),(([e,n])=>t(n,e))),A=e=>{return t=_(e),0==f(t);var t},G=e=>new Set(e),H=(e,t)=>e?.add(t),K=/^\d+$/,Q=()=>{const e=[];let t=0;return[()=>e.shift()??n+t++,t=>{K.test(t)&&f(e)<1e3&&T(e,t)}]},U=e=>{let t;const[s,r]=Q(),o=E();return[(r,l,a)=>{t??=e();const i=s();return j(o,i,[r,l,a]),H(N(l,a??[n],G),i),i},(e,s,...r)=>d(((e,t=[n])=>{const s=[],r=(e,n)=>n==f(t)?T(s,e):null===t[n]?L(e,(e=>r(e,n+1))):d([t[n],null],(t=>r(F(e,t),n+1)));return r(e,0),s})(e,s),(e=>L(e,(e=>F(o,e)[0](t,...s??[],...r))))),e=>w(F(o,e),(([,t,s])=>(N(t,s??[n],void 0,(t=>(m(t,e),C(t)?1:0))),j(o,e),r(e),s))),(e,n,s)=>w(F(o,e),(([e,,r=[]])=>{const o=(...l)=>{const a=f(l);a==f(r)?e(t,...l,...s(l)):y(r[a])?d(n[a](...l),(e=>o(...l,e))):o(...l,r[a])};o()}))]},V=e=>[e,e],X=()=>[E(),E()],Y=e=>{const n=t(e);return R(n)||n==o&&g(e)?n:void 0},Z=(e,t,n,s=j)=>{const r=(o=J(e),l=e=>!W(t,e),o.filter(l));var o,l;return d(_(t),(s=>n(e,s,t[s]))),d(r,(t=>s(e,t))),e},ee=(e,t,n)=>y(e)||!(e=>v(e,P)&&e.constructor==P)(e)||A(e)||B(e)?(n?.(),!1):(q(e,((n,s)=>{t(n,s)||$(e,s)})),!A(e)),te=(e,t,n)=>j(e,t,F(e,t)==-n?void 0:n),ne=()=>{let e,n,s=0;const r=E(),g=E(),v=E(),N=E(),P=E(),_=E(),B=E(),K=E(),se=E(),re=X(),oe=X(),le=X(),ae=X(),ie=X(),ce=X(),de=X(),ue=X(),fe=X(),he=X(),[Te,be,pe,ge]=U((()=>et)),ve=(t,n)=>(!e||S(_,n)||Pe(n))&&ee(t,((e,t)=>ye(n,t,e)),(()=>Pe(n))),ye=(e,t,n,s)=>ee(s?n:Re(n,e,t),((s,r)=>w(we(e,t,r,s),(e=>(n[r]=e,!0)),(()=>!1))),(()=>Pe(e,t))),we=(t,n,s,r)=>e?w(F(F(_,t),s),(e=>Y(r)!=e.type?Pe(t,n,s,r,e.default):r),(()=>Pe(t,n,s,r))):y(Y(r))?Pe(t,n,s,r):r,Re=(e,t,n)=>(w(F(B,t),(([s,r])=>{L(s,((t,n)=>{W(e,n)||(e[n]=t)})),L(r,(s=>{W(e,s)||Pe(t,n,s)}))})),e),Se=e=>Z(_,e,((e,t,n)=>{const s=E(),r=G();Z(x(_,t,E),n,((e,t,n)=>{j(e,t,n),w(n.default,(e=>j(s,t,e)),(()=>H(r,t)))})),j(B,t,[s,r])}),((e,t)=>{j(_,t),j(B,t)})),Ce=e=>Z(se,e,((e,t,n)=>Ie(t,n)),((e,t)=>Oe(t))),Ie=(e,t)=>Z(x(se,e,(()=>(ze(e,1),E()))),t,((t,n,s)=>Le(e,t,n,s)),((t,n)=>je(e,t,n))),Le=(e,t,n,s,r)=>Z(x(t,n,(()=>(Me(e,n,1),E()))),s,((t,s,r)=>me(e,n,t,s,r)),((s,o)=>xe(e,t,n,s,o,r))),me=(e,t,n,s,r)=>{S(n,s)||ke(e,t,s,1);const o=F(n,s);r!==o&&(Ne(e,t,s,o,r),j(n,s,r))},Ee=(e,t,n,s,r)=>w(F(t,n),(t=>me(e,n,t,s,r)),(()=>Le(e,t,n,Re({[s]:r},e,n)))),Je=e=>{const[t]=x(K,e,Q),n=t();return S(F(se,e),n)?Je(e):n},Fe=e=>F(se,e)??Ie(e,{}),Oe=e=>Ie(e,{}),je=(e,t,n)=>{const[,s]=x(K,e,Q);s(n),Le(e,t,n,{},!0)},xe=(e,t,n,s,r,o)=>{const l=F(F(B,e)?.[0],r);if(!y(l)&&!o)return me(e,n,s,r,l);const a=t=>{Ne(e,n,t,F(s,t)),ke(e,n,t,-1),j(s,t)};y(l)?a(r):O(s,a),C(s)&&(Me(e,n,-1),C(j(t,n))&&(ze(e,-1),j(se,e)))},ze=(e,t)=>te(r,e,t),Me=(e,t,n)=>te(x(g,e,E),t,n),ke=(e,t,n,s)=>te(x(x(v,e,E),t,E),n,s),Ne=(e,t,n,s,r)=>x(x(x(N,e,E),t,E),n,(()=>[s,0]))[1]=r,Pe=(e,t,n,s,r)=>(T(x(x(x(P,e,E),t,E),n,(()=>[])),s),r),_e=(e,t,n)=>w(F(F(F(N,e),t),n),(([e,t])=>[!0,e,t]),(()=>[!1,...V(Qe(e,t,n))])),Be=e=>C(P)||C(fe[e])?0:L(e?M(P,k):P,((t,n)=>L(t,((t,s)=>L(t,((t,r)=>be(fe[e],[n,s,r],t))))))),De=(e,t,n)=>{if(!C(t))return be(e,n),1},We=e=>{const t=C(ie[e]),n=C(de[e])&&C(ae[e])&&t&&C(oe[e]),s=C(ue[e])&&C(ce[e])&&C(le[e])&&C(re[e]);if(!n||!s){const o=e?[M(r),k(g),M(v,k),M(N,k)]:[r,g,v,N];if(!n){L(o[2],((t,n)=>L(t,((t,s)=>De(de[e],t,[n,s])))));const n=G();L(o[1],((s,r)=>{De(ae[e],s,[r])&&!t&&(be(ie[e],[r,null]),H(n,r))})),t||L(o[3],((t,s)=>{if(!S(n,s)){const n=G();L(t,(e=>L(e,(([t,s],r)=>s!==t?H(n,r):m(e,r))))),L(n,(t=>be(ie[e],[s,t])))}})),De(oe[e],o[0])}if(!s){let t;L(o[3],((n,s)=>{let r;L(n,((n,o)=>{let l;L(n,(([n,a],i)=>{a!==n&&(be(ue[e],[s,o,i],a,n,_e),t=r=l=1)})),l&&be(ce[e],[s,o],_e)})),r&&be(le[e],[s],_e)})),t&&be(re[e],void 0,_e)}}},$e=(e,...t)=>(Xe((()=>e(...u(t,c)))),et),qe=()=>z(se,(e=>z(e,z))),Ae=()=>J(se),Ge=e=>J(F(se,c(e))),He=(e,t,n,s=0,r)=>{const o=[];return O(F(se,c(e)),((e,n)=>T(o,[y(t)?e:F(n,c(t)),e]))),u(h(o.sort((([e],[t])=>(e<t?-1:1)*(n?-1:1))),s,y(r)?r:s+r),(([,e])=>e))},Ke=(e,t)=>J(F(F(se,c(e)),c(t))),Qe=(e,t,n)=>F(F(F(se,c(e)),c(t)),c(n)),Ue=e=>$e((()=>(e=>ee(e,ve,Pe))(e)?Ce(e):0)),Ve=()=>$e((()=>Ce({}))),Xe=(e,t)=>{if(-1==s)return;Ye();const n=e?.();return Ze(t),n},Ye=()=>(s++,et),Ze=e=>(s>0&&(s--,0==s&&(n=!C(N),s=1,Be(1),n&&We(1),s=-1,e?.(z(N,(e=>z(e,(e=>z(e,(e=>[...e]),(([e,t])=>e===t))),A)),A),z(P,(e=>z(e,z))))&&(s=1,L(N,((e,t)=>L(e,((e,n)=>L(e,(([e],s)=>((e,t,n,s,r)=>y(r)?e.delCell(t,n,s,!0):e.setCell(t,n,s,r))(et,t,n,s,e))))))),s=-1,n=!1),be(he[0],void 0,n),Be(0),n&&We(0),be(he[1],void 0,n),s=0,d([N,P,r,g,v],I))),et),et={getTables:qe,getTableIds:Ae,getTable:e=>z(F(se,c(e)),z),getRowIds:Ge,getSortedRowIds:He,getRow:(e,t)=>z(F(F(se,c(e)),c(t))),getCellIds:Ke,getCell:Qe,hasTables:()=>!C(se),hasTable:e=>S(se,c(e)),hasRow:(e,t)=>S(F(se,c(e)),c(t)),hasCell:(e,t,n)=>S(F(F(se,c(e)),c(t)),c(n)),getJson:()=>b(se),getSchemaJson:()=>b(_),setTables:Ue,setTable:(e,t)=>$e((e=>ve(t,e)?Ie(e,t):0),e),setRow:(e,t,n)=>$e(((e,t)=>ye(c(e),c(t),n)?Le(c(e),Fe(c(e)),c(t),n):0),e,t),addRow:(e,t)=>Xe((()=>{let n;return ye(e,n,t)&&(e=c(e),Le(e,Fe(e),n=Je(e),t)),n})),setPartialRow:(e,t,n)=>$e(((e,t)=>{if(ye(e,t,n,1)){const s=Fe(e);q(n,((n,r)=>Ee(e,s,t,r,n)))}}),e,t),setCell:(e,n,s,r)=>$e(((e,n,s)=>w(we(e,n,s,t(r)==l?r(Qe(e,n,s)):r),(t=>Ee(e,Fe(e),n,s,t)))),e,n,s),setJson:e=>{try{"{}"===e?Ve():Ue(p(e))}catch{}return et},setSchema:t=>$e((()=>{if((e=(e=>ee(e,(e=>ee(e,(e=>{if(!ee(e,((e,t)=>[a,i].includes(t))))return!1;const t=e.type;return!(!R(t)&&t!=o||(Y(e.default)!=t&&$(e,i),0))})))))(t))&&(Se(t),!C(se))){const e=qe();Ve(),Ue(e)}})),delTables:Ve,delTable:e=>$e((e=>S(se,e)?Oe(e):0),e),delRow:(e,t)=>$e(((e,t)=>w(F(se,e),(n=>S(n,t)?je(e,n,t):0))),e,t),delCell:(e,t,n,s)=>$e(((e,t,n)=>w(F(se,e),(r=>w(F(r,t),(o=>S(o,n)?xe(e,r,t,o,n,s):0))))),e,t,n),delSchema:()=>$e((()=>{Se({}),e=!1})),transaction:Xe,startTransaction:Ye,finishTransaction:Ze,forEachTable:e=>L(se,((t,n)=>e(n,(e=>L(t,((t,n)=>e(n,(e=>O(t,e))))))))),forEachRow:(e,t)=>L(F(se,c(e)),((e,n)=>t(n,(t=>O(e,t))))),forEachCell:(e,t,n)=>O(F(F(se,c(e)),c(t)),n),addSortedRowIdsListener:(e,t,n,s,r,o,l)=>{let a=He(e,t,n,s,r);return Te((()=>{const l=He(e,t,n,s,r);var i,c,d;c=a,f(i=l)===f(c)&&(d=(e,t)=>c[t]===e,i.every(d))||(a=l,o(et,e,t,n,s,r,a))}),ie[l?1:0],[e,t])},addWillFinishTransactionListener:e=>Te(e,he[0]),addDidFinishTransactionListener:e=>Te(e,he[1]),callListener:e=>(ge(e,[Ae,Ge,Ke],(e=>y(e[2])?[]:V(Qe(...e)))),et),delListener:e=>(pe(e),et),getListenerStats:()=>({}),createStore:ne};return q({Tables:[0,re],TableIds:[0,oe],Table:[1,le],RowIds:[1,ae],Row:[2,ce],CellIds:[2,de],Cell:[3,ue],InvalidCell:[3,fe]},(([e,t],n)=>{et["add"+n+"Listener"]=(...n)=>Te(n[e],t[n[e+1]?1:0],e>0?h(n,0,e):void 0)})),D(et)};e.createStore=ne,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TinyBaseStore={});
