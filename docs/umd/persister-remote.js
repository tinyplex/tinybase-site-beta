var t,e;t=this,e=function(t){"use strict";const e=JSON.parse,a=(t,e)=>t instanceof e,s=t=>null==t,n=Object,o=n.keys,r=n.freeze,c=t=>(t=>a(t,n)&&t.constructor==n)(t)&&0==(t=>o(t).length)(t),i=t=>t.headers.get("ETag");t.createRemotePersister=(t,n,o,d)=>{let y;return((t,e,u,f,h)=>{let l,p,v,w=0,g=0,A=0;const S=[],T=async t=>(2!=w&&(w=1,await m.schedule((async()=>{await t(),w=0}))),m),m={load:async(a,s)=>await T((async()=>{try{t.setContent(await e())}catch{t.setContent([a,s])}})),startAutoLoad:async(a={},o={})=>{return m.stopAutoLoad(),await m.load(a,o),A=1,r=async(a,s)=>await T((async()=>{if(s)t.setTransactionChanges(s());else try{t.setContent(a?.()??await e())}catch{}})),v=setInterval((async()=>{const t=await fetch(n,{method:"HEAD"}),e=i(t);s(y)||s(e)||e==y||(y=e,r())}),1e3*d),m;var r},stopAutoLoad:()=>(A&&(clearInterval(v),v=void 0,A=0),m),save:async e=>(1!=w&&(w=2,await m.schedule((async()=>{try{await(async t=>{return await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:(e=t(),JSON.stringify(e,((t,e)=>{return a(e,Map)?(s=(t,[e,a])=>(t[e]=a,t),n={},[...e].reduce(s,n)):e;var s,n})))});var e})(t.getContent)}catch{}w=0}))),m),startAutoSave:async()=>(await m.stopAutoSave().save(),l=t.addDidFinishTransactionListener(((t,e)=>{const[a,s]=e();c(a)&&c(s)||m.save((()=>[a,s]))})),m),stopAutoSave:()=>{var e,a;return e=l,a=t.delListener,s(e)||a(e),m},schedule:async(...t)=>(((t,...e)=>{t.push(...e)})(S,...t),await(async()=>{if(!g){for(g=1;!s((t=S,p=t.shift()));)try{await p()}catch{}g=0}var t})(),m),getStore:()=>t,destroy:()=>m.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return r(m)})(t,(async()=>{const t=await fetch(n);return y=i(t),e(await t.text())}))}},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TinyBasePersisterRemote={});
