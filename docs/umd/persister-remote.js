var t,e;t=this,e=function(t){"use strict";const e=t=>null==t,a=Object.freeze,o=t=>t.headers.get("ETag");t.createRemotePersister=(t,n,s,r)=>{let i;return((t,d,c,u,f)=>{let l,p,y=0,v=!1;const h={load:async(a,s)=>{if(2!=y){y=1;const r=await(async()=>{const t=await fetch(n);return i=o(t),t.text()})();e(r)||""==r?t.setContent([a,s]):t.setJson(r),y=0}return h},startAutoLoad:async(a,s)=>{return h.stopAutoLoad(),await h.load(a,s),v=!0,d=async a=>{e(a)?await h.load():2!=y&&(y=1,t.setContent(a),y=0)},p=setInterval((async()=>{const t=await fetch(n,{method:"HEAD"}),a=o(t);e(i)||e(a)||a==i||(i=a,d())}),1e3*r),h;var d},stopAutoLoad:()=>(v&&(clearInterval(p),p=void 0,v=!1),h),save:async()=>(1!=y&&(y=2,await(async t=>{return await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:(e=t(),JSON.stringify(e,((t,e)=>{return e instanceof Map?(a=(t,[e,a])=>(t[e]=a,t),o={},[...e].reduce(a,o)):e;var a,o})))});var e})(t.getContent),y=0),h),startAutoSave:async()=>(await h.stopAutoSave().save(),l=t.addDidFinishTransactionListener(h.save),h),stopAutoSave:()=>{var a,o;return a=l,o=t.delListener,e(a)||o(a),h},getStore:()=>t,destroy:()=>h.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return a(h)})(t)}},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TinyBasePersisterRemote={});
