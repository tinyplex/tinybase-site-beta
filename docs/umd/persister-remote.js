var t,e;t=this,e=function(t){"use strict";const e=JSON.parse,a=t=>null==t,s=Object.freeze,n=t=>t.headers.get("ETag");t.createRemotePersister=(t,o,r,i)=>{let c;return((t,e,d,y,u)=>{let f,h,l,p=0,v=0,w=0;const g=[],A=async t=>{2!=p&&(p=1,await t(),p=0)},S={load:async(a={},s={})=>(await A((async()=>{try{t.setContent(await e())}catch{t.setContent([a,s])}})),S),startAutoLoad:async(s={},r={})=>{return S.stopAutoLoad(),await S.load(s,r),w=1,d=async(a,s)=>{await A((async()=>{if(s)t.setTransactionChanges(s());else try{t.setContent(a?.()??await e())}catch{}}))},l=setInterval((async()=>{const t=await fetch(o,{method:"HEAD"}),e=n(t);a(c)||a(e)||e==c||(c=e,d())}),1e3*i),S;var d},stopAutoLoad:()=>(w&&(clearInterval(l),l=void 0,w=0),S),save:async e=>(await S.schedule((async()=>{if(1!=p){p=2;try{await(async t=>{return await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:(e=t(),JSON.stringify(e,((t,e)=>{return e instanceof Map?(a=(t,[e,a])=>(t[e]=a,t),s={},[...e].reduce(a,s)):e;var a,s})))});var e})(t.getContent)}catch{}p=0}})),S),startAutoSave:async()=>(await S.stopAutoSave().save(),f=t.addDidFinishTransactionListener(((t,e)=>{const a=e();S.save((()=>a))})),S),stopAutoSave:()=>{var e,s;return e=f,s=t.delListener,a(e)||s(e),S},schedule:async(...t)=>(((t,...e)=>{t.push(...e)})(g,...t),await(async()=>{if(!v){for(v=1;!a((t=g,h=t.shift()));)try{await h()}catch{}v=0}var t})(),S),getStore:()=>t,destroy:()=>S.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return s(S)})(t,(async()=>{const t=await fetch(o);return c=n(t),e(await t.text())}))}},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TinyBasePersisterRemote={});
