var t,e;t=this,e=function(t){"use strict";const e=(t,e)=>t instanceof e,a=t=>null==t,s=Object,n=s.keys,o=s.freeze,r=t=>(t=>e(t,s)&&t.constructor==s)(t)&&0==(t=>n(t).length)(t),c=JSON.parse,i=t=>t.headers.get("ETag");t.createRemotePersister=(t,n,d,y)=>{let u;return((t,c,f,h,l)=>{let p,w,v,g=0,A=0,S=0;const T=[],m=async t=>(2!=g&&(g=1,await C.schedule((async()=>{await t(),g=0}))),C),C={load:async(e,a)=>await m((async()=>{try{t.setContent(await c())}catch{t.setContent([e,a])}})),startAutoLoad:async(e={},s={})=>{return C.stopAutoLoad(),await C.load(e,s),S=1,o=async(e,a)=>await m((async()=>{if(a)t.setTransactionChanges(a());else try{t.setContent(e?.()??await c())}catch{}})),v=setInterval((async()=>{const t=await fetch(n,{method:"HEAD"}),e=i(t);a(u)||a(e)||e==u||(u=e,o())}),1e3*y),C;var o},stopAutoLoad:()=>(S&&(clearInterval(v),v=void 0,S=0),C),save:async a=>(1!=g&&(g=2,await C.schedule((async()=>{try{await(async t=>{return await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:(a=t(),JSON.stringify(a,((t,a)=>e(a,Map)?s.fromEntries([...a]):a)))});var a})(t.getContent)}catch{}g=0}))),C),startAutoSave:async()=>(await C.stopAutoSave().save(),p=t.addDidFinishTransactionListener(((t,e)=>{const[a,s]=e();r(a)&&r(s)||C.save((()=>[a,s]))})),C),stopAutoSave:()=>{var e,s;return e=p,s=t.delListener,a(e)||s(e),C},schedule:async(...t)=>(((t,...e)=>{t.push(...e)})(T,...t),await(async()=>{if(!A){for(A=1;!a((t=T,w=t.shift()));)try{await w()}catch{}A=0}var t})(),C),getStore:()=>t,destroy:()=>C.stopAutoLoad().stopAutoSave(),getStats:()=>({})};return o(C)})(t,(async()=>{const t=await fetch(n);return u=i(t),c(await t.text())}))}},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TinyBasePersisterRemote={});
